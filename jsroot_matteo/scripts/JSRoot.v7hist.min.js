var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(p){var u=0;return function(){return u<p.length?{done:!1,value:p[u++]}:{done:!0}}};$jscomp.arrayIterator=function(p){return{next:$jscomp.arrayIteratorImpl(p)}};$jscomp.makeIterator=function(p){var u="undefined"!=typeof Symbol&&Symbol.iterator&&p[Symbol.iterator];return u?u.call(p):$jscomp.arrayIterator(p)};
$jscomp.getGlobal=function(p){return"undefined"!=typeof window&&window===p?p:"undefined"!=typeof global&&null!=global?global:p};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(p,u,x){p!=Array.prototype&&p!=Object.prototype&&(p[u]=x.value)};
$jscomp.polyfill=function(p,u,x,f){if(u){x=$jscomp.global;p=p.split(".");for(f=0;f<p.length-1;f++){var l=p[f];l in x||(x[l]={});x=x[l]}p=p[p.length-1];f=x[p];u=u(f);u!=f&&null!=u&&$jscomp.defineProperty(x,p,{configurable:!0,writable:!0,value:u})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(p){function u(){this.batch_=null}function x(C){return C instanceof l?C:new l(function(f,p){f(C)})}if(p&&!$jscomp.FORCE_POLYFILL_PROMISE)return p;u.prototype.asyncExecute=function(C){if(null==this.batch_){this.batch_=[];var f=this;this.asyncExecuteFunction(function(){f.executeBatch_()})}this.batch_.push(C)};var f=$jscomp.global.setTimeout;u.prototype.asyncExecuteFunction=function(C){f(C,0)};u.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var C=
this.batch_;this.batch_=[];for(var f=0;f<C.length;++f){var p=C[f];C[f]=null;try{p()}catch(a){this.asyncThrow_(a)}}}this.batch_=null};u.prototype.asyncThrow_=function(f){this.asyncExecuteFunction(function(){throw f;})};var l=function(f){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var C=this.createResolveAndReject_();try{f(C.resolve,C.reject)}catch(F){C.reject(F)}};l.prototype.createResolveAndReject_=function(){function f(a){return function(c){l||(l=!0,a.call(p,c))}}var p=this,l=!1;
return{resolve:f(this.resolveTo_),reject:f(this.reject_)}};l.prototype.resolveTo_=function(f){if(f===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(f instanceof l)this.settleSameAsPromise_(f);else{a:switch(typeof f){case "object":var p=null!=f;break a;case "function":p=!0;break a;default:p=!1}p?this.resolveToNonPromiseObj_(f):this.fulfill_(f)}};l.prototype.resolveToNonPromiseObj_=function(f){var p=void 0;try{p=f.then}catch(F){this.reject_(F);return}"function"==typeof p?
this.settleSameAsThenable_(p,f):this.fulfill_(f)};l.prototype.reject_=function(f){this.settle_(2,f)};l.prototype.fulfill_=function(f){this.settle_(1,f)};l.prototype.settle_=function(f,p){if(0!=this.state_)throw Error("Cannot settle("+f+", "+p+"): Promise already settled in state"+this.state_);this.state_=f;this.result_=p;this.executeOnSettledCallbacks_()};l.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var f=0;f<this.onSettledCallbacks_.length;++f)z.asyncExecute(this.onSettledCallbacks_[f]);
this.onSettledCallbacks_=null}};var z=new u;l.prototype.settleSameAsPromise_=function(f){var p=this.createResolveAndReject_();f.callWhenSettled_(p.resolve,p.reject)};l.prototype.settleSameAsThenable_=function(f,p){var l=this.createResolveAndReject_();try{f.call(p,l.resolve,l.reject)}catch(a){l.reject(a)}};l.prototype.then=function(f,p){function u(b,g){return"function"==typeof b?function(e){try{a(b(e))}catch(k){c(k)}}:g}var a,c,b=new l(function(b,g){a=b;c=g});this.callWhenSettled_(u(f,a),u(p,c));return b};
l.prototype.catch=function(f){return this.then(void 0,f)};l.prototype.callWhenSettled_=function(f,p){function l(){switch(a.state_){case 1:f(a.result_);break;case 2:p(a.result_);break;default:throw Error("Unexpected state: "+a.state_);}}var a=this;null==this.onSettledCallbacks_?z.asyncExecute(l):this.onSettledCallbacks_.push(l)};l.resolve=x;l.reject=function(f){return new l(function(p,l){l(f)})};l.race=function(f){return new l(function(p,l){for(var a=$jscomp.makeIterator(f),c=a.next();!c.done;c=a.next())x(c.value).callWhenSettled_(p,
l)})};l.all=function(f){var p=$jscomp.makeIterator(f),u=p.next();return u.done?x([]):new l(function(a,c){function b(b){return function(c){e[b]=c;g--;0==g&&a(e)}}var e=[],g=0;do e.push(void 0),g++,x(u.value).callWhenSettled_(b(e.length-1),c),u=p.next();while(!u.done)})};return l},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};
$jscomp.SymbolClass=function(p,u){this.$jscomp$symbol$id_=p;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:u})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};$jscomp.Symbol=function(){function p(x){if(this instanceof p)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(x||"")+"_"+u++,x)}var u=0;return p}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var p=$jscomp.global.Symbol.iterator;p||(p=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[p]&&$jscomp.defineProperty(Array.prototype,p,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var p=$jscomp.global.Symbol.asyncIterator;p||(p=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(p){$jscomp.initSymbolIterator();p={next:p};p[$jscomp.global.Symbol.iterator]=function(){return this};return p};
$jscomp.iteratorFromArray=function(p,u){$jscomp.initSymbolIterator();p instanceof String&&(p+="");var x=0,f={next:function(){if(x<p.length){var l=x++;return{value:u(l,p[l]),done:!1}}f.next=function(){return{done:!0,value:void 0}};return f.next()}};f[Symbol.iterator]=function(){return f};return f};$jscomp.polyfill("Array.prototype.entries",function(p){return p?p:function(){return $jscomp.iteratorFromArray(this,function(p,x){return[p,x]})}},"es6","es3");
JSROOT.define(["d3","painter","v7gpad"],function(p,u){function x(a){"ROOT::Experimental::RAxisEquidistant"==a._typename||"ROOT::Experimental::RAxisLabels"==a._typename?(0===a.fInvBinWidth&&(a.$dummy=!0,a.fInvBinWidth=1,a.fNBinsNoOver=0,a.fLow=0),a.min=a.fLow,a.max=a.fLow+a.fNBinsNoOver/a.fInvBinWidth,a.GetNumBins=function(){return this.fNBinsNoOver},a.GetBinCoord=function(a){return this.fLow+a/this.fInvBinWidth},a.FindBin=function(a,b){return Math.floor((a-this.fLow)*this.fInvBinWidth+b)}):"ROOT::Experimental::RAxisIrregular"==
a._typename&&(a.min=a.fBinBorders[0],a.max=a.fBinBorders[a.fBinBorders.length-1],a.GetNumBins=function(){return this.fBinBorders.length},a.GetBinCoord=function(a){var b=Math.round(a);if(0>=b)return this.fBinBorders[0];if(b>=this.fBinBorders.length)return this.fBinBorders[this.fBinBorders.length-1];if(b==a)return this.fBinBorders[b];var c=a<b?b-1:b+1;return this.fBinBorders[b]*Math.abs(a-c)+this.fBinBorders[c]*Math.abs(a-b)},a.FindBin=function(a,b){for(var c=1;c<this.fBinBorders.length;++c)if(a<this.fBinBorders[c])return Math.floor(c-
1+b);return this.fBinBorders.length-1});a.GetBinCenter=function(a){return this.GetBinCoord(a-.5)};a.GetBinLowEdge=function(a){return this.GetBinCoord(a-1)}}function f(a,c){JSROOT.ObjectPainter.call(this,a,c);this.csstype="hist";this.draw_content=!0;this.nbinsy=this.nbinsx=0;this.accept_drops=!0;this.mode3d=!1;this.getHisto(!0)}function l(a,c){f.call(this,a,c);this.wheel_zoomy=!1}function z(a,c){f.call(this,a,c);this.wheel_zoomy=!0}function C(a,c,b){JSROOT.v7.RPavePainter.call(this,a,c,b,"stats")}
f.prototype=Object.create(JSROOT.ObjectPainter.prototype);f.prototype.isDisplayItem=function(){var a=this.getObject();return a&&a.fAxes?!0:!1};f.prototype.getHisto=function(a){var c=this.getObject(),b=c&&c.fHistImpl?c.fHistImpl.fIO:null;!b||b.getBinContent&&!a?!b&&c&&c.fAxes&&(b=c,!b.getBinContent||a)&&(3==b.fAxes.length?(x(b.fAxes[0]),x(b.fAxes[1]),x(b.fAxes[2]),b.nx=b.fIndicies[1]-b.fIndicies[0],b.dx=b.fIndicies[0]+1,b.stepx=b.fIndicies[2],b.ny=b.fIndicies[4]-b.fIndicies[3],b.dy=b.fIndicies[3]+
1,b.stepy=b.fIndicies[5],b.nz=b.fIndicies[7]-b.fIndicies[6],b.dz=b.fIndicies[6]+1,b.stepz=b.fIndicies[8],b.getBin=function(a,b,c){return a-1+this.fAxes[0].GetNumBins()*(b-1)+this.fAxes[0].GetNumBins()*this.fAxes[1].GetNumBins()*(c-1)},b.getBin0=1<b.stepx||1<b.stepy||1<b.stepz?function(a,b,c){return Math.floor((a-this.dx)/this.stepx)+this.nx/this.stepx*Math.floor((b-this.dy)/this.stepy)+this.nx/this.stepx*this.ny/this.stepy*Math.floor((c-this.dz)/this.stepz)}:function(a,b,c){return a-this.dx+this.nx*
(b-this.dy)+this.nx*this.ny*(c-dz)},b.getBinContent=function(a,b,c){return this.fBinContent[this.getBin0(a,b,c)]},b.getBinError=function(a,b,c){return Math.sqrt(Math.abs(this.getBinContent(a,b,c)))}):2==b.fAxes.length?(x(b.fAxes[0]),x(b.fAxes[1]),b.nx=b.fIndicies[1]-b.fIndicies[0],b.dx=b.fIndicies[0]+1,b.stepx=b.fIndicies[2],b.ny=b.fIndicies[4]-b.fIndicies[3],b.dy=b.fIndicies[3]+1,b.stepy=b.fIndicies[5],b.getBin=function(a,b){return a-1+this.fAxes[0].GetNumBins()*(b-1)},b.getBin0=1<b.stepx||1<b.stepy?
function(a,b){return Math.floor((a-this.dx)/this.stepx)+this.nx/this.stepx*Math.floor((b-this.dy)/this.stepy)}:function(a,b){return a-this.dx+this.nx*(b-this.dy)},b.getBinContent=function(a,b){return this.fBinContent[this.getBin0(a,b)]},b.getBinError=function(a,b){return Math.sqrt(Math.abs(this.getBinContent(a,b)))}):(x(b.fAxes[0]),b.nx=b.fIndicies[1]-b.fIndicies[0],b.dx=b.fIndicies[0]+1,b.stepx=b.fIndicies[2],b.getBin=function(a){return a-1},b.getBin0=1<b.stepx?function(a){return Math.floor((a-this.dx)/
this.stepx)}:function(a){return a-this.dx},b.getBinContent=function(a){return this.fBinContent[this.getBin0(a)]},b.getBinError=function(a){return Math.sqrt(Math.abs(this.getBinContent(a)))})):b.fAxes._2?(x(b.fAxes._0),x(b.fAxes._1),x(b.fAxes._2),b.getBin=function(a,b,c){return a-1+this.fAxes._0.GetNumBins()*(b-1)+this.fAxes._0.GetNumBins()*this.fAxes._1.GetNumBins()*(c-1)},b.getBinContent=function(a,b,c){return this.fStatistics.fBinContent[this.getBin(a,b,c)]},b.getBinError=function(a,b,c){a=this.getBin(a,
b,c);return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[a]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[a]))}):b.fAxes._1?(x(b.fAxes._0),x(b.fAxes._1),b.getBin=function(a,b){return a-1+this.fAxes._0.GetNumBins()*(b-1)},b.getBinContent=function(a,b){return this.fStatistics.fBinContent[this.getBin(a,b)]},b.getBinError=function(a,b){a=this.getBin(a,b);return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[a]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[a]))}):
(x(b.fAxes._0),b.getBin=function(a){return a-1},b.getBinContent=function(a){return this.fStatistics.fBinContent[a-1]},b.getBinError=function(a){return this.fStatistics.fSumWeightsSquared?Math.sqrt(this.fStatistics.fSumWeightsSquared[a-1]):Math.sqrt(Math.abs(this.fStatistics.fBinContent[a-1]))});return b};f.prototype.isRProfile=function(){return!1};f.prototype.isRH2Poly=function(){return!1};f.prototype.decodeOptions=function(){this.options||(this.options={Hist:1})};f.prototype.copyOptionsFrom=function(a){a!==
this&&(this.options.Mode3D=a.options.Mode3D)};f.prototype.copyOptionsToOthers=function(){var a=this;this.forEachPainter(function(c){c!==a&&"function"==typeof c.copyOptionsFrom&&c.copyOptionsFrom(a)},"objects")};f.prototype.clear3DScene=function(){var a=this.getFramePainter();a&&"function"===typeof a.create3DScene&&a.create3DScene(-1);this.mode3d=!1};f.prototype.cleanup=function(){this.clear3DScene();delete this.options;JSROOT.ObjectPainter.prototype.cleanup.call(this)};f.prototype.getDimension=function(){return 1};
f.prototype.scanContent=function(){};f.prototype.drawFrameAxes=function(){var a=this.getFramePainter();if(!a)return Promise.resolve(!1);if(!this.isMainPainter()||!this.draw_content)return Promise.resolve(!0);a.cleanupAxes();a.xmin=a.xmax=0;a.ymin=a.ymax=0;a.zmin=a.zmax=0;a.setAxesRanges(this.getAxis("x"),this.xmin,this.xmax,this.getAxis("y"),this.ymin,this.ymax,this.getAxis("z"),this.zmin,this.zmax);return a.drawAxes()};f.prototype.createHistDrawAttributes=function(){this.createv7AttFill();this.createv7AttLine()};
f.prototype.updateDisplayItem=function(a,c){if(!a||!c)return!1;a.fAxes=c.fAxes;a.fIndicies=c.fIndicies;a.fBinContent=c.fBinContent;a.fContMin=c.fContMin;a.fContMinPos=c.fContMinPos;a.fContMax=c.fContMax;this.getHisto(!0);return!0};f.prototype.updateObject=function(a){var c=this.getObject();if(a!==c){if(!this.matchObjectType(a))return!1;if(this.isDisplayItem())this.updateDisplayItem(c,a);else{var b=c&&c.fHistImpl?c.fHistImpl.fIO:null,e=a&&a.fHistImpl?a.fHistImpl.fIO:null;if(!b||!e)return!1;b.fStatistics=
e.fStatistics;c.fTitle=a.fTitle}}this.scanContent();return this.histogram_updated=!0};f.prototype.getAxis=function(a){var c=this.getHisto(),b=this.getObject(),e=null;if(b&&b.fAxes)switch(a){case "x":e=b.fAxes[0];break;case "y":e=b.fAxes[1];break;case "z":e=b.fAxes[2];break;default:e=b.fAxes[0]}else if(c&&c.fAxes)switch(a){case "x":e=c.fAxes._0;break;case "y":e=c.fAxes._1;break;case "z":e=c.fAxes._2;break;default:e=c.fAxes._0}e&&!e.GetBinCoord&&x(e);return e};f.prototype.getAxisBinTip=function(a,c,
b){var e=this.getFramePainter(),g=e[a+"_handle"],m=this.getAxis(a),k=m.GetBinCoord(c);if("labels"===g.kind)return e.axisAsText(a,k);c=m.GetBinCoord(c+(b||1));return"time"===g.kind?e.axisAsText(a,(k+c)/2):"["+e.axisAsText(a,k)+", "+e.axisAsText(a,c)+")"};f.prototype.extractAxesProperties=function(a){if(this.getHisto()){this.nbinsx=this.nbinsy=this.nbinsz=0;var c=this.getAxis("x");this.nbinsx=c.GetNumBins();this.xmin=c.min;this.xmax=c.max;2>a||(c=this.getAxis("y"),this.nbinsy=c.GetNumBins(),this.ymin=
c.min,this.ymax=c.max,3>a||(c=this.getAxis("z"),this.nbinsz=c.GetNumBins(),this.zmin=c.min,this.zmax=c.max))}};f.prototype.addInteractivity=function(){if(JSROOT.batch_mode||!this.isMainPainter())return!0;var a=this.getFramePainter();return a?a.addInteractivity():!1};f.prototype.processItemReply=function(a,c){if(!this.isDisplayItem())return console.error("Get item when display normal histogram");c.reqid===this.current_item_reqid&&(null!==a&&this.updateDisplayItem(this.getObject(),a.item),c.resolveFunc(!0))};
f.prototype.drawingBins=function(a){var c=this,b=!1;a&&"string"==typeof a&&0==a.indexOf("zoom")&&(0<a.indexOf("0")&&(b=!0),1<this.getDimension()&&0<a.indexOf("1")&&(b=!0),2<this.getDimension()&&0<a.indexOf("2")&&(b=!0));return this.isDisplayItem()&&b&&this.v7CommMode()==JSROOT.v7.CommMode.kNormal&&this.prepareDraw({only_indexes:!0}).incomplete?new Promise(function(a){var b=c.v7SubmitRequest("",{_typename:"ROOT::Experimental::RHistDrawableBase::RRequest"},c.processItemReply.bind(c));b?(c.current_item_reqid=
b.reqid,b.resolveFunc=a,setTimeout(c.processItemReply.bind(c,null,b),1E3)):a(!0)}):Promise.resolve(!0)};f.prototype.toggleStat=function(){};f.prototype.getSelectIndex=function(a,c,b){var e=this.getFramePainter(),g=this.getAxis(a),m=this["nbins"+a]||0,k=e?e["zoom_"+a+"min"]:0;a=e?e["zoom_"+a+"max"]:0;k!==a&&g?(c="left"==c?g.FindBin(k,b||0):g.FindBin(a,(b||0)+.5),0>c?c=0:c>m&&(c=m)):c="left"==c?0:m;return c};f.prototype.clickButton=function(a){switch(a){case "ToggleZoom":if(this.zoom_xmin!==this.zoom_xmax||
this.zoom_ymin!==this.zoom_ymax||this.zoom_zmin!==this.zoom_zmax)return this.unzoom(),this.getFramePainter().zoomChangedInteractive("reset"),!0;if(this.draw_content&&"function"===typeof this.autoZoom)return this.autoZoom(),!0;break;case "ToggleLogX":this.getFramePainter().toggleAxisLog("x");break;case "ToggleLogY":this.getFramePainter().toggleAxisLog("y");break;case "ToggleLogZ":this.getFramePainter().toggleAxisLog("z");break;case "ToggleStatBox":return this.toggleStat(),!0}return!1};f.prototype.fillToolbar=
function(a){var c=this.getPadPainter();c&&(c.addPadButton("auto_zoom","Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *"),c.addPadButton("arrow_right","Toggle log x","ToggleLogX","PageDown"),c.addPadButton("arrow_up","Toggle log y","ToggleLogY","PageUp"),1<this.getDimension()&&c.addPadButton("arrow_diag","Toggle log z","ToggleLogZ"),this.draw_content&&c.addPadButton("statbox","Toggle stat box","ToggleStatBox"),a||c.showPadButtons())};f.prototype.get3DToolTip=function(a){var c=this.getHisto(),
b={bin:a,name:c.fName||"histo",title:c.fTitle};switch(this.getDimension()){case 1:b.ix=a+1;b.iy=1;b.value=c.getBinContent(b.ix);b.error=c.getBinError(b.ix);b.lines=this.getBinTooltips(a-1);break;case 2:b.ix=a%this.nbinsx+1;b.iy=(a-(b.ix-1))/this.nbinsx+1;b.value=c.getBinContent(b.ix,b.iy);b.error=c.getBinError(b.ix,b.iy);b.lines=this.getBinTooltips(b.ix-1,b.iy-1);break;case 3:b.ix=a%this.nbinsx+1,b.iy=(a-(b.ix-1))/this.nbinsx%this.nbinsy+1,b.iz=(a-(b.ix-1)-(b.iy-1)*this.nbinsx)/this.nbinsx/this.nbinsy+
1,b.value=c.getBinContent(b.ix,b.iy,b.iz),b.error=c.getBinError(b.ix,b.iy,b.iz),b.lines=this.getBinTooltips(b.ix-1,b.iy-1,b.iz-1)}return b};f.prototype.createContour=function(a,c,b){if(a&&c){b||(b={});var e=JSROOT.gStyle.fNumberContours,g=this.minbin,m=this.maxbin,k=this.minposbin;b&&b.scatter_plot&&(50<e&&(e=50),g=this.minposbin);g===m&&(g=this.gminbin,m=this.gmaxbin,k=this.gminposbin);3>this.getDimension()&&(a.zoom_zmin!==a.zoom_zmax?(g=a.zoom_zmin,m=a.zoom_zmax):b.full_z_range&&(g=a.zmin,m=a.zmax));
c.createContour(a.logz,e,g,m,k);3>this.getDimension()&&(a.scale_zmin=c.colzmin,a.scale_zmax=c.colzmax)}};f.prototype.changeValuesRange=function(a){var c=this.getFramePainter();if(c){var b=c.isAxisZoomed(a)?"zoom_"+a:a;b=(b=prompt("Enter values range for axis "+a+" like [0,100] or empty string to unzoom","["+c[b+"min"]+","+c[b+"max"]+"]"))?JSON.parse(b):[];!b||"object"!=typeof b||2!=b.length||isNaN(b[0])||isNaN(b[1])?c.unzoom(a):c.zoom(a,b[0],b[1])}};f.prototype.fillContextMenu=function(a){var c=this;
a.add("header:v7histo::anyname");this.draw_content&&(a.addchk(this.toggleStat("only-check"),"Show statbox",function(){return c.toggleStat()}),2==this.getDimension()&&a.add("Values range",function(){return c.changeValuesRange("z")}),"function"==typeof this.fillHistContextMenu&&this.fillHistContextMenu(a));var b=this.getFramePainter();if(this.options.Mode3D){0<a.size()&&a.add("separator");var e=this.getMainPainter()||this;a.addchk(e.isTooltipAllowed(),"Show tooltips",function(){return e.setTooltipAllowed("toggle")});
a.addchk(b.enable_highlight,"Highlight bins",function(){b.enable_highlight=!b.enable_highlight;!b.enable_highlight&&e.highlightBin3D&&e.mode3d&&e.highlightBin3D(null)});b&&b.render3D&&(a.addchk(e.options.FrontBox,"Front box",function(){e.options.FrontBox=!e.options.FrontBox;b.render3D()}),a.addchk(e.options.BackBox,"Back box",function(){e.options.BackBox=!e.options.BackBox;b.render3D()}));this.draw_content&&(a.addchk(!this.options.Zero,"Suppress zeros",function(){c.options.Zero=!c.options.Zero;c.redrawPad()}),
12==this.options.Lego||14==this.options.Lego)&&(a.addchk(this.options.Zscale,"Z scale",function(){return c.toggleColz()}),this.fillPaletteMenu&&this.fillPaletteMenu(a));e.control&&"function"===typeof e.control.reset&&a.add("Reset camera",function(){return e.control.reset()})}a.addAttributesMenu(this);this.histogram_updated&&b.zoomChangedInteractive()&&a.add("Let update zoom",function(){return b.zoomChangedInteractive("reset")});return!0};f.prototype.updatePaletteDraw=function(){if(this.isMainPainter()){var a=
this.getPadPainter().findPainterFor(void 0,void 0,"ROOT::Experimental::RPaletteDrawable");a&&a.drawPalette()}};f.prototype.fillPaletteMenu=function(a){function c(a){g.options.Palette=parseInt(a);g.redraw()}function b(b,g,q){a.addchk(b===e||q,"<nobr>"+g+"</nobr>",b,c)}var e=this.options.Palette,g=this;if(null===e||0===e)e=JSROOT.settings.Palette;a.add("sub:Palette");b(50,"ROOT 5",10<=e&&51>e);b(51,"Deep Sea");b(52,"Grayscale",0<e&&10>e);b(53,"Dark body radiator");b(54,"Two-color hue");b(55,"Rainbow");
b(56,"Inverted dark body radiator");b(57,"Bird",112<e);b(58,"Cubehelix");b(59,"Green Red Violet");b(60,"Blue Red Yellow");b(61,"Ocean");b(62,"Color Printable On Grey");b(63,"Alpine");b(64,"Aquamarine");b(65,"Army");b(66,"Atlantic");a.add("endsub:")};f.prototype.drawColorPalette=function(){return null};f.prototype.toggleColz=function(){if(this.options.Mode3D?12===this.options.Lego||14===this.options.Lego||11===this.options.Surf||12===this.options.Surf:this.options.Color||this.options.Contour)this.options.Zscale=
!this.options.Zscale,this.drawColorPalette(this.options.Zscale,!1,!0)};f.prototype.toggleMode3D=function(){this.options.Mode3D=!this.options.Mode3D;!this.options.Mode3D||this.options.Surf||this.options.Lego||this.options.Error||(this.options.Lego=50<=this.nbinsx||50<=this.nbinsy?this.options.Color?14:13:this.options.Color?12:1,this.options.Zero=!1);this.copyOptionsToOthers();this.interactiveRedraw("pad","drawopt")};f.prototype.prepareDraw=function(a){a||(a={rounding:!0,extra:0,middle:0});void 0===
a.extra&&(a.extra=0);void 0===a.right_extra&&(a.right_extra=a.extra);void 0===a.middle&&(a.middle=0);var c=this.getHisto(),b=this.getAxis("x"),e=this.getAxis("y"),g=this.getFramePainter(),m=this.getDimension(),k,q,d={i1:this.getSelectIndex("x","left",0-a.extra),i2:this.getSelectIndex("x","right",1+a.right_extra),j1:2>m?0:this.getSelectIndex("y","left",0-a.extra),j2:2>m?1:this.getSelectIndex("y","right",1+a.right_extra),k1:3>m?0:this.getSelectIndex("z","left",0-a.extra),k2:3>m?1:this.getSelectIndex("z",
"right",1+a.right_extra),stepi:1,stepj:1,stepk:1,min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1};this.isDisplayItem()&&c.fIndicies&&(d.i1<c.fIndicies[0]&&(d.i1=c.fIndicies[0],d.incomplete=!0),d.i2>c.fIndicies[1]&&(d.i2=c.fIndicies[1],d.incomplete=!0),d.stepi=c.fIndicies[2],1<d.stepi&&(d.incomplete=!0),1<m&&5<c.fIndicies.length&&(d.j1<c.fIndicies[3]&&(d.j1=c.fIndicies[3],d.incomplete=!0),d.j2>c.fIndicies[4]&&(d.j2=c.fIndicies[4],d.incomplete=!0),d.stepj=c.fIndicies[5],1<d.stepj&&(d.incomplete=
!0)),2<m&&8<c.fIndicies.length&&(d.k1<c.fIndicies[6]&&(d.k1=c.fIndicies[6],d.incomplete=!0),d.k2>c.fIndicies[7]&&(d.k2=c.fIndicies[7],d.incomplete=!0),d.stepk=c.fIndicies[8],1<d.stepk&&(d.incomplete=!0)));if(a.only_indexes)return d;d.grx=Array(d.i2+d.stepi+1);d.gry=Array(d.j2+d.stepj+1);a.original&&(d.original=!0,d.origx=Array(d.i2+1),d.origy=Array(d.j2+1));a.pixel_density&&(a.rounding=!0);for(k=d.i1;k<=d.i2;++k){var y=b.GetBinCoord(k+a.middle);g.logx&&0>=y?d.i1=k+1:(d.origx&&(d.origx[k]=y),d.grx[k]=
g.grx(y),a.rounding&&(d.grx[k]=Math.round(d.grx[k])),a.use3d&&(d.grx[k]<-g.size_xy3d&&(d.i1=k,d.grx[k]=-g.size_xy3d),d.grx[k]>g.size_xy3d&&(d.i2=k,d.grx[k]=g.size_xy3d)))}a.use3d&&(d.i1<d.i2-2&&d.grx[d.i1]==d.grx[d.i1+1]&&d.i1++,d.i1<d.i2-2&&d.grx[d.i2-1]==d.grx[d.i2]&&d.i2--);for(;k<d.i2+d.stepi+1;)d.grx[k++]=d.grx[d.i2];if(1===m)d.gry[0]=g.gry(0),d.gry[1]=g.gry(1);else for(q=d.j1;q<=d.j2;++q)k=e.GetBinCoord(q+a.middle),g.logy&&0>=k?d.j1=q+1:(d.origy&&(d.origy[q]=k),d.gry[q]=g.gry(k),a.rounding&&
(d.gry[q]=Math.round(d.gry[q])),a.use3d&&(d.gry[q]<-g.size_xy3d&&(d.j1=q,d.gry[q]=-g.size_xy3d),d.gry[q]>g.size_xy3d&&(d.j2=q,d.gry[q]=g.size_xy3d)));a.use3d&&1<m&&(d.j1<d.j2-2&&d.gry[d.j1]==d.gry[d.j1+1]&&d.j1++,d.j1<d.j2-2&&d.gry[d.j2-1]==d.gry[d.j2]&&d.j2--);for(;1<m&&q<d.j2+d.stepj+1;)d.gry[q++]=d.gry[d.j2];c.getBinContent(d.i1+1,d.j1+1);this.maxbin=this.minbin=this.minposbin=null;for(k=d.i1;k<d.i2;k+=d.stepi)for(q=d.j1;q<d.j2;q+=d.stepj)if(e=c.getBinContent(k+1,q+1),!isNaN(e)){d.sumz+=e;if(a.pixel_density){m=
(d.grx[k+d.stepi]-d.grx[k])*(d.gry[q]-d.gry[q+d.stepj]);if(0>=m)continue;d.max=Math.max(d.max,e);0<e&&(e<d.min||0===d.min)&&(d.min=e);e/=m}null===this.maxbin?this.maxbin=this.minbin=e:(this.maxbin=Math.max(this.maxbin,e),this.minbin=Math.min(this.minbin,e));0<e&&(null===this.minposbin||e<this.minposbin)&&(this.minposbin=e)}d.palette=g.getHistPalette();d.palette&&this.createContour(g,d.palette,a);return d};l.prototype=Object.create(f.prototype);l.prototype.scanContent=function(a){var c=this.getHisto();
if(c){!this.nbinsx&&a&&(a=!1);a||this.extractAxesProperties(1);var b=0,e=0,g=0,m=0;if(this.isDisplayItem())b=c.fContMin,e=c.fContMinPos,m=g=c.fContMax;else{var k=this.getSelectIndex("x","left"),q=this.getSelectIndex("x","right");if(a&&k===this.scan_xleft&&q===this.scan_xright)return;this.scan_xleft=k;this.scan_xright=q;a=!0;for(var d,y=0;y<this.nbinsx;++y)d=c.getBinContent(y+1),m+=d,y<k||y>=q||(0<d&&(0==e||d<e)&&(e=d),a&&(b=g=d,a=!1),b=Math.min(b,d-0),g=Math.max(g,d+0))}this.stat_entries=m;this.hmin=
b;this.hmax=g;this.ymin_nz=e;if(this.draw_content=0==this.nbinsx||1E-300>Math.abs(b)&&1E-300>Math.abs(g)?!1:!0)b>=g?0==b?(this.ymin=0,this.ymax=1):0>b?(this.ymin=2*b,this.ymax=0):(this.ymin=0,this.ymax=2*b):(c=.05*(g-b),this.ymin=b-c,0>this.ymin&&0<=b&&(this.ymin=0),this.ymax=g+c)}};l.prototype.countStat=function(a){for(var c=this.isRProfile(),b=this.getHisto(),e=this.getAxis("x"),g=this.getSelectIndex("x","left"),m=this.getSelectIndex("x","right"),k=0,q=0,d=0,y=0,n=0,h,w,v=null,E=null,r=this.getFramePainter(),
t={name:"histo",meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};g<m;++g)if(h=e.GetBinCoord(g+.5),!a||a(h)){c?(w=b.fBinEntries[g+1],y+=b.fArray[g+1],n+=b.fSumw2[g+1]):w=b.getBinContent(g+1);if(null===v||w>E)v=h,E=w;k+=w;q+=w*h;d+=w*h*h}!r.isAxisZoomed("x")&&b.fTsumw&&(k=b.fTsumw,q=b.fTsumwx,d=b.fTsumwx2);t.integral=k;0<k&&(t.meanx=q/k,t.meany=y/k,t.rmsx=Math.sqrt(Math.abs(d/k-t.meanx*t.meanx)),t.rmsy=Math.sqrt(Math.abs(n/k-t.meany*t.meany)));null!==v&&(t.xmax=v,t.wmax=
E);return t};l.prototype.fillStatistic=function(a,c){var b=this.countStat(),e=c%10,g=Math.floor(c/10)%10,m=Math.floor(c/100)%10,k=Math.floor(c/1E3)%10,q=Math.floor(c/1E4)%10,d=Math.floor(c/1E5)%10,y=Math.floor(c/1E6)%10,n=Math.floor(c/1E7)%10;c=Math.floor(c/1E8)%10;a.clearStat();0<e&&a.addText(b.name);this.isRProfile()?(0<g&&a.addText("Entries = "+a.format(b.entries,"entries")),0<m&&(a.addText("Mean = "+a.format(b.meanx)),a.addText("Mean y = "+a.format(b.meany))),0<k&&(a.addText("Std Dev = "+a.format(b.rmsx)),
a.addText("Std Dev y = "+a.format(b.rmsy)))):(0<g&&a.addText("Entries = "+a.format(b.entries,"entries")),0<m&&a.addText("Mean = "+a.format(b.meanx)),0<k&&a.addText("Std Dev = "+a.format(b.rmsx)),0<q&&a.addText("Underflow = "+a.format(histo.getBinContent(0),"entries")),0<d&&a.addText("Overflow = "+a.format(histo.getBinContent(this.nbinsx+1),"entries")),0<y&&a.addText("Integral = "+a.format(b.integral,"entries")),0<n&&a.addText("Skew = <not avail>"),0<c&&a.addText("Kurt = <not avail>"));return!0};l.prototype.drawBars=
function(a,c,b){this.createG(!0);var e=a.i1;c=a.i2;a=a.stepi;var g=this.getFramePainter(),m=this.getHisto(),k=this.getAxis("x"),q="",d="",y="";b=g.swap_xy?0:b;for(!1===this.options.BaseLine||isNaN(this.options.BaseLine)||this.options.BaseLine>=g.scale_ymin&&(b=Math.round(g.gry(this.options.BaseLine)));e<c;e+=a){var n=k.GetBinCoord(e);var h=k.GetBinCoord(e+a);if(!(g.logx&&0>=h)){n=Math.round(g.grx(n));h=Math.round(g.grx(h));var w=m.getBinContent(e+1);if(!(g.logy&&w<g.scale_ymin)){w=Math.round(g.gry(w));
var v=h-n;n+=Math.round(this.options.BarOffset*v);v=Math.round(this.options.BarWidth*v);q=g.swap_xy?q+("M"+b+","+n+"h"+(w-b)+"v"+v+"h"+(b-w)+"z"):q+("M"+n+","+w+"h"+v+"v"+(b-w)+"h"+-v+"z");0<this.options.BarStyle&&(h=n+v,v=Math.round(v/10),g.swap_xy?(d+="M"+b+","+n+"h"+(w-b)+"v"+v+"h"+(b-w)+"z",y+="M"+b+","+h+"h"+(w-b)+"v"+-v+"h"+(b-w)+"z"):(d+="M"+n+","+w+"h"+v+"v"+(b-w)+"h"+-v+"z",y+="M"+h+","+w+"h"+-v+"v"+(b-w)+"h"+v+"z"))}}}this.fillatt.empty()&&this.fillatt.setSolidColor("blue");0<q.length&&
this.draw_g.append("svg:path").attr("d",q).call(this.fillatt.func);0<d.length&&this.draw_g.append("svg:path").attr("d",d).call(this.fillatt.func).style("fill",p.rgb(this.fillatt.color).brighter(.5).toString());0<y.length&&this.draw_g.append("svg:path").attr("d",y).call(this.fillatt.func).style("fill",p.rgb(this.fillatt.color).darker(.5).toString())};l.prototype.drawFilledErrors=function(a){this.createG(!0);var c=a.i1,b=a.i2,e=a.stepi,g=this.getFramePainter(),m=this.getHisto(),k=this.getAxis("x"),
q=[];for(a=[];c<b;c+=e){var d=k.GetBinCoord(c+.5);if(!(g.logx&&0>=d)){d=Math.round(g.grx(d));var y=m.getBinContent(c+1);var n=m.getBinError(c+1);if(!(g.logy&&y-n<g.scale_ymin)){var h=Math.round(g.gry(y+n));y=Math.round(g.gry(y-n));q.push({grx:d,gry:h});a.unshift({grx:d,gry:y})}}}b=4===this.options.ErrorKind?"bezier":"line";q=u.buildSvgPath(b,q);a=u.buildSvgPath("L"+b,a);this.fillatt.empty()&&this.fillatt.setSolidColor("blue");this.draw_g.append("svg:path").attr("d",q.path+a.path+"Z").style("stroke",
"none").call(this.fillatt.func)};l.prototype.draw1DBins=function(){var a=this.getFramePainter().getFrameRect();if(!this.draw_content||0>=a.width||0>=a.height)return this.removeG();this.createHistDrawAttributes();var c=this.prepareDraw({extra:1,only_indexes:!0});return this.options.Bar?this.drawBars(c,a.width,a.height):3===this.options.ErrorKind||4===this.options.ErrorKind?this.drawFilledErrors(c,a.width,a.height):this.drawHistBins(c,a.width,a.height)};l.prototype.drawHistBins=function(a,c,b){var e=
this;this.createG(!0);var g=this.options,m=a.i1,k=a.i2,q=a.stepi,d=this.getFramePainter(),y=this.getHisto(),n=this.getAxis("x");a="";var h=!1,w,v,E,r,t,f,p=!g.Zero,A=g.Error;h=g.Mark;var Q=g.Line,l=g.Text,z=l&&"E"==this.options.TextKind&&this.isRProfile(),x=null,D=null,B=null,C=null,F="",Z="",U=0,I,N,V,R,aa,J,L,O;A&&!h&&1<this.v7EvalAttr("marker_style",1)&&(h=!0);2===g.ErrorKind?this.fillatt.empty()?h=!0:x="":g.Error&&(D="");Q&&(C="");h&&(this.createv7AttMarker(),0<this.markeratt.size?(B="",this.markeratt.resetPos()):
h=!1);if(l){var K=this.v7EvalFont("text",{size:20,color:"black",align:22});if(!K.angle&&!g.TextKind){var G=c/(k-m+1);G<3*K.size&&(K.setAngle(270),K.setSize(Math.round(.7*G)))}this.startTextDrawing(K,"font")}c=k-m>3*c;1===g.ErrorKind&&(G=this.lineatt.width+JSROOT.gStyle.fEndErrorSize,F="m0,"+G+"v-"+2*G+"m0,"+G,Z="m"+G+",0h-"+2*G+"m"+G+",0",U=Math.floor((this.lineatt.width-1)/2));var S=A||h;if(S||l||Q)c=!0;var W=function(a){R=y.getBinContent(a+1);p&&0===R||(J=Math.round(d.grx(n.GetBinCoord(a))),L=Math.round(d.grx(n.GetBinCoord(a+
q))),O=Math.round((J+L)/2),I=Math.round(d.gry(R)),N=V=20,A&&(aa=y.getBinError(a+1),N=Math.round(I-d.gry(R+aa)),V=Math.round(d.gry(R-aa)-I)),l&&(a=z?y.fBinEntries[a+1]:R,0!==a&&(a=a===Math.round(a)?a.toString():u.floatToString(a,JSROOT.gStyle.fPaintTextFormat),K.angle?e.drawText({align:12,x:O,y:Math.round(I-2-K.size/5),width:0,height:0,text:a,latex:0}):e.drawText({x:Math.round(J+.1*(L-J)),y:Math.round(I-2-K.size),width:Math.round(.8*(L-J)),height:K.size,text:a,latex:0}))),Q&&null!==C&&(C+=(0===C.length?
"M":"L")+O+","+I),S&&I>=-N&&I<=b+V&&(null!==x&&(x+="M"+J+","+(I-N)+"h"+(L-J)+"v"+(N+V+1)+"h-"+(L-J)+"z"),null!==B&&(B+=e.markeratt.create(O,I)),null!==D&&(0<e.options.errorX&&(a=Math.round(O-(L-J)*e.options.errorX),D+="M"+(a+U)+","+I+F+"h"+(Math.round(O+(L-J)*e.options.errorX)-a-2*U)+F),D+="M"+O+","+(I-N+U)+Z+"v"+(N+V-2*U)+Z)))};for(G=m;G<=k;G+=q)if(h=n.GetBinCoord(G),!(d.logx&&0>=h)){var M=Math.round(d.grx(h));if((h=G>k-q)&&m<k)var H=E;else H=y.getBinContent(G+1),H=Math.round(d.gry(H));if(0===a.length){var P=
f=G;var X=w=v=M;var T=r=t=E=H;a="M"+v+","+E}else if(c)if(M!==v||h){if(S||l||Q)P===f?W(P):P<f?(W(P),W(f)):(W(f),W(P));S||r===t&&T===r||(X!==v&&(a+="h"+(v-X)),E===r?(t!==T&&(a+="v"+(t-T)),r!==t&&(a+="v"+(r-t))):(r!==T&&(a+="v"+(r-T)),t!==r&&(a+="v"+(t-r)),E!==t&&(a+="v"+(E-t))),X=v,T=E);h&&X!==M&&(a+="h"+(M-X));P=f=G;r=t=E=H;v=M}else H<r?f=G:H>t&&(P=G),r=Math.min(r,H),t=Math.max(t,H),E=H;else if(H!==E||h)M!==v&&(a+="h"+(M-v)),H!==E&&(a+="v"+(H-E)),E=H,v=M}k="";m=!JSROOT.batch_mode&&this.fillatt.empty()&&
g.Hist&&JSROOT.settings.Tooltip&&!S&&!Q;if(!this.fillatt.empty()||m)k=b+3,m&&(m=Math.round(d.gry(0)),0>=m?k=-3:m<b&&(k=m)),k="L"+v+","+k+"L"+w+","+k+"Z",0<a.length&&(a+=k);S||Q?(null!==x&&0<x.length&&this.draw_g.append("svg:path").attr("d",x).call(this.fillatt.func),null!==D&&0<D.length&&this.draw_g.append("svg:path").attr("d",D).call(this.lineatt.func),null!==C&&0<C.length&&(this.fillatt.empty()||this.draw_g.append("svg:path").attr("d",g.Fill?C+k:a).attr("stroke","none").call(this.fillatt.func),
this.draw_g.append("svg:path").attr("d",C).attr("fill","none").call(this.lineatt.func)),null!==B&&0<B.length&&this.draw_g.append("svg:path").attr("d",B).call(this.markeratt.func)):a&&g.Hist&&this.draw_g.append("svg:path").attr("d",a).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func);l&&this.finishTextDrawing()};l.prototype.getBinTooltips=function(a){var c=[],b=this.getObjectHint(),e=this.getFramePainter(),g=this.getHisto(),m=this.getAxis("x"),k=this.isDisplayItem()?
g.stepx:1,q=m.GetBinCoord(a),d=m.GetBinCoord(a+k);m=g.getBinContent(a+1);var y=this.getAxisBinTip("x",a,k);0<b.length&&c.push(b);this.options.Error||this.options.Mark?(c.push("x = "+y),c.push("y = "+e.axisAsText("y",m)),this.options.Error&&("["==y[0]&&c.push("error x = "+((d-q)/2).toPrecision(4)),c.push("error y = "+g.getBinError(a+1).toPrecision(4)))):(c.push("bin = "+a),c.push("x = "+y),g.$baseh&&(m-=g.$baseh.getBinContent(a+1)),a="entries = "+(1<k?"~":""),m===Math.round(m)?c.push(a+m):c.push(a+
u.floatToString(m,JSROOT.gStyle.fStatFormat)));return c};l.prototype.processTooltipEvent=function(a){function c(a){a=q.GetBinCoord(a);return e.logx&&0>=a?null:e.grx(a)}function b(a){a=k.getBinContent(a+1);return e.logy&&a<e.scale_ymin?e.swap_xy?-1E3:10*m:Math.round(e.gry(a))}if(!a||!this.draw_content||this.options.Mode3D||!this.draw_g)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var e=this.getFramePainter(),g=e.getFrameWidth(),m=e.getFrameHeight(),k=this.getHisto(),q=this.getAxis("x"),
d=null,y=!0,n,h,w=2,v=this.getSelectIndex("x","left",-1),E=this.getSelectIndex("x","right",2);var r=v;var t=E;for(var f=e.swap_xy?a.y:a.x,p=e.swap_xy?a.x:a.y;r<t-1;){d=Math.round(.5*(r+t));var A=c(d);null===A||A<f-.5?e.swap_xy?t=d:r=d:A>f+.5?e.swap_xy?r=d:t=d:(r++,t--)}d=t=r;A=c(d);if(e.swap_xy){for(;r>v&&c(r-1)<A+2;)--r;for(;t<E&&c(t+1)>A-2;)++t}else{for(;r>v&&c(r-1)>A-2;)--r;for(;t<E&&c(t+1)<A+2;)++t}if(r<t){A=m;for(y=r;y<=t;y++){var l=Math.abs(b(y)-p);l<A&&(A=l,d=y)}A>m/10&&(d=Math.round(r+(t-
r)/m*p));A=c(d)}A=Math.round(A);l=Math.round(c(d+1));this.options.Bar&&(r=l-A,A+=Math.round(this.options.BarOffset*r),l=A+Math.round(this.options.BarWidth*r));A>l&&(r=A,A=l,l=r);r=Math.round((A+l)/2);t=n=h=b(d);if(this.options.Bar)y=!0,w=0,n=Math.round(e.gry(!1!==this.options.BaseLine&&this.options.BaseLine>e.scale_ymin?this.options.BaseLine:e.scale_ymin)),n>h&&(g=n,n=h,h=g),!a.touch&&1===a.nproc&&(p<n||p>h)&&(d=null);else if(this.options.Error||this.options.Mark){y=!0;g=3;this.markeratt&&(g=Math.max(g,
this.markeratt.getFullSize()));if(this.options.Error){var u=k.getBinContent(d+1);h=k.getBinError(d+1);n=Math.round(e.gry(u+h));h=Math.round(e.gry(u-h));0==u&&this.isRProfile()&&(d=null);l=(l-A)*this.options.errorX;A=Math.round(r-l);l=Math.round(r+l)}l-A<2*g&&(A=r-g,l=r+g);n=Math.min(n,t-g);h=Math.max(h,t+g);!a.touch&&1===a.nproc&&(p<n||p>h)&&(d=null)}else if(this.options.Line)y=!1;else if(y=1===a.nproc&&E-v<g)h=m,this.fillatt.empty()||(h=Math.round(e.gry(0)),0>h?h=0:h>m&&(h=m),h<n&&(g=n,n=h,h=g)),
(a.y<n||a.y>h)&&!a.touch&&(d=null);null!==d&&(d===v&&A>f+w?d=null:d===E-1&&l<f-w?d=null:f<A-w||f>l+w?d=null:this.options.Zero||0!==k.getBinContent(d+1)||(d=null));w=this.draw_g.select(".tooltip_bin");if(null===d||0>=h||n>=m)return w.remove(),null;v={name:"histo",title:k.fTitle,x:r,y:t,exact:!0,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(d)};a.disabled?(w.remove(),v.changed=!0):y?(w.empty()&&(w=this.draw_g.append("svg:rect").attr("class",
"tooltip_bin h1bin").style("pointer-events","none")),v.changed=w.property("current_bin")!==d,v.changed&&w.attr("x",e.swap_xy?n:A).attr("width",e.swap_xy?h-n:l-A).attr("y",e.swap_xy?A:n).attr("height",e.swap_xy?l-A:h-n).style("opacity","0.3").property("current_bin",d),v.exact=5>=Math.abs(t-p)||p>=n&&p<=h,v.menu=!0,v.menu_dist=Math.sqrt((r-f)*(r-f)+(t-p)*(t-p))):(f=this.lineatt.width+3,w.empty()&&(w=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",
f).call(this.lineatt.func).call(this.fillatt.func)),v.exact=Math.abs(r-a.x)<=f&&Math.abs(t-a.y)<=f,v.menu=v.exact,v.menu_dist=Math.sqrt((r-a.x)*(r-a.x)+(t-a.y)*(t-a.y)),v.changed=w.property("current_bin")!==d,v.changed&&w.attr("cx",r).attr("cy",t).property("current_bin",d));v.changed&&(v.user_info={obj:k,name:"histo",bin:d,cont:k.getBinContent(d+1),grx:r,gry:t});return v};l.prototype.fillHistContextMenu=function(a){var c=this;a.add("Auto zoom-in",function(){return c.autoZoom()});var b=u.getDrawSettings("ROOT."+
this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",b.opts,function(a){if("inspect"===a)return c.showInspector();c.decodeOptions(a);c.options.need_fillcol&&c.fillatt&&c.fillatt.empty()&&c.fillatt.change(5,1001);c.interactiveRedraw("pad","drawopt")})};l.prototype.autoZoom=function(){var a=this.getSelectIndex("x","left",-1),c=this.getSelectIndex("x","right",1),b=c-a,e=this.getHisto(),g=this.getAxis("x");if(0!=b){for(var m=e.getBinContent(a+1),k=a;k<c;++k)m=Math.min(m,e.getBinContent(k+1));
if(!(0<m)){for(;a<c&&e.getBinContent(a+1)<=m;)++a;for(;a<c&&e.getBinContent(c)<=m;)--c;a===c-1&&2<a&&c<this.nbinsx-2&&(--a,++c);c-a<b&&a<c&&this.getFramePainter().zoom(g.GetBinCoord(a),g.GetBinCoord(c))}}};l.prototype.canZoomInside=function(a,c,b){var e=this.getAxis("x");return"x"==a&&1<e.FindBin(b,.5)-e.FindBin(c,0)||"y"==a&&Math.abs(b-c)>1E-6*Math.abs(this.ymax-this.ymin)?!0:!1};l.prototype.callDrawFunc=function(a){var c=this.getFramePainter();c&&c.mode3d!==this.options.Mode3D&&!this.isMainPainter()&&
(this.options.Mode3D=c.mode3d);return this[this.options.Mode3D?"draw3D":"draw2D"](a)};l.prototype.draw2D=function(a){var c=this;this.clear3DScene();return this.drawFrameAxes().then(function(b){return b?c.drawingBins(a):!1}).then(function(a){if(!a)return!1;c.draw1DBins();return c.addInteractivity()}).then(function(a){return a?c:null})};l.prototype.draw3D=function(a){var c=this;this.mode3d=!0;return JSROOT.require("v7hist3d").then(function(){return c.draw3D(a)})};l.prototype.redraw=function(a){this.callDrawFunc(a)};
var Y=function(a,c,b){var e=new l(a,c);return u.ensureRCanvas(e).then(function(){e.setAsMainPainter();e.options={Hist:!1,Bar:!1,BarStyle:0,Error:!1,ErrorKind:-1,errorX:JSROOT.gStyle.fErrorX,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!1,TextAngle:0,TextKind:"",AutoColor:0,BarOffset:0,BarWidth:1,BaseLine:!1,Mode3D:!1};var a=new JSROOT.DrawOptions(b);a.check("R3D_",!0)&&(e.options.Render3D=JSROOT.constants.Render3D.fromString(a.part.toLowerCase()));a=e.v7EvalAttr("kind","hist");var c=e.v7EvalAttr("sub",
0),k=e.options;k.Text=e.v7EvalAttr("text",!1);k.BarOffset=e.v7EvalAttr("bar_offset",0);k.BarWidth=e.v7EvalAttr("bar_width",1);switch(a){case "bar":k.Bar=!0;k.BarStyle=c;break;case "err":k.Error=!0;k.ErrorKind=c;break;case "p":k.Mark=!0;break;case "l":k.Line=!0;break;case "lego":k.Lego=0<c?10+c:12;k.Mode3D=!0;break;default:k.Hist=!0}e.scanContent();return e.callDrawFunc()})};z.prototype=Object.create(f.prototype);z.prototype.cleanup=function(){delete this.tt_handle;f.prototype.cleanup.call(this)};
z.prototype.getDimension=function(){return 2};z.prototype.toggleProjection=function(a,c){var b=this;"Projections"==a&&(a="");"string"==typeof a&&1<a.length&&(c=parseInt(a.substr(1)),a=a[0]);c||(c=1);if(a&&this.is_projection==a)if(this.projection_width===c)a="";else{this.projection_width=c;return}delete this.proj_hist;var e=this.is_projection===a?"":a;this.is_projection="";this.projection_width=c;(a=this.getCanvPainter())&&a.toggleProjection(this.is_projection).then(function(){return b.redrawProjection("toggling",
e)})};z.prototype.redrawProjection=function(a,c){"toggling"===a&&(this.is_projection=c)};z.prototype.executeMenuCommand=function(a,c){return f.prototype.executeMenuCommand.call(this,a,c)?!0:"SetShowProjectionX"==a.fName||"SetShowProjectionY"==a.fName?(this.toggleProjection(a.fName[17],c&&parseInt(c)?parseInt(c):1),!0):!1};z.prototype.fillHistContextMenu=function(a){var c=this;a.add("sub:Projections",function(){return c.toggleProjection()});var b=this.is_projection||"";b&&(b+=this.projection_width);
for(var e="X1 X2 X3 X5 X10 Y1 Y2 Y3 Y5 Y10".split(" "),g=0;g<e.length;++g)a.addchk(b==e[g],e[g],e[g],function(a){return c.toggleProjection(a)});a.add("endsub:");a.add("Auto zoom-in",function(){return c.autoZoom()});b=u.getDrawSettings("ROOT."+this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",b.opts,function(a){if("inspect"===a)return c.showInspector();c.decodeOptions(a);c.interactiveRedraw("pad","drawopt")});this.options.Color&&this.fillPaletteMenu(a)};z.prototype.clickButton=function(a){if(f.prototype.clickButton.call(this,
a))return!0;switch(a){case "ToggleColor":this.toggleColor();break;case "ToggleColorZ":this.toggleColz();break;case "Toggle3D":this.toggleMode3D();break;default:return!1}return!0};z.prototype.fillToolbar=function(){f.prototype.fillToolbar.call(this,!0);var a=this.getPadPainter();a&&(this.isRH2Poly()||a.addPadButton("th2color","Toggle color","ToggleColor"),a.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),a.addPadButton("th2draw3d","Toggle 3D mode","Toggle3D"),a.showPadButtons())};z.prototype.toggleColor=
function(){this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=!this.options.Color;this._can_move_colz=!0;this.redraw()};z.prototype.autoZoom=function(){if(!this.isRH2Poly()){var a=this.getSelectIndex("x","left",-1),c=this.getSelectIndex("x","right",1),b=this.getSelectIndex("y","left",-1),e=this.getSelectIndex("y","right",1),g,m,k=this.getHisto(),q=this.getAxis("x"),d=this.getAxis("y");if(a!=c&&b!=e){var y=k.getBinContent(a+1,b+1);for(g=a;g<c;++g)for(m=b;m<e;++m)y=
Math.min(y,k.getBinContent(g+1,m+1));if(!(0<y)){var n=c,h=a,w=e,v=b;for(g=a;g<c;++g)for(m=b;m<e;++m)k.getBinContent(g+1,m+1)>y&&(g<n&&(n=g),g>=h&&(h=g+1),m<w&&(w=m),m>=v&&(v=m+1));g=!1;n===h-1&&n>a+1&&h<c-1&&(n--,h++);w===v-1&&w>b+1&&v<e-1&&(w--,v++);if((n>a||h<c)&&n<h-1){var E=q.GetBinCoord(n);var r=q.GetBinCoord(h);g=!0}if((w>b||v<e)&&w<v-1){var t=d.GetBinCoord(w);var f=d.GetBinCoord(v);g=!0}g&&this.getFramePainter().zoom(E,r,t,f)}}}};z.prototype.scanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy)){var c;
a=this.getHisto();this.extractAxesProperties(2);if(this.isRH2Poly()){this.gminposbin=null;var b=this.gminbin=this.gmaxbin=0;for(c=a.fBins.arr.length;b<c;++b){var e=a.fBins.arr[b].fContent;0===b&&(this.gminbin=this.gmaxbin=e);e<this.gminbin?this.gminbin=e:e>this.gmaxbin&&(this.gmaxbin=e);0<e&&(null===this.gminposbin||this.gminposbin>e)&&(this.gminposbin=e)}}else if(this.isDisplayItem())this.gminbin=a.fContMin,this.gminposbin=0<a.fContMinPos?a.fContMinPos:null,this.gmaxbin=a.fContMax;else for(this.gminbin=
this.gmaxbin=a.getBinContent(1,1),this.gminposbin=null,b=0;b<this.nbinsx;++b)for(c=0;c<this.nbinsy;++c)e=a.getBinContent(b+1,c+1),e<this.gminbin?this.gminbin=e:e>this.gmaxbin&&(this.gmaxbin=e),0<e&&(null===this.gminposbin||this.gminposbin>e)&&(this.gminposbin=e);this.zmin=this.gminbin;this.zmax=this.gmaxbin;null===this.gminposbin&&(this.gminposbin=1E-4*this.gmaxbin);0<this.options.Axis?this.draw_content=!1:(this.draw_content=0<this.gmaxbin,!this.draw_content&&this.options.Zero&&this.isRH2Poly()&&
(this.draw_content=!0,this.options.Line=1))}};z.prototype.countStat=function(a){var c=this.getHisto(),b=0,e=0,g=0,m=0,k=0,q={name:"histo",entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null},d=this.getSelectIndex("x","left"),y=this.getSelectIndex("x","right"),n=this.getSelectIndex("y","left"),h=this.getSelectIndex("y","right"),w,v,f=this.getAxis("x"),r=this.getAxis("y");for(w=1;w<=this.nbinsx;++w){var t=w<=d+1?0:w>y+1?2:1;var p=f.GetBinCoord(w-.5);
for(v=1;v<=this.nbinsy;++v){var l=v<=n+1?0:v>h+1?2:1;var A=r.GetBinCoord(v-.5);var u=c.getBinContent(w,v);q.entries+=u;q.matrix[3*l+t]+=u;if(1==t&&1==l&&(null==a||a(p,A))){if(null==q.wmax||u>q.wmax)q.wmax=u,q.xmax=p,q.ymax=A;b+=u;e+=p*u;g+=A*u;m+=p*p*u;k+=A*A*u}}}0<b&&(q.meanx=e/b,q.meany=g/b,q.rmsx=Math.sqrt(Math.abs(m/b-q.meanx*q.meanx)),q.rmsy=Math.sqrt(Math.abs(k/b-q.meany*q.meany)));null===q.wmax&&(q.wmax=0);q.integral=b;return q};z.prototype.fillStatistic=function(a,c){var b=this.countStat(),
e=Math.floor(c%10),g=Math.floor(c/10)%10,m=Math.floor(c/100)%10,k=Math.floor(c/1E3)%10,q=Math.floor(c/1E4)%10,d=Math.floor(c/1E5)%10,y=Math.floor(c/1E6)%10,n=Math.floor(c/1E7)%10;c=Math.floor(c/1E8)%10;a.clearStat();0<e&&a.addText(b.name);0<g&&a.addText("Entries = "+a.format(b.entries,"entries"));0<m&&(a.addText("Mean x = "+a.format(b.meanx)),a.addText("Mean y = "+a.format(b.meany)));0<k&&(a.addText("Std Dev x = "+a.format(b.rmsx)),a.addText("Std Dev y = "+a.format(b.rmsy)));0<y&&a.addText("Integral = "+
a.format(b.matrix[4],"entries"));0<n&&(a.addText("Skewness x = <undef>"),a.addText("Skewness y = <undef>"));0<c&&a.addText("Kurt = <undef>");if(0<q||0<d)b=b.matrix,a.addText(""+b[6].toFixed(0)+" | "+b[7].toFixed(0)+" | "+b[7].toFixed(0)),a.addText(""+b[3].toFixed(0)+" | "+b[4].toFixed(0)+" | "+b[5].toFixed(0)),a.addText(""+b[0].toFixed(0)+" | "+b[1].toFixed(0)+" | "+b[2].toFixed(0));return!0};z.prototype.drawBinsColor=function(){var a=this.getHisto(),c=this.prepareDraw(),b=[],e=[],g=[],m,k,q=c.stepi,
d=c.stepj;for(m=c.i1;m<c.i2;m+=q)for(k=c.j1;k<c.j2;k+=d){var y=a.getBinContent(m+1,k+1);var n=c.palette.getContourIndex(y);if(0===y){if(!this.options.Zero)continue;null===n&&this._show_empty_bins&&(n=0)}if(null!==n){y="M"+c.grx[m]+","+c.gry[k+d];if(void 0===b[n])b[n]=y;else{var h="m"+(c.grx[m]-e[n])+","+(c.gry[k+d]-g[n]);b[n]+=h.length<y.length?h:y}e[n]=c.grx[m];g[n]=c.gry[k+d];y=c.grx[m+q]-c.grx[m]||1;h=c.gry[k]-c.gry[k+d]||1;b[n]+="v"+h+"h"+y+"v"+-h+"z"}}for(n=0;n<b.length;++n)void 0!==b[n]&&this.draw_g.append("svg:path").attr("palette-index",
n).attr("fill",c.palette.getColor(n)).attr("d",b[n]);this.updatePaletteDraw();return c};z.prototype.buildContour=function(a,c,b,e){function g(a){for(var b=0;b<c.length;++b)if(a<c[b])return b-1;return c.length-1}function m(a,b,e,g,k,h,m,f){var w=e===m;m=w?f-g:m-e;b+=1;k-=a;f=n-1;for(var v=999+n,r=0,t;b<=h&&f<=v;)t=c[b],t-=a,t/=k,t*=m,w?(q[f]=e,d[f]=g+t):(q[f]=e+t,d[f]=g),y[f]=b,r++,f+=2,b++;return r}var k=this.getHisto(),q=new Float32Array(4008),d=new Float32Array(4008),y=new Int32Array(4008),n=0;
b=[];var h=0,w=[0,0,0,0],v=[0,0,0,0],f=[0,0,0,0],r=[0,0,0,0],t,p,l,A,u=a.stepi,x=a.stepj,z=a.original?a.origx:a.grx,C=a.original?a.origy:a.gry;for(p=a.j1;p<a.j2-x;p+=x)for(v[1]=v[0]=(C[p]+C[p+x])/2,v[3]=v[2]=(C[p+x]+C[p+2*x])/2,t=a.i1;t<a.i2-u;t+=u){f[0]=k.getBinContent(t+1,p+1);f[1]=k.getBinContent(t+1+u,p+1);f[2]=k.getBinContent(t+1+u,p+1+x);f[3]=k.getBinContent(t+1,p+1+x);for(l=0;4>l;l++)r[l]=g(f[l]);if(r[0]!==r[1]||r[1]!==r[2]||r[2]!==r[3]||r[3]!==r[0]){w[3]=w[0]=(z[t]+z[t+1])/2;w[2]=w[1]=(z[t+
1]+z[t+2])/2;var D=f[0]<=f[1]?0:1;var B=f[2]<=f[3]?2:3;f[D]>f[B]&&(D=B);D++;for(l=n=1;4>=l;l++)B=D%4+1,D=m(f[D-1],r[D-1],w[D-1],v[D-1],f[B-1],r[B-1],w[B-1],v[B-1]),n+=2*D,D=B;D=f[0]<=f[1]?0:1;B=f[2]<=f[3]?2:3;f[D]>f[B]&&(D=B);D++;n=2;for(l=1;4>=l;l++)B=1==D?4:D-1,D=m(f[D-1],r[D-1],w[D-1],v[D-1],f[B-1],r[B-1],w[B-1],v[B-1]),n+=2*D,D=B;B=0;for(l=1;l<=n-5;l+=2)for(;y[l-1]!=y[l];){D=q[l];var F=d[l];var Y=y[l];for(A=l;A<=n-5;A+=2)q[A]=q[A+2],d[A]=d[A+2],y[A]=y[A+2];q[n-3]=D;d[n-3]=F;y[n-3]=Y;if(2E3<B)break;
B++}if(!(2E3<B))for(l=1;l<=n-2;l+=2)B=y[l-1],0<=B&&B<c.length&&((D=b[B])||(D=b[B]=JSROOT.createTPolyLine(8016,!0)),B=D.fLastPoint,B<D.fN-2&&(D.fX[B+1]=Math.round(q[l-1]),D.fY[B+1]=Math.round(d[l-1]),D.fX[B+2]=Math.round(q[l]),D.fY[B+2]=Math.round(d[l]),D.fLastPoint=B+2,h=Math.max(h,D.fLastPoint+1)))}}a=new Int32Array(c.length);for(B=t=0;B<c.length;B++)if(0<=c[B]){t=B;break}l=0;for(B=t-1;0<=B;B--)a[l]=B,l++;for(B=t;B<c.length;B++)a[l]=B,l++;k=new Float32Array(2*h);w=new Float32Array(2*h);for(l=0;l<
c.length;++l)if(B=a[l],D=b[B])for(v=B,f=D.fX,r=D.fY,p=D.fLastPoint+1,u=0,C=z=x=void 0;;){x=h;z=x+1;k[x]=f[u];w[x]=r[u];k[z]=f[u+1];w[z]=r[u+1];f[u]=f[u+1]=0;for(r[u]=r[u+1]=0;;){C=0;for(t=2;t<p;t+=2)z<2*h-1&&f[t]===k[z]&&r[t]===w[z]&&(z++,k[z]=f[t+1],w[z]=r[t+1],f[t]=f[t+1]=0,r[t]=r[t+1]=0,C++),0<x&&f[t+1]===k[x]&&r[t+1]===w[x]&&(x--,k[x]=f[t],w[x]=r[t],f[t]=f[t+1]=0,r[t]=r[t+1]=0,C++);if(0==C)break}x+1<z&&0<=x&&e(v,k,w,x,z,B);u=0;for(t=2;t<p;t+=2)if(0!==f[t]&&0!==r[t]){u=t;break}if(0===u)break}};
z.prototype.drawBinsContour=function(a,c){var b=this,e=this.prepareDraw({rounding:!1,extra:100,original:0!=this.options.Proj}),g=this.getFramePainter(),m=g.getHistPalette(),k=m.getContour(),q=g.getProjectionFunc(),d=function(a,b,c,d,e){for(var k="",m,h,f,n=c;n<=d;++n){q?(c=q(a[n],b[n]),c.x=Math.round(g.grx(c.x)),c.y=Math.round(g.gry(c.y))):c={x:Math.round(a[n]),y:Math.round(b[n])};if(k)if(n==d&&h&&c.x==h.x&&c.y==h.y){if(!f)return"";k+="z";e=!1}else c.x!=m.x&&c.y!=m.y?(k+="l"+(c.x-m.x)+","+(c.y-m.y),
f=!0):c.x!=m.x?(k+="h"+(c.x-m.x),f=!0):c.y!=m.y&&(k+="v"+(c.y-m.y),f=!0);else k="M"+c.x+","+c.y,h=c;m=c}e&&(k+="z");return k};if(14===this.options.Contour){a="M0,0h"+a+"v"+c+"h-"+a+"z";if(this.options.Proj){a=e.stepj;c=parseInt((e.j2-e.j1)/a);for(var f=new Float32Array(2*c),n=new Float32Array(2*c),h=0;h<c;++h)f[h]=e.origx[e.i1],n[h]=(e.origy[e.j1]*(h*a+.5)+e.origy[e.j2]*(c-.5-h*a))/c,f[h+c]=e.origx[e.i2],n[h+c]=(e.origy[e.j2]*(h*a+.5)+e.origy[e.j1]*(c-.5-h*a))/c;a=d(f,n,0,2*c-1,!0)}this.draw_g.append("svg:path").attr("d",
a).style("stroke","none").style("fill",m.getColor(0))}this.buildContour(e,k,m,function(a,c,e,g,k){var h=m.getColor(a),q=h;switch(b.options.Contour){case 11:q="none";var n=new JSROOT.TAttLineHandler({color:h});break;case 12:q="none";n=new JSROOT.TAttLineHandler({color:1,style:a%5+1,width:1});break;case 13:q="none",n=b.lineatt}if(a=d(c,e,g,k,"none"!=q))q=b.draw_g.append("svg:path").attr("class","th2_contour").attr("d",a).style("fill",q),n?q.call(n.func):q.style("stroke","none")});e.hide_only_zeros=
!0;return e};z.prototype.createPolyBin=function(a,c,b){function e(a,b,e,d){var g=Math.sqrt((a-e)*(a-e)+(b-d)*(b-d));c._sumx+=(a+e)*g/2;c._sumy+=(b+d)*g/2;c._suml+=g}var g="",m,k=1,q=null;"TMultiGraph"==c.fPoly._typename?k=c.fPoly.fGraphs.arr.length:q=c.fPoly;b&&(c._sumx=c._sumy=c._suml=0);for(m=0;m<k;++m){if(!q||0<m)q=c.fPoly.fGraphs.arr[m];var d=q.fNpoints,f=void 0,n=q.fX,h=q.fY,w=Math.round(a.grx(n[0])),v=Math.round(a.gry(h[0])),l=void 0,r=void 0;2<d&&n[0]==n[d-1]&&h[0]==h[d-1]&&d--;g+="M"+w+","+
v;for(f=1;f<d;++f){l=Math.round(a.grx(n[f]));r=Math.round(a.gry(h[f]));b&&e(w,v,l,r);if(w!==l||v!==r)g=w===l?g+("v"+(r-v)):v===r?g+("h"+(l-w)):g+("l"+(l-w)+","+(r-v));w=l;v=r}b&&e(w,v,Math.round(a.grx(n[0])),Math.round(a.gry(h[0])));g+="z"}b&&(0<c._suml?(c._midx=Math.round(c._sumx/c._suml),c._midy=Math.round(c._sumy/c._suml)):(c._midx=Math.round(a.grx((c.fXmin+c.fXmax)/2)),c._midy=Math.round(a.gry((c.fYmin+c.fYmax)/2))));return g};z.prototype.DrawPolyBinsColor=function(){var a=this.getHisto(),c=this.getFramePainter(),
b=[],e=[],g,m=a.fBins.arr.length,k=c.getHistPalette();this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;this.createContour(c,k);for(g=0;g<m;++g){var q=a.fBins.arr[g];var d=k.getContourIndex(q.fContent);if(null!==d){if(0===q.fContent){if(!this.options.Zero||!this.options.Line)continue;d=0}if(!(q.fXmin>c.scale_xmax||q.fXmax<c.scale_xmin||q.fYmin>c.scale_ymax||q.fYmax<c.scale_ymin)){var f=this.createPolyBin(c,q,this.options.Text&&q.fContent);b[d]=void 0===b[d]?f:b[d]+f;
this.options.Text&&e.push(q)}}}for(d=0;d<b.length;++d)b[d]&&(q=this.draw_g.append("svg:path").attr("palette-index",d).attr("fill",d?k.getColor(d):"none").attr("d",b[d]),this.options.Line&&q.call(this.lineatt.func));if(0<e.length){q=this.v7EvalFont("text",{size:12,color:"black",align:22});b=this.draw_g.append("svg:g").attr("class","th2poly_text");this.startTextDrawing(q,"font",b);for(g=0;g<e.length;++g)q=e[g],d="",this.options.TextKind?(q.fPoly&&(d=q.fPoly.fName),"Graph"===d&&(d=""),d||(d=q.fNumber)):
d=Math.round(q.fContent)===q.fContent?q.fContent.toString():u.floatToString(q.fContent,JSROOT.gStyle.fPaintTextFormat),this.drawText({x:q._midx,y:q._midy,text:d,latex:0,draw_g:b});this.finishTextDrawing(b)}return{poly:!0}};z.prototype.drawBinsText=function(a){var c=this.getHisto(),b,e;null===a&&(a=this.prepareDraw({rounding:!1}));var g=this.v7EvalFont("text",{size:20,color:"black",align:22}),m=0,k=this.draw_g.append("svg:g").attr("class","th2_text"),q=a.stepi,d=a.stepj,f="E"==this.options.TextKind&&
this.matchObjectType("TProfile2D")&&"function"==typeof c.getBinEntries;this.options.BarOffset&&(m=this.options.BarOffset);this.startTextDrawing(g,"font",k);for(b=a.i1;b<a.i2;b+=q)for(e=a.j1;e<a.j2;e+=d){var n=c.getBinContent(b+1,e+1);if(0!==n||this._show_empty_bins){var h=a.grx[b+q]-a.grx[b];var w=a.gry[e]-a.gry[e+d];f&&(n=c.getBinEntries(b+1,e+1));n=n===Math.round(n)?n.toString():u.floatToString(n,JSROOT.gStyle.fPaintTextFormat);if(g.angle){var l=Math.round(a.grx[b]+.5*h);var p=Math.round(a.gry[e+
d]+w*(.5+m));w=h=0}else l=Math.round(a.grx[b]+.1*h),p=Math.round(a.gry[e+d]+w*(.1+m)),h=Math.round(.8*h),w=Math.round(.8*w);this.drawText({align:22,x:l,y:p,width:h,height:w,text:n,latex:0,draw_g:k})}}this.finishTextDrawing(k);a.hide_only_zeros=!0;return a};z.prototype.drawBinsArrow=function(){for(var a=this.getHisto(),c="",b,e,g=1E-30,m,k,q,d,f,n,h=this.prepareDraw({rounding:!1}),w=(h.grx[h.i2]-h.grx[h.i1])/(h.i2-h.i1+1-.03)/2,l=(h.gry[h.j2]-h.gry[h.j1])/(h.j2-h.j1+1-.03)/2,p=h.stepi,r=h.stepj,t=
0;2>t;++t)for(b=h.i1;b<h.i2;b+=p)for(e=h.j1;e<h.j2;e+=r)if(m=b===h.i1?a.getBinContent(b+1+p,e+1)-a.getBinContent(b+1,e+1):b>=h.i2-p?a.getBinContent(b+1,e+1)-a.getBinContent(b+1-p,e+1):.5*(a.getBinContent(b+1+p,e+1)-a.getBinContent(b+1-p,e+1)),k=e===h.j1?a.getBinContent(b+1,e+1+r)-a.getBinContent(b+1,e+1):e>=h.j2-r?a.getBinContent(b+1,e+1)-a.getBinContent(b+1,e+1-r):.5*(a.getBinContent(b+1,e+1+r)-a.getBinContent(b+1,e+1-r)),0===t)g=Math.max(g,Math.abs(m),Math.abs(k));else if(q=(h.grx[b]+h.grx[b+p])/
2,d=(h.gry[e]+h.gry[e+r])/2,f=w*m/g,m=l*k/g,n=q-f,k=q+f,q=d-m,d+=m,m=Math.round(k-n),k=Math.round(d-q),0!==m||0!==k)if(c+="M"+Math.round(n)+","+Math.round(q)+"l"+m+","+k,5<Math.abs(m)||5<Math.abs(k))d=Math.sqrt(2/(m*m+k*k)),n=Math.round(d*(m+k)),m=Math.round(d*(m-k)),0!==n&&0!==m&&(c+="l"+-n+","+m+"m"+n+","+-m+"l"+-m+","+-n);this.draw_g.append("svg:path").attr("class","th2_arrows").attr("d",c).style("fill","none").call(this.lineatt.func);return h};z.prototype.drawBinsBox=function(){var a=this.getHisto(),
c=this.prepareDraw({rounding:!1}),b=this.getFramePainter();b.maxbin===b.minbin&&(b.maxbin=this.gmaxbin,b.minbin=this.gminbin,b.minposbin=this.gminposbin);b.maxbin===b.minbin&&(b.minbin=Math.min(0,b.maxbin-1));var e=Math.max(Math.abs(b.maxbin),Math.abs(b.minbin)),g=Math.max(0,b.minbin),m="",k="",q="",d="",f=!1,n=0,h=c.stepi,w=c.stepj;if(b.logz&&0<e){f=!0;e=Math.log(e);n=0<g?Math.log(g):1<=b.minposbin&&100>b.minposbin?Math.log(.7):0<b.minposbin?Math.log(.7*b.minposbin):e-10;n>=e&&(n=e-10);var l=1/(e-
n)}else l=1/(e-g);for(b=c.i1;b<c.i2;b+=h)for(e=c.j1;e<c.j2;e+=w){var u=a.getBinContent(b+1,e+1);var r=Math.abs(u);if(!(0===r||r<g)){var t=f?0<r?Math.log(r)-n:0:r-g;t=.5*(0>t?1:1-Math.sqrt(t*l));0>t&&(t=0);r=c.grx[b+h]-c.grx[b];var x=c.gry[e]-c.gry[e+w];var z=t*r;var A=t*x;t=Math.round(c.grx[b]+z);var C=Math.round(c.gry[e+w]+A);r=Math.max(Math.round(r-2*z),1);x=Math.max(Math.round(x-2*A),1);m+="M"+t+","+C+"v"+x+"h"+r+"v-"+x+"z";0>u&&10===this.options.BoxStyle&&(k+="M"+t+","+C+"l"+r+","+x+"M"+(t+r)+
","+C+"l-"+r+","+x);if(11===this.options.BoxStyle&&5<r&&5<x){A=Math.round(.1*r);var F=Math.round(.1*x);z="M"+t+","+C+"h"+r+"l"+-A+","+F+"h"+(2*A-r)+"v"+(x-2*F)+"l"+-A+","+F+"z";r="M"+(t+r)+","+(C+x)+"v"+-x+"l"+-A+","+F+"v"+(x-2*F)+"h"+(2*A-r)+"l"+-A+","+F+"z";0>u?(d+=z,q+=r):(q+=z,d+=r)}}}0<m.length&&(a=this.draw_g.append("svg:path").attr("d",m).call(this.fillatt.func),11!==this.options.BoxStyle&&this.fillatt.empty()?a.call(this.lineatt.func):a.style("stroke","none"));0<q.length&&"none"!==this.fillatt.color&&
this.draw_g.append("svg:path").attr("d",q).style("stroke","none").call(this.fillatt.func).style("fill",p.rgb(this.fillatt.color).brighter(.5).toString());0<d.length&&this.draw_g.append("svg:path").attr("d",d).style("stroke","none").call(this.fillatt.func).style("fill","none"===this.fillatt.color?"red":p.rgb(this.fillatt.color).darker(.5).toString());0<k.length&&(k=this.draw_g.append("svg:path").attr("d",k).style("fill","none"),"none"!==this.lineatt.color?k.call(this.lineatt.func):k.style("stroke",
"black"));return c};z.prototype.drawBinsCandle=function(a){var c=this.getHisto(),b=this.getAxis("y"),e=this.prepareDraw(),g=this.getFramePainter(),m,k,q,d,f="",n="";this.createv7AttMarker();this.markeratt.resetPos();e.candle=[];for(m=e.i1;m<e.i2;++m){for(a=q=d=k=0;a<this.nbinsy;++a)d+=c.getBinContent(m+1,a+1);var h={bin:m,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(a=0;a<this.nbinsy;++a){var l=c.getBinContent(m+1,a+1);var p=b.GetBinCoord(a+.5);.001>q/d&&.001<=(q+l)/d&&(h.whiskerm=
p);.25>q/d&&.25<=(q+l)/d&&(h.m25y=p);.5>q/d&&.5<=(q+l)/d&&(h.median=p);.75>q/d&&.75<=(q+l)/d&&(h.p25y=p);.999>q/d&&.999<=(q+l)/d&&(h.whiskerp=p);q+=l;k+=l*p}0<q&&(h.meany=k/q);h.iqr=h.p25y-h.m25y;h.m25y-1.5*h.iqr>h.whsikerm&&(h.whiskerm=h.m25y-1.5*h.iqr);h.p25y+1.5*h.iqr<h.whiskerp&&(h.whiskerp=h.p25y+1.5*h.iqr);if(!(g.logy&&0>=h.whiskerm)){a=e.grx[m+1]-e.grx[m];a*=.66;k=(e.grx[m+1]+e.grx[m])/2+this.options.BarOffset*a;0<this.options.BarWidth&&(a*=this.options.BarWidth);h.x1=Math.round(k-a/2);h.x2=
Math.round(k+a/2);k=Math.round(k);h.y0=Math.round(g.gry(h.median));f+="M"+h.x1+","+h.y0+"h"+(h.x2-h.x1);h.y1=Math.round(g.gry(h.p25y));h.y2=Math.round(g.gry(h.m25y));f+="M"+h.x1+","+h.y1+"v"+(h.y2-h.y1)+"h"+(h.x2-h.x1)+"v-"+(h.y2-h.y1)+"z";h.yy1=Math.round(g.gry(h.whiskerp));h.yy2=Math.round(g.gry(h.whiskerm));f+="M"+k+","+h.y1+"v"+(h.yy1-h.y1);f+="M"+h.x1+","+h.yy1+"h"+(h.x2-h.x1);f+="M"+k+","+h.y2+"v"+(h.yy2-h.y2);f+="M"+h.x1+","+h.yy2+"h"+(h.x2-h.x1);for(a=0;a<this.nbinsy;++a)l=c.getBinContent(m+
1,a+1),p=b.GetBinCoord(a+.5),0<l&&p<h.whiskerm&&(n+=this.markeratt.create(k,p)),0<l&&p>h.whiskerp&&(n+=this.markeratt.create(k,p));e.candle.push(h)}}0<f.length&&this.draw_g.append("svg:path").attr("d",f).call(this.lineatt.func).call(this.fillatt.func);0<n.length&&this.draw_g.append("svg:path").attr("d",n).call(this.markeratt.func);return e};z.prototype.drawBinsScatter=function(){var a=this.getHisto(),c=this.prepareDraw({rounding:!0,pixel_density:!0,scatter_plot:!0}),b=[],e=[],g=[],m=[],k=[],q,d,f=
1;var n=this.options.ScatCoef*(2E3<this.gmaxbin?2E3/this.gmaxbin:1);var h=c.stepi,l=c.stepj;JSROOT.seed(c.sumz);if(1E5>n*c.sumz){this.createv7AttMarker();this.markeratt.resetPos();b="";for(q=c.i1;q<c.i2;q+=h){var p=c.grx[q+h]-c.grx[q];for(d=c.j1;d<c.j2;d+=l){var u=c.gry[d]-c.gry[d+l];var r=a.getBinContent(q+1,d+1);k=Math.round(n*r);if(!(0>=k))for(m=0;m<k;++m)b+=this.markeratt.create(Math.round(c.grx[q]+p*JSROOT.random()),Math.round(c.gry[d+1]+u*JSROOT.random()))}}this.draw_g.append("svg:path").attr("d",
b).call(this.markeratt.func);return c}.7<this.maxbin&&(f=.7/this.maxbin);for(q=c.i1;q<c.i2;q+=h)for(d=c.j1;d<c.j2;d+=l)if(r=a.getBinContent(q+1,d+1),!(0>=r||r<this.minbin||(p=c.grx[q+h]-c.grx[q],u=c.gry[d]-c.gry[d+l],0>=p*u||(n=c.palette.getContourIndex(r/p/u),0>n)))){r="M"+c.grx[q]+","+c.gry[d+l];if(void 0===b[n])b[n]=r,m[n]=p,k[n]=u;else{var t="m"+(c.grx[q]-e[n])+","+(c.gry[d+l]-g[n]);b[n]+=t.length<r.length?t:r;m[n]=Math.max(m[n],p);k[n]=Math.max(k[n],u)}e[n]=c.grx[q];g[n]=c.gry[d+l];b[n]+="v"+
u+"h"+p+"v-"+u+"z"}n=this.getFrameSvg().select(".main_layer");a=n.select("defs");a.empty()&&0<b.length&&(a=n.insert("svg:defs",":first-child"));this.createv7AttMarker();q=c.palette.getContour();for(n=0;n<b.length;++n)if(void 0!==b[n]&&n<q.length){p="scatter_"+n;d=a.select("."+p);d.empty()?d=a.append("svg:pattern").attr("class",p).attr("id","jsroot_scatter_pattern_"+JSROOT._.id_counter++).attr("patternUnits","userSpaceOnUse"):d.selectAll("*").remove();p=Math.round(f*q[n]*m[n]*k[n]);1>p&&(p=1);u=new Float32Array(p);
h=new Float32Array(p);if(1===p)u[0]=h[0]=.5;else for(l=0;l<p;++l)u[l]=JSROOT.random(),h[l]=JSROOT.random();this.markeratt.resetPos();l="";for(e=0;e<p;++e)l+=this.markeratt.create(u[e]*m[n],h[e]*k[n]);d.attr("width",m[n]).attr("height",k[n]).append("svg:path").attr("d",l).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",n).attr("fill","url(#"+d.attr("id")+")").attr("d",b[n])}return c};z.prototype.draw2DBins=function(){if(!this.draw_content)return this.removeG();this.createHistDrawAttributes();
this.createG(!0);var a=this.getFramePainter().getFrameRect(),c=null;this.isRH2Poly()?c=this.DrawPolyBinsColor():(this.options.Scat?c=this.drawBinsScatter():this.options.Color?c=this.drawBinsColor():this.options.Box?c=this.drawBinsBox():this.options.Arrow?c=this.drawBinsArrow():0<this.options.Contour?c=this.drawBinsContour(a.width,a.height):this.options.Candle&&(c=this.drawBinsCandle(a.width)),this.options.Text&&(c=this.drawBinsText(c)),c||(c=this.drawBinsColor()));this.tt_handle=c};z.prototype.getBinTooltips=
function(a,c){var b=[],e=this.getHisto(),g=e.getBinContent(a+1,c+1),m=1,k=1;this.isDisplayItem()&&(m=e.stepx||1,k=e.stepy||1);b.push(this.getObjectHint()||"histo<2>");b.push("x = "+this.getAxisBinTip("x",a,m));b.push("y = "+this.getAxisBinTip("y",c,k));b.push("bin = "+a+", "+c);e.$baseh&&(g-=e.$baseh.getBinContent(a+1,c+1));a="entries = "+(1<m||1<k?"~":"");g===Math.round(g)?b.push(a+g):b.push(a+u.floatToString(g,JSROOT.gStyle.fStatFormat));return b};z.prototype.getCandleTooltips=function(a){var c=
[],b=this.getFramePainter(),e=this.getAxis("y");c.push(this.getObjectHint()||"histo");c.push("x = "+b.axisAsText("x",e.GetBinCoord(a.bin)));c.push("mean y = "+u.floatToString(a.meany,JSROOT.gStyle.fStatFormat));c.push("m25 = "+u.floatToString(a.m25y,JSROOT.gStyle.fStatFormat));c.push("p25 = "+u.floatToString(a.p25y,JSROOT.gStyle.fStatFormat));return c};z.prototype.getPolyBinTooltips=function(a,c,b){a=this.getHisto().fBins.arr[a];var e=this.getFramePainter(),g=a.fPoly.fName,m=[],k=0;"Graph"===g&&(g=
"");0===g.length&&(g=a.fNumber);if(void 0===c&&void 0===b){c=b=0;var f=a.fPoly,d=1;"TMultiGraph"===f._typename&&(d=a.fPoly.fGraphs.arr.length,f=null);for(var l=0;l<d;++l){if(!f||0<l)f=a.fPoly.fGraphs.arr[l];for(var n=0;n<f.fNpoints;++n)++k,c+=f.fX[n],b+=f.fY[n]}1<k&&(c/=k,b/=k)}m.push(this.getObjectHint()||"histo");m.push("x = "+e.axisAsText("x",c));m.push("y = "+e.axisAsText("y",b));0<k&&m.push("npnts = "+k);m.push("bin = "+g);a.fContent===Math.round(a.fContent)?m.push("content = "+a.fContent):m.push("content = "+
u.floatToString(a.fContent,JSROOT.gStyle.fStatFormat));return m};z.prototype.processTooltipEvent=function(a){if(!(a&&this.draw_content&&this.draw_g&&this.tt_handle)||this.options.Proj)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var c=this.getHisto(),b=this.tt_handle,e=this.draw_g.select(".tooltip_bin");if(b.poly){b=this.getFramePainter();var g=-1,m=b.grx===b.x?b.x.invert(a.x):void 0,k=b.gry===b.y?b.y.invert(a.y):void 0;if(void 0!==m&&void 0!==k)for(var f=c.fBins.arr.length,
d=0;d<f&&0>g;++d){var l=c.fBins.arr[d];if(!(m<l.fXmin||m>l.fXmax||k<l.fYmin||k>l.fYmax||0===l.fContent&&!this.options.Zero)){var n=l.fPoly,h=1;"TMultiGraph"===n._typename&&(h=l.fPoly.fGraphs.arr.length,n=null);for(var p=0;p<h;++p){if(!n||0<p)n=l.fPoly.fGraphs.arr[p];if(n.IsInside(m,k)){g=d;break}}}}if(0>g)return e.remove(),null;m={name:"histo",title:c.fTitle||"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",exact:!0,
menu:!0,lines:this.getPolyBinTooltips(g,m,k)};a.disabled?(e.remove(),m.changed=!0):(e.empty()&&(e=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")),m.changed=e.property("current_bin")!==g,m.changed&&e.attr("d",this.createPolyBin(b,l)).style("opacity","0.7").property("current_bin",g));m.changed&&(m.user_info={obj:c,name:"histo",bin:g,cont:l.fContent,grx:a.x,gry:a.y});return m}if(b.candle){for(l=0;l<b.candle.length&&!(g=b.candle[l],g.x1<=a.x&&a.x<=g.x2&&
g.yy1<=a.y&&a.y<=g.yy2);++l);if(l>=b.candle.length)return e.remove(),null;b={name:"histo",title:c.fTitle||"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getCandleTooltips(g),exact:!0,menu:!0};a.disabled?(e.remove(),b.changed=!0):(e.empty()&&(e=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),b.changed=e.property("current_bin")!==l,b.changed&&e.attr("x",g.x1).attr("width",
g.x2-g.x1).attr("y",g.yy1).attr("height",g.yy2-g.yy1).style("opacity","0.7").property("current_bin",l));b.changed&&(b.user_info={obj:c,name:"histo",bin:l+1,cont:g.median,binx:l+1,biny:1,grx:a.x,gry:a.y});return b}m=0;f=null;for(l=b.i1;l<b.i2&&!(a.x>=b.grx[l]&&a.x<=b.grx[l+1]);++l);for(g=b.j1;g<b.j2&&!(a.y>=b.gry[g+1]&&a.y<=b.gry[g]);++g);l<b.i2&&g<b.j2&&(m=c.getBinContent(l+1,g+1),this.is_projection?f=0:b.hide_only_zeros?f=0!==m||this._show_empty_bins?0:null:(f=b.palette.getContourIndex(m),null===
f&&0===m&&this._show_empty_bins&&(f=0)));if(null===f)return e.remove(),null;k={name:"histo",title:c.fTitle||"title",x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(l,g),exact:!0,menu:!0};this.options.Color&&(k.color2=b.palette.getColor(f));if(a.disabled&&!this.is_projection)e.remove(),k.changed=!0;else{e.empty()&&(e=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events",
"none"));f=l;d=l+1;n=g;h=g+1;p=b.grx[f];var v=b.grx[d],u=b.gry[h],r=b.gry[n],t=1E4*l+g;"X"==this.is_projection?(p=0,v=this.getFramePainter().getFrameWidth(),1<this.projection_width&&(u=(this.projection_width-1)/2,h+u>=b.j2?(h=Math.min(Math.round(h+u),b.j2),n=Math.max(h-this.projection_width,b.j1)):(n=Math.max(Math.round(n-u),b.j1),h=Math.min(n+this.projection_width,b.j2))),u=b.gry[h],r=b.gry[n],t=777*n+333*h):"Y"==this.is_projection&&(u=0,r=this.getFramePainter().getFrameHeight(),1<this.projection_width&&
(p=(this.projection_width-1)/2,d+p>=b.i2?(d=Math.min(Math.round(d+p),b.i2),f=Math.max(d-this.projection_width,b.i1)):(f=Math.max(Math.round(f-p),b.i1),d=Math.min(f+this.projection_width,b.i2))),p=b.grx[f],v=b.grx[d],t=777*f+333*d);k.changed=e.property("current_bin")!==t;k.changed&&e.attr("x",p).attr("width",v-p).attr("y",u).attr("height",r-u).style("opacity","0.7").property("current_bin",t);this.is_projection&&k.changed&&this.redrawProjection(f,d,n,h)}k.changed&&(k.user_info={obj:c,name:"histo",bin:c.getBin(l+
1,g+1),cont:m,binx:l+1,biny:g+1,grx:a.x,gry:a.y});return k};z.prototype.canZoomInside=function(a,c,b){if("z"==a)return!0;a=this.getAxis(a);return 1<a.FindBin(b,.5)-a.FindBin(c,0)};z.prototype.draw2D=function(a){var c=this;this.clear3DScene();return this.drawFrameAxes().then(function(b){return b?c.drawingBins(a):!1}).then(function(a){if(!a)return!1;c.draw2DBins();return c.addInteractivity()}).then(function(a){return a?c:null})};z.prototype.draw3D=function(a){var c=this;this.mode3d=!0;return JSROOT.require("v7hist3d").then(function(){return c.draw3D(a)})};
z.prototype.callDrawFunc=function(a){var c=this.getFramePainter();c&&c.mode3d!==this.options.Mode3D&&!this.isMainPainter()&&(this.options.Mode3D=c.mode3d);return this[this.options.Mode3D?"draw3D":"draw2D"](a)};z.prototype.redraw=function(a){this.callDrawFunc(a)};var F=function(a,c,b){var e=new z(a,c);return u.ensureRCanvas(e).then(function(){e.setAsMainPainter();e.options={Hist:!1,Error:!1,Zero:!1,Mark:!1,Line:!1,Fill:!1,Lego:0,Surf:0,Text:!0,TextAngle:0,TextKind:"",BaseLine:!1,Mode3D:!1,AutoColor:0,
Color:!1,Scat:!1,ScatCoef:1,Candle:"",Box:!1,BoxStyle:0,Arrow:!1,Contour:0,Proj:0,BarOffset:0,BarWidth:1,minimum:-1111,maximum:-1111};var a=e.v7EvalAttr("kind",""),b=e.v7EvalAttr("sub",0),c=e.options;c.Text=e.v7EvalAttr("text",!1);switch(a){case "lego":c.Lego=0<b?10+b:12;c.Mode3D=!0;break;case "surf":c.Surf=0<b?10+b:1;c.Mode3D=!0;break;case "box":c.Box=!0;c.BoxStyle=10+b;break;case "err":c.Error=!0;c.Mode3D=!0;break;case "cont":c.Contour=0<b?10+b:1;break;case "arr":c.Arrow=!0;break;case "scat":c.Scat=
!0;break;case "col":c.Color=!0;break;default:c.Text||(c.Color=!0)}e.isRH2Poly()&&(c.Mode3D?c.Lego=12:c.Color=!0);e._show_empty_bins=!1;e._can_move_colz=!0;e.scanContent();return e.callDrawFunc()})};C.prototype=Object.create(JSROOT.v7.RPavePainter.prototype);C.prototype.clearStat=function(){this.stats_lines=[]};C.prototype.addText=function(a){this.stats_lines.push(a)};C.prototype.updateStatistic=function(a){this.stats_lines=a.lines;this.drawStatistic(this.stats_lines)};C.prototype.fillStatistic=function(){var a=
this.getPadPainter();if(a&&a._fast_drawing)return!1;a=this.getObject();return void 0!==a.fLines?(this.stats_lines=a.fLines,delete a.fLines,!0):this.v7CommMode()==JSROOT.v7.CommMode.kOffline?(a=this.getMainPainter())&&"function"===typeof a.fillStatistic?a.fillStatistic(this,JSROOT.gStyle.fOptStat,JSROOT.gStyle.fOptFit):!1:void 0!==this.stats_lines};C.prototype.format=function(a,c){c||(c="stat");switch(c){case "stat":c=JSROOT.gStyle.fStatFormat;break;case "fit":c=JSROOT.gStyle.fFitFormat;break;case "entries":if(1E9>
Math.abs(a)&&Math.round(a)==a)return a.toFixed(0);c="14.7g";break;case "last":c=this.lastformat}a=u.floatToString(a,c||"6.4g",!0);this.lastformat=a[1];return a[0]};C.prototype.drawContent=function(){return this.fillStatistic()?this.drawStatistic(this.stats_lines):Promise.resolve(this)};C.prototype.changeMask=function(a){var c=this.getObject();a=1<<a;c.fShowMask=c.fShowMask&a?c.fShowMask&~a:c.fShowMask|a;this.fillStatistic()&&this.drawStatistic(this.stats_lines)};C.prototype.statsContextMenu=function(a){var c=
this;a.preventDefault();a.stopPropagation();u.createMenu(a,this).then(function(a){var b=c.getObject(),g=c.changeMask.bind(c);a.add("header: StatBox");for(var f=0;f<b.fEntries.length;++f)a.addchk(b.fShowMask&1<<f,b.fEntries[f],f,g);return c.fillObjectExecMenu(a)}).then(function(a){return a.show()})};C.prototype.drawStatistic=function(a){var c=this.v7EvalFont("stats_text",{size:12,color:"black",align:22}),b=0,e=0,g=0,f=this.pave_width,k=this.pave_height;if(!a)return Promise.resolve(this);for(var l=
a.length,d=0;d<l;++d){var p=a[d];0<d&&(g=Math.max(g,p.length));0==d||0>p.indexOf("|")||(0===b&&(b=d),p=p.split("|"),p.length>e&&(e=p.length))}d=k/l;var n=!1,h=.02*f;p=this.draw_g.select(".statlines");p.empty()?p=this.draw_g.append("svg:g").attr("class","statlines"):p.selectAll("*").remove();c.setSize(k/(1.2*l));this.startTextDrawing(c,"font",p);if(1==l)this.drawText({width:f,height:k,text:a[0],latex:1,draw_g:p});else for(c=0;c<l;++c){var u=c*d;if(b&&c>=b)for(var v=a[c].split("|"),x=0;x<v.length;++x)this.drawText({align:"middle",
x:f*x/e,y:u,latex:0,width:f/e,height:d,text:v[x],draw_g:p});else if(0>a[c].indexOf("="))0==c&&(n=!0,a[c].length>g+5&&(a[c]=a[c].substr(0,g+2)+"...")),this.drawText({align:0==c?"middle":"start",x:h,y:u,width:f-2*h,height:d,text:a[c],draw_g:p});else{x=a[c].split("=");v=[];for(var r=0;2>r;++r)v.push({align:0==r?"start":"end",x:h,y:u,width:f-2*h,height:d,text:x[r],draw_g:p,_expected_width:f-2*h,_args:v,post_process:function(a){this._args[0].ready&&this._args[1].ready&&a.scaleTextDrawing(1.05*(this._args[0].result_width&&
this._args[1].result_width)/this.__expected_width,this.draw_g)}});for(u=0;2>u;++u)this.drawText(v[u])}}a="";n&&(a+="M0,"+Math.round(d)+"h"+f);if(0<b&&1<e){for(g=b;g<l;++g)a+="M0,"+Math.round(g*d)+"h"+f;for(l=0;l<e-1;++l)a+="M"+Math.round(f/e*(l+1))+","+Math.round(b*d)+"V"+k}a&&this.draw_g.append("svg:path").attr("d",a);return this.finishTextDrawing(p)};C.prototype.redraw=function(a){var c=this;a&&"string"==typeof a&&0==a.indexOf("zoom")&&this.v7CommMode()==JSROOT.v7.CommMode.kNormal&&(a={_typename:"ROOT::Experimental::RHistStatBoxBase::RRequest",
mask:this.getObject().fShowMask},this.v7SubmitRequest("stat",a,function(a){return c.updateStatistic(a)}));this.drawPave()};JSROOT.v7.RHistPainter=f;JSROOT.v7.RH1Painter=l;JSROOT.v7.RH2Painter=z;JSROOT.v7.drawHist1=Y;JSROOT.v7.drawHist2=F;JSROOT.v7.drawHistDisplayItem=function(a,c,b){return c?1==c.fAxes.length?Y(a,c,b):2==c.fAxes.length?F(a,c,b):3==c.fAxes.length?JSROOT.require("v7hist3d").then(function(){return JSROOT.v7.drawHist3(a,c,b)}):null:null};JSROOT.v7.drawHistStats=function(a,c,b){var e=
new C(a,c,b);return u.ensureRCanvas(e,!1).then(function(){return e.drawPave()})};return JSROOT});
