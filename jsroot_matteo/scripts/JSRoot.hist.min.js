var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(l){var v=0;return function(){return v<l.length?{done:!1,value:l[v++]}:{done:!0}}};$jscomp.arrayIterator=function(l){return{next:$jscomp.arrayIteratorImpl(l)}};$jscomp.makeIterator=function(l){var v="undefined"!=typeof Symbol&&Symbol.iterator&&l[Symbol.iterator];return v?v.call(l):$jscomp.arrayIterator(l)};
$jscomp.getGlobal=function(l){return"undefined"!=typeof window&&window===l?l:"undefined"!=typeof global&&null!=global?global:l};$jscomp.global=$jscomp.getGlobal(this);$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(l,v,F){l!=Array.prototype&&l!=Object.prototype&&(l[v]=F.value)};
$jscomp.polyfill=function(l,v,F,z){if(v){F=$jscomp.global;l=l.split(".");for(z=0;z<l.length-1;z++){var D=l[z];D in F||(F[D]={});F=F[D]}l=l[l.length-1];z=F[l];v=v(z);v!=z&&null!=v&&$jscomp.defineProperty(F,l,{configurable:!0,writable:!0,value:v})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(l){function v(){this.batch_=null}function F(q){return q instanceof D?q:new D(function(l,v){l(q)})}if(l&&!$jscomp.FORCE_POLYFILL_PROMISE)return l;v.prototype.asyncExecute=function(q){if(null==this.batch_){this.batch_=[];var l=this;this.asyncExecuteFunction(function(){l.executeBatch_()})}this.batch_.push(q)};var z=$jscomp.global.setTimeout;v.prototype.asyncExecuteFunction=function(q){z(q,0)};v.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var q=
this.batch_;this.batch_=[];for(var l=0;l<q.length;++l){var v=q[l];q[l]=null;try{v()}catch(O){this.asyncThrow_(O)}}}this.batch_=null};v.prototype.asyncThrow_=function(q){this.asyncExecuteFunction(function(){throw q;})};var D=function(q){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var l=this.createResolveAndReject_();try{q(l.resolve,l.reject)}catch(A){l.reject(A)}};D.prototype.createResolveAndReject_=function(){function q(q){return function(A){v||(v=!0,q.call(l,A))}}var l=this,v=!1;
return{resolve:q(this.resolveTo_),reject:q(this.reject_)}};D.prototype.resolveTo_=function(q){if(q===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(q instanceof D)this.settleSameAsPromise_(q);else{a:switch(typeof q){case "object":var l=null!=q;break a;case "function":l=!0;break a;default:l=!1}l?this.resolveToNonPromiseObj_(q):this.fulfill_(q)}};D.prototype.resolveToNonPromiseObj_=function(q){var l=void 0;try{l=q.then}catch(A){this.reject_(A);return}"function"==typeof l?
this.settleSameAsThenable_(l,q):this.fulfill_(q)};D.prototype.reject_=function(q){this.settle_(2,q)};D.prototype.fulfill_=function(q){this.settle_(1,q)};D.prototype.settle_=function(q,l){if(0!=this.state_)throw Error("Cannot settle("+q+", "+l+"): Promise already settled in state"+this.state_);this.state_=q;this.result_=l;this.executeOnSettledCallbacks_()};D.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var q=0;q<this.onSettledCallbacks_.length;++q)K.asyncExecute(this.onSettledCallbacks_[q]);
this.onSettledCallbacks_=null}};var K=new v;D.prototype.settleSameAsPromise_=function(q){var l=this.createResolveAndReject_();q.callWhenSettled_(l.resolve,l.reject)};D.prototype.settleSameAsThenable_=function(q,l){var v=this.createResolveAndReject_();try{q.call(l,v.resolve,v.reject)}catch(O){v.reject(O)}};D.prototype.then=function(q,l){function v(q,l){return"function"==typeof q?function(l){try{z(q(l))}catch(a){G(a)}}:l}var z,G,F=new D(function(q,l){z=q;G=l});this.callWhenSettled_(v(q,z),v(l,G));return F};
D.prototype.catch=function(q){return this.then(void 0,q)};D.prototype.callWhenSettled_=function(q,l){function v(){switch(z.state_){case 1:q(z.result_);break;case 2:l(z.result_);break;default:throw Error("Unexpected state: "+z.state_);}}var z=this;null==this.onSettledCallbacks_?K.asyncExecute(v):this.onSettledCallbacks_.push(v)};D.resolve=F;D.reject=function(q){return new D(function(l,v){v(q)})};D.race=function(q){return new D(function(l,v){for(var z=$jscomp.makeIterator(q),A=z.next();!A.done;A=z.next())F(A.value).callWhenSettled_(l,
v)})};D.all=function(q){var l=$jscomp.makeIterator(q),v=l.next();return v.done?F([]):new D(function(q,z){function A(l){return function(a){D[l]=a;G--;0==G&&q(D)}}var D=[],G=0;do D.push(void 0),G++,F(v.value).callWhenSettled_(A(D.length-1),z),v=l.next();while(!v.done)})};return D},"es6","es3");$jscomp.polyfill("Math.log10",function(l){return l?l:function(l){return Math.log(l)/Math.LN10}},"es6","es3");$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.SymbolClass=function(l,v){this.$jscomp$symbol$id_=l;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:v})};$jscomp.SymbolClass.prototype.toString=function(){return this.$jscomp$symbol$id_};
$jscomp.Symbol=function(){function l(F){if(this instanceof l)throw new TypeError("Symbol is not a constructor");return new $jscomp.SymbolClass($jscomp.SYMBOL_PREFIX+(F||"")+"_"+v++,F)}var v=0;return l}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var l=$jscomp.global.Symbol.iterator;l||(l=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("Symbol.iterator"));"function"!=typeof Array.prototype[l]&&$jscomp.defineProperty(Array.prototype,l,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}});$jscomp.initSymbolIterator=function(){}};
$jscomp.initSymbolAsyncIterator=function(){$jscomp.initSymbol();var l=$jscomp.global.Symbol.asyncIterator;l||(l=$jscomp.global.Symbol.asyncIterator=$jscomp.global.Symbol("Symbol.asyncIterator"));$jscomp.initSymbolAsyncIterator=function(){}};$jscomp.iteratorPrototype=function(l){$jscomp.initSymbolIterator();l={next:l};l[$jscomp.global.Symbol.iterator]=function(){return this};return l};
$jscomp.iteratorFromArray=function(l,v){$jscomp.initSymbolIterator();l instanceof String&&(l+="");var F=0,z={next:function(){if(F<l.length){var D=F++;return{value:v(D,l[D]),done:!1}}z.next=function(){return{done:!0,value:void 0}};return z.next()}};z[Symbol.iterator]=function(){return z};return z};$jscomp.polyfill("Array.prototype.entries",function(l){return l?l:function(){return $jscomp.iteratorFromArray(this,function(l,F){return[l,F]})}},"es6","es3");
JSROOT.define(["d3","painter","gpad"],function(l,v){function F(a,b){a=a||JSROOT.settings.Palette;if(0<a&&10>a){a=[];for(b=0;50>b;++b){var d=Math.round((b+2)/60*255);a.push("rgb("+d+","+d+","+d+")")}return new JSROOT.ColorPalette(a)}if(51>a)return aa();113<a&&(a=57);switch(a){case 51:var c=[[0,9,13,17,24,32,27,25,29],[0,0,0,2,37,74,113,160,221],[28,42,59,78,98,129,154,184,221]];break;case 52:c=[[0,32,64,96,128,160,192,224,255],[0,32,64,96,128,160,192,224,255],[0,32,64,96,128,160,192,224,255]];break;
case 53:c=[[0,45,99,156,212,230,237,234,242],[0,0,0,45,101,168,238,238,243],[0,1,1,3,9,8,11,95,230]];break;case 54:c=[[0,22,44,68,93,124,160,192,237],[0,16,41,67,93,125,162,194,241],[97,100,99,99,93,68,44,26,74]];break;case 55:c=[[0,5,15,35,102,196,208,199,110],[0,48,124,192,206,226,97,16,0],[99,142,198,201,90,22,13,8,2]];break;case 56:c=[[242,234,237,230,212,156,99,45,0],[243,238,238,168,101,45,0,0,0],[230,95,11,8,9,3,1,1,0]];break;case 57:c=[[53.091,15.096,19.89,5.916,45.951,135.1755,208.743,253.878,
248.982],[42.432,91.7745,128.5455,163.6845,183.039,191.046,186.864,200.481,250.716],[134.9715,221.442,213.8175,201.807,163.8375,118.881,89.2245,50.184,13.7445]];break;case 58:c=[[0,24,2,54,176,236,202,194,255],[0,29,92,129,117,120,176,236,255],[0,68,80,34,57,172,252,245,255]];break;case 59:c=[[13,23,25,63,76,104,137,161,206],[95,67,37,21,0,12,35,52,79],[4,3,2,6,11,22,49,98,208]];break;case 60:c=[[0,61,89,122,143,160,185,204,231],[0,0,0,0,14,37,72,132,235],[0,140,224,144,4,5,6,9,13]];break;case 61:c=
[[14,7,2,0,5,11,55,131,229],[105,56,26,1,42,74,131,171,229],[2,21,35,60,92,113,160,185,229]];break;case 62:c=[[0,0,0,70,148,231,235,237,244],[0,0,0,0,0,69,67,216,244],[0,102,228,231,177,124,137,20,244]];break;case 63:c=[[50,56,63,68,93,121,165,192,241],[66,81,91,96,111,128,155,189,241],[97,91,75,65,77,103,143,167,217]];break;case 64:c=[[145,166,167,156,131,114,101,112,132],[158,178,179,181,163,154,144,152,159],[190,199,201,192,176,169,160,166,190]];break;case 65:c=[[93,91,99,108,130,125,132,155,174],
[126,124,128,129,131,121,119,153,173],[103,94,87,85,80,85,107,120,146]];break;case 66:c=[[24,40,69,90,104,114,120,132,103],[29,52,94,127,150,162,159,151,101],[29,52,96,132,162,181,184,186,131]];break;case 67:c=[[46,38,61,92,113,121,132,150,191],[46,36,40,69,110,135,131,92,34],[46,80,74,70,81,105,165,211,225]];break;case 68:c=[[0,4,12,30,52,101,142,190,237],[0,40,86,121,140,172,187,213,240],[0,9,14,18,21,23,27,35,101]];break;case 69:c=[[198,206,206,211,198,181,161,171,244],[103,133,150,172,178,174,
163,175,244],[49,54,55,66,91,130,184,224,244]];break;case 70:c=[[243,243,240,240,241,239,186,151,129],[0,46,99,149,194,220,183,166,147],[6,8,36,91,169,235,246,240,233]];break;case 71:c=[[22,19,19,25,35,53,88,139,210],[0,32,69,108,135,159,183,198,215],[77,96,110,116,110,100,90,78,70]];break;case 72:c=[[68,116,165,182,189,180,145,111,71],[37,82,135,178,204,225,221,202,147],[16,55,105,147,196,226,232,224,178]];break;case 73:c=[[61,99,136,181,213,225,198,136,24],[149,140,96,83,132,178,190,135,22],[214,
203,168,135,110,100,111,113,22]];break;case 74:c=[[76,120,156,183,197,180,162,154,140],[34,35,42,69,102,137,164,188,197],[64,69,78,105,142,177,205,217,198]];break;case 75:c=[[37,102,157,188,196,214,223,235,251],[37,29,25,37,67,91,132,185,251],[37,32,33,45,66,98,137,187,251]];break;case 76:c=[[79,100,119,137,153,172,192,205,250],[63,79,93,103,115,135,167,196,250],[51,59,66,61,62,70,110,160,250]];break;case 77:c=[[43,44,50,66,125,172,178,155,157],[63,63,85,101,138,163,122,51,39],[121,101,58,44,47,55,
57,44,43]];break;case 78:c=[[0,41,62,79,90,87,99,140,228],[0,57,81,93,85,70,71,125,228],[95,91,91,82,60,43,44,112,228]];break;case 79:c=[[49,59,72,88,114,141,176,205,222],[78,72,66,57,59,75,106,142,173],[78,55,46,40,39,39,40,41,47]];break;case 80:c=[[243,222,201,185,165,158,166,187,219],[94,108,132,135,125,96,68,51,61],[7,9,12,19,45,89,118,146,118]];break;case 81:c=[[19,44,74,105,137,166,194,206,220],[19,28,40,55,82,110,159,181,220],[19,42,68,96,129,157,188,203,220]];break;case 82:c=[[33,44,70,99,
140,165,199,211,216],[38,50,76,105,140,165,191,189,167],[55,67,97,124,140,166,163,129,52]];break;case 83:c=[[0,33,73,124,136,152,159,171,223],[0,43,92,124,134,126,121,144,223],[0,43,68,76,73,64,72,114,223]];break;case 84:c=[[5,18,45,124,193,223,205,128,49],[48,134,207,230,193,113,28,0,7],[6,15,41,121,193,226,208,130,49]];break;case 85:c=[[180,106,104,135,164,188,189,165,144],[72,126,154,184,198,207,205,190,179],[41,120,158,188,194,181,145,100,62]];break;case 86:c=[[57,72,94,117,136,154,174,192,215],
[0,33,68,109,140,171,192,196,209],[116,137,173,201,200,201,203,190,187]];break;case 87:c=[[31,71,123,160,210,222,214,199,183],[40,117,171,211,231,220,190,132,65],[234,214,228,222,210,160,105,60,34]];break;case 88:c=[[123,108,109,126,154,172,188,196,218],[184,138,130,133,154,175,188,196,218],[208,130,109,99,110,122,150,171,218]];break;case 89:c=[[105,106,122,143,159,172,176,181,207],[252,197,194,187,174,162,153,136,125],[146,133,144,155,163,167,166,162,174]];break;case 90:c=[[171,141,145,152,154,159,
163,158,177],[236,143,100,63,53,55,44,31,6],[59,48,46,44,42,54,82,112,179]];break;case 91:c=[[180,190,209,223,204,228,205,152,91],[93,125,147,172,181,224,233,198,158],[236,218,160,133,114,132,162,220,218]];break;case 92:c=[[225,183,162,135,115,111,119,145,211],[205,177,166,135,124,117,117,132,172],[186,165,155,135,126,130,150,178,226]];break;case 93:c=[[39,43,59,63,80,116,153,177,223],[39,43,59,74,91,114,139,165,223],[39,50,59,70,85,115,151,176,223]];break;case 94:c=[[0,38,60,76,84,89,101,128,204],
[0,10,15,23,35,57,83,123,199],[0,11,22,40,63,86,97,94,85]];break;case 95:c=[[94,112,141,165,167,140,91,49,27],[27,46,88,135,166,161,135,97,58],[42,52,81,106,139,158,155,137,116]];break;case 96:c=[[30,49,79,117,135,151,146,138,147],[63,60,72,90,94,94,68,46,16],[18,28,41,56,62,63,50,36,21]];break;case 97:c=[[0,30,63,101,143,152,169,187,230],[0,14,28,42,58,61,67,74,91],[39,26,21,18,15,14,14,13,13]];break;case 98:c=[[149,140,164,179,182,181,131,87,61],[62,70,107,136,144,138,117,87,74],[40,38,45,49,49,
49,38,32,34]];break;case 99:c=[[99,112,148,165,179,182,183,183,208],[39,40,57,79,104,127,148,161,198],[15,16,18,33,51,79,103,129,177]];break;case 100:c=[[99,116,154,174,200,196,201,201,230],[0,0,8,32,58,83,119,136,173],[5,6,7,9,9,14,17,19,24]];break;case 101:c=[[82,106,126,141,155,163,142,107,66],[62,44,69,107,135,152,149,132,119],[39,25,31,60,73,68,49,72,188]];break;case 102:c=[[18,29,44,72,116,158,184,208,221],[27,46,71,105,146,177,189,190,183],[39,55,80,108,130,133,124,100,76]];break;case 103:c=
[[0,48,119,173,212,224,228,228,245],[0,13,30,47,79,127,167,205,245],[0,68,75,43,16,22,55,128,245]];break;case 104:c=[[34,70,129,187,225,226,216,193,179],[48,91,147,194,226,229,196,110,12],[234,212,216,224,206,110,53,40,29]];break;case 105:c=[[30,55,103,147,174,203,188,151,105],[0,65,138,182,187,175,121,53,9],[191,202,212,208,171,140,97,57,30]];break;case 106:c=[[112,97,113,125,138,159,178,188,225],[16,17,24,37,56,81,110,136,189],[38,35,46,59,78,103,130,152,201]];break;case 107:c=[[18,72,5,23,29,201,
200,98,29],[0,0,43,167,211,117,0,0,0],[51,203,177,26,10,9,8,3,0]];break;case 108:c=[[19,42,64,88,118,147,175,187,205],[19,55,89,125,154,169,161,129,70],[19,32,47,70,100,128,145,130,75]];break;case 109:c=[[33,31,42,68,86,111,141,172,227],[255,175,145,106,88,55,15,0,0],[255,205,202,203,208,205,203,206,231]];break;case 110:c=[[0,25,50,79,110,145,181,201,254],[0,16,30,46,63,82,101,124,179],[0,12,21,29,39,49,61,74,103]];break;case 111:c=[[0,13,30,44,72,120,156,200,247],[0,36,84,117,141,153,151,158,247],
[0,94,100,82,56,66,76,131,247]];break;case 112:c=[[26,51,43,33,28,35,74,144,246],[9,24,55,87,118,150,180,200,222],[30,96,112,114,112,101,72,35,0]];break;case 113:c=[[0,5,65,97,124,156,189,224,255],[32,54,77,100,123,148,175,203,234],[77,110,107,111,120,119,111,94,70]];break;default:return aa()}a=[0,.125,.25,.375,.5,.625,.75,.875,1];b=c[0];d=c[1];c=c[2];for(var f=[],e=1;e<a.length;e++)for(var g=parseInt(Math.floor(255*a[e])-Math.floor(255*a[e-1])),h=0;h<g;h++)f.push("rgb("+(Math.round(b[e-1]+h*(b[e]-
b[e-1])/g)+","+Math.round(d[e-1]+h*(d[e]-d[e-1])/g)+","+Math.round(c[e-1]+h*(c[e]-c[e-1])/g))+")");return new JSROOT.ColorPalette(f)}function z(a,b){JSROOT.ObjectPainter.call(this,a,b);this.UseContextMenu=this.Enabled=!0;this.UseTextColor=!1}function D(){this.reset()}function K(a,b){this.arr=[];this.colzmin=a;this.colzmax=b;this.below_min_indx=-1;this.exact_min_indx=0}function q(a,b){JSROOT.ObjectPainter.call(this,a,b);this.draw_content=!0;this.nbinsy=this.nbinsx=0;this.accept_drops=!0;this.mode3d=
!1;this.hist_painter_id=JSROOT._.id_counter++}function G(a,b){q.call(this,a,b)}function A(a,b){q.call(this,a,b);this.fPalette=null;this.wheel_zoomy=!0}function O(a,b,d){var c=0,f=0,e=0;b||(c=a.fSave.length,f=Math.round(a.fSave[c-2]),e=Math.round(a.fSave[c-1]),c!==(f+1)*(e+1)+6&&(c=0));if(6<c){b=(a.fSave[c-5]-a.fSave[c-6])/f/2;var g=(a.fSave[c-3]-a.fSave[c-4])/e/2;d||(d=JSROOT.createHistogram("TH2F",f+1,e+1));d.fXaxis.fXmin=a.fSave[c-6]-b;d.fXaxis.fXmax=a.fSave[c-5]+b;d.fYaxis.fXmin=a.fSave[c-4]-g;
d.fYaxis.fXmax=a.fSave[c-3]+g;for(b=c=0;b<=e;++b)for(g=0;g<=f;++g)d.setBinContent(d.getBin(g+1,b+1),a.fSave[c++])}else for(f=Math.max(a.fNpx,2),e=Math.max(a.fNpy,2),d||(d=JSROOT.createHistogram("TH2F",f,e)),d.fXaxis.fXmin=a.fXmin,d.fXaxis.fXmax=a.fXmax,d.fYaxis.fXmin=a.fYmin,d.fYaxis.fXmax=a.fYmax,c=0;c<e;++c)for(b=0;b<f;++b){g=a.fXmin+(b+.5)*(a.fXmax-a.fXmin)/f;var h=a.fYmin+(c+.5)*(a.fYmax-a.fYmin)/e;d.setBinContent(d.getBin(b+1,c+1),a.evalPar(g,h))}d.fName="Func";d.fTitle=a.fTitle;d.fMinimum=a.fMinimum;
d.fMaximum=a.fMaximum;d.fLineColor=a.fLineColor;d.fLineStyle=a.fLineStyle;d.fLineWidth=a.fLineWidth;d.fFillColor=a.fFillColor;d.fFillStyle=a.fFillStyle;d.fMarkerColor=a.fMarkerColor;d.fMarkerStyle=a.fMarkerStyle;d.fMarkerSize=a.fMarkerSize;d.fBits|=I.kNoStats;return d}function J(a,b,d){JSROOT.ObjectPainter.call(this,a,b,d);this.firstpainter=null;this.painters=[]}var aa=function(){function a(a,c,b){if(1E-100>b)c=b=a=c;else{var d=function(a,c,b){0>b&&(b+=1);1<b&&--b;return b<1/6?a+6*(c-a)*b:.5>b?c:
b<2/3?a+(c-a)*(2/3-b)*6:a},e=.5>c?c*(1+b):c+b-c*b,f=2*c-e;c=d(f,e,a+1/3);b=d(f,e,a);a=d(f,e,a-1/3)}return"rgb("+Math.round(255*c)+","+Math.round(255*b)+","+Math.round(255*a)+")"}for(var b=[],d=0;50>d;++d){var c=a((280-5.6*(d+1))/360,.5,1);b.push(c)}return new JSROOT.ColorPalette(b)};z.prototype=Object.create(JSROOT.ObjectPainter.prototype);z.prototype.drawPave=function(a){var b=this;this.UseTextColor=!1;var d=Promise.resolve(this);if(!this.Enabled)return this.removeG(),d;var c=this.getObject(),f=
c.fOption.toUpperCase();if(0===c.fInit){this.stored=JSROOT.extend({},c);c.fInit=1;var e=this.getPadPainter().getRootPad(!0);if("TPaletteAxis"!=c._typename||c.fX1||c.fX2||c.fY1||c.fY2)0<=f.indexOf("NDC")?(c.fX1NDC=c.fX1,c.fX2NDC=c.fX2,c.fY1NDC=c.fY1,c.fY2NDC=c.fY2):e?(e.fLogx&&(0<c.fX1&&(c.fX1=Math.log10(c.fX1)),0<c.fX2&&(c.fX2=Math.log10(c.fX2))),e.fLogy&&(0<c.fY1&&(c.fY1=Math.log10(c.fY1)),0<c.fY2&&(c.fY2=Math.log10(c.fY2))),c.fX1NDC=(c.fX1-e.fX1)/(e.fX2-e.fX1),c.fY1NDC=(c.fY1-e.fY1)/(e.fY2-e.fY1),
c.fX2NDC=(c.fX2-e.fX1)/(e.fX2-e.fX1),c.fY2NDC=(c.fY2-e.fY1)/(e.fY2-e.fY1)):(c.fX1NDC=c.fY1NDC=.1,c.fX2NDC=c.fY2NDC=.9);else{var g=this.getFramePainter();g?(c.fX1NDC=g.fX2NDC+.01,c.fX2NDC=Math.min(.96,g.fX2NDC+.06),c.fY1NDC=g.fY1NDC,c.fY2NDC=g.fY2NDC):(c.fX2NDC=.8,c.fX1NDC=.9,c.fY1NDC=.1,c.fY2NDC=.9)}c.fX1NDC==c.fX2NDC&&c.fY1NDC==c.fY2NDC&&"TLegend"==c._typename&&(c.fX1NDC=Math.max(e?e.fLeftMargin:0,c.fX2NDC-.3),c.fX2NDC=Math.min(c.fX1NDC+.3,e?1-e.fRightMargin:1),g=Math.max(c.fPrimitives?.05*c.fPrimitives.arr.length:
0,.2),c.fY2NDC=Math.min(e?1-e.fTopMargin:1,c.fY1NDC+g),c.fY1NDC=Math.max(c.fY2NDC-g,e?e.fBottomMargin:0))}e=this.getPadPainter().getPadRect();var h=Math.round(c.fX1NDC*e.width),t=Math.round((1-c.fY2NDC)*e.height),n=Math.round((c.fX2NDC-c.fX1NDC)*e.width),k=Math.round((c.fY2NDC-c.fY1NDC)*e.height);g=c.fBorderSize;e=0<=f.indexOf("L")?-1:0<=f.indexOf("R")?1:0;f=0<=f.indexOf("T")?-1:0<=f.indexOf("B")?1:0;this.createG();this.draw_g.attr("transform","translate("+h+","+t+")");this.createAttLine({attr:c,
width:0<g?c.fLineWidth:0});this.createAttFill({attr:c});if("TDiamond"==c._typename){d=Math.round(k/2);var m=Math.round(n/2),u="l"+m+",-"+d+"l"+m+","+d+"l-"+m+","+d+"z";1<g&&0<c.fShadowColor&&(e||f)&&!this.fillatt.empty()&&this.draw_g.append("svg:path").attr("d","M0,"+(d+g)+u).style("fill",this.getColor(c.fShadowColor)).style("stroke",this.getColor(c.fShadowColor)).style("stroke-width","1px");this.draw_g.append("svg:path").attr("d","M0,"+d+u).call(this.fillatt.func).call(this.lineatt.func);e=this.draw_g.append("svg:g").attr("transform",
"translate("+Math.round(n/4)+","+Math.round(k/4)+")");return this.drawPaveText(m,d,a,e)}1<g&&0<c.fShadowColor&&!c.fNpaves&&(e||f)&&(m="",u=this.getColor(c.fShadowColor),m=this.fillatt.empty()?0>e&&0>f?"M0,0v"+(k-g)+"h-"+g+"v-"+k+"h"+n+"v"+g:"M0,"+k+"v-"+(k-g)+"h-"+g+"v"+k+"h"+n+"v-"+g:"M"+e*g+","+f*g+"v"+k+"h"+n+"v-"+k,this.draw_g.append("svg:path").attr("d",m+"z").style("fill",u).style("stroke",u).style("stroke-width","1px"));if(c.fNpaves)for(g=c.fNpaves-1;0<g;--g)this.draw_g.append("svg:path").attr("d",
"M"+4*e*g+","+4*f*g+"h"+n+"v"+k+"h-"+n+"z").call(this.fillatt.func).call(this.lineatt.func);var r=this.draw_g.append("svg:path").attr("d","M0,0h"+n+"v"+k+"h-"+n+"z").call(this.fillatt.func).call(this.lineatt.func);"function"==typeof this.paveDrawFunc&&(d=this.paveDrawFunc(n,k,a));return JSROOT.batch_mode||"TPave"==c._typename?d:d.then(function(){return JSROOT.require(["interactive"])}).then(function(a){r.style("pointer-events","visibleFill").on("mouseenter",function(){return b.showObjectStatus()});
b.draw_g.attr("x",h).attr("y",t).attr("width",n).attr("height",k);a.addDragHandler(b,{obj:c,minwidth:10,minheight:20,canselect:!0,redraw:function(){b.interactiveRedraw(!1,"pave_moved");b.drawPave()},ctxmenu:JSROOT.browser.touches&&JSROOT.settings.ContextMenu&&b.UseContextMenu});if(b.UseContextMenu&&JSROOT.settings.ContextMenu)b.draw_g.on("contextmenu",function(a){return b.paveContextMenu(a)});"TPaletteAxis"==c._typename&&b.interactivePaletteAxis(n,k);return b})};z.prototype.fillWebObjectOptions=function(a){if(!a){if(!this.snapid)return null;
a={_typename:"TWebObjectOptions",snapid:this.snapid.toString(),opt:this.getDrawOpt(),fcust:"",fopt:[]}}var b=this.getObject();b&&b.fInit&&(a.fcust="pave",a.fopt=[b.fX1NDC,b.fY1NDC,b.fX2NDC,b.fY2NDC]);return a};z.prototype.drawPaveLabel=function(a,b){this.UseTextColor=!0;var d=this.getObject();this.startTextDrawing(d.fTextFont,b/1.2);this.drawText({align:d.fTextAlign,width:a,height:b,text:d.fLabel,color:this.getColor(d.fTextColor)});return this.finishTextDrawing()};z.prototype.drawPaveStats=function(a,
b){this.isStats()&&this.fillStatistic();for(var d=this.getObject(),c=[],f=this.getColor(d.fTextColor),e=0,g=0,h=0,t=0;t<d.fLines.arr.length;++t){var n=d.fLines.arr[t];"TText"!=n._typename&&"TLatex"!=n._typename||c.push(n.fTitle)}t=c.length;for(n=0;n<t;++n){var k=c[n];0<n&&(h=Math.max(h,k.length));0==n||0>k.indexOf("|")||(0===e&&(e=n),k=k.split("|"),k.length>g&&(g=k.length))}n=b/t;k=!1;var m=d.fMargin*a;this.startTextDrawing(d.fTextFont,b/(1.2*t));this.UseTextColor=!0;if(1==t)this.drawText({align:d.fTextAlign,
width:a,height:b,text:c[0],color:f,latex:1});else for(var u=0;u<t;++u){var r=u*n;this.UseTextColor=!0;if(e&&u>=e)for(var y=c[u].split("|"),p=0;p<y.length;++p)this.drawText({align:"middle",x:a*p/g,y:r,latex:0,width:a/g,height:n,text:y[p],color:f});else if(0>c[u].indexOf("="))0==u&&(k=!0,c[u].length>h+5&&(c[u]=c[u].substr(0,h+2)+"...")),this.drawText({align:0==u?"middle":"start",x:m,y:r,width:a-2*m,height:n,text:c[u],color:f});else{p=c[u].split("=");y=[];for(var x=0;2>x;++x)y.push({align:0==x?"start":
"end",x:m,y:r,width:a-2*m,height:n,text:p[x],color:f,_expected_width:a-2*m,_args:y,post_process:function(a){this._args[0].ready&&this._args[1].ready&&a.scaleTextDrawing(1.05*(this._args[0].result_width+this._args[1].result_width)/this._expected_width,a.draw_g)}});for(r=0;2>r;++r)this.drawText(y[r])}}c="";0<d.fBorderSize&&k&&(c+="M0,"+Math.round(n)+"h"+a);if(0<e&&1<g){for(d=e;d<t;++d)c+="M0,"+Math.round(d*n)+"h"+a;for(d=0;d<g-1;++d)c+="M"+Math.round(a/g*(d+1))+","+Math.round(e*n)+"V"+b}c&&this.draw_g.append("svg:path").attr("d",
c).call(this.lineatt.func);this.draw_g.classed("most_upper_primitives",!0);return this.finishTextDrawing()};z.prototype.drawPaveText=function(a,b,d,c){var f=this;d=this.getObject();var e=this.getColor(d.fTextColor),g=0,h=[],t=this.getPadPainter(),n=t.getPadHeight(),k=!1,m=0<d.fLabel.length,u=[];c||(c=this.draw_g);for(var r=0;r<d.fLines.arr.length;++r){var y=d.fLines.arr[r];if("TText"==y._typename||"TLatex"==y._typename)if(g++,0<y.fX||0<y.fY)k=!0}t=1==g&&t&&t._fast_drawing;for(y=r=0;y<d.fLines.arr.length;++y){var p=
d.fLines.arr[y],x=0<g?Math.round((1-(r-.5)/g)*b):0;switch(p._typename){case "TText":case "TLatex":r++;if(k){var w=p.fX,E=p.fY;w=0<w&&1>w?Math.round(w*a):d.fMargin*a;E=0<E&&1>E?Math.round((1-E)*b):x;x=p.fTextColor?this.getColor(p.fTextColor):"";x||(x=e,this.UseTextColor=!0);var L=c.append("svg:g");this.startTextDrawing(d.fTextFont,(p.fTextSize||d.fTextSize)*n,L);this.drawText({align:p.fTextAlign||d.fTextAlign,x:w,y:E,text:p.fTitle,color:x,latex:"TText"==p._typename?0:1,draw_g:L,fast:t});u.push(this.finishTextDrawing(L))}else h.push(p);
break;case "TLine":case "TBox":w=p.fX1;E=p.fX2;L=p.fY1;var l=p.fY2;0!==w&&(w=Math.round(w*a));E=E?Math.round(E*a):a;L=L?Math.round((1-L)*b):x;l=l?Math.round((1-l)*b):x;"TLine"==p._typename?(p=new JSROOT.TAttLineHandler(p),c.append("svg:line").attr("x1",w).attr("y1",L).attr("x2",E).attr("y2",l).call(p.func)):(p=this.createAttFill(p),c.append("svg:rect").attr("x",w).attr("y",l).attr("width",E-w).attr("height",L-l).call(p.func))}}if(!k){k=b/g;r=d.fMargin*a;y=0;1==g&&0<d.fTextSize&&(y=Math.round(d.fTextSize*
n),3>y&&(y=3));this.startTextDrawing(d.fTextFont,b/(1.2*g),c,y);for(y=0;y<g;++y)p=null,x=h[y],1==g?p={x:0,y:0,width:a,height:b}:(p={x:r,y:y*k,width:a-2*r,height:k},x.fTextColor&&(p.color=this.getColor(x.fTextColor)),x.fTextSize&&(p.font_size=Math.round(x.fTextSize*n))),p.align=d.fTextAlign,p.draw_g=c,p.latex="TText"==x._typename?0:1,p.text=x.fTitle,p.fast=t,p.color||(this.UseTextColor=!0,p.color=e),this.drawText(p);u.push(this.finishTextDrawing(c))}m&&(g=Math.round(.25*a),h=Math.round(.02*-b),a=Math.round(.5*
a),b=Math.round(.04*b),c=c.append("svg:g"),c.append("svg:path").attr("d","M"+g+","+h+"h"+a+"v"+b+"h-"+a+"z").call(this.fillatt.func).call(this.lineatt.func),this.startTextDrawing(d.fTextFont,b/1.5,c),this.drawText({align:22,x:g,y:h,width:a,height:b,text:d.fLabel,color:e,draw_g:c}),u.push(this.finishTextDrawing(c)),this.UseTextColor=!0);return Promise.all(u).then(function(){return f})};z.prototype.format=function(a,b){b||(b="stat");var d=this.getObject();switch(b){case "stat":b=d.fStatFormat||JSROOT.gStyle.fStatFormat;
break;case "fit":b=d.fFitFormat||JSROOT.gStyle.fFitFormat;break;case "entries":if(1E9>Math.abs(a)&&Math.round(a)==a)return a.toFixed(0);b="14.7g";break;case "last":b=this.lastformat}a=v.floatToString(a,b||"6.4g",!0);this.lastformat=a[1];return a[0]};z.prototype.drawPaveLegend=function(a,b){function d(a){return!a.fObject&&!a.fOption&&(!a.fLabel||" "==a.fLabel)}var c=this.getObject(),f=c.fPrimitives.arr.length,e=c.fNColumns,g=f;if(2>e)e=1;else for(;(g-1)*e>=f;)g--;if(1==e)for(var h=0;h<f;++h)d(c.fPrimitives.arr[h])&&
g--;1>g&&(g=1);h=this.getColor(c.fTextColor);var t=Math.round(a/e);a=Math.round(.03*a/e);var n=Math.round(.03*b);b=(b-2*n)/g;var k=.9*b,m=0;g=this.getPadPainter();var u=g.getPadHeight(),r=!1,y=-1;c.fTextSize&&2<u*c.fTextSize&&u*c.fTextSize<k&&(k=m=Math.round(u*c.fTextSize));this.startTextDrawing(c.fTextFont,k,this.draw_g,m);for(k=0;k<f;++k)if(m=c.fPrimitives.arr[k],!d(m)){1==e?++y:y=k;u=m.fOption.toLowerCase();var p=y%e,x=(y-p)/e;p*=t;var w=p+Math.round(c.fMargin*t),E=Math.round((p+w)/2),L=Math.round(x*
b+n);x=Math.round((x+.5)*b+n);var l=m,q=m,v=m,C=m.fObject,B=null,z=!1;null!==C&&"object"==typeof C&&("fLineColor"in C&&(v=C),"fFillColor"in C&&(l=C),"fMarkerColor"in C&&(q=C),B=g.findPainterFor(C));-1!=u.indexOf("f")&&(C=B&&B.fillatt?B.fillatt:this.createAttFill(l),l=this.draw_g.append("svg:rect").attr("x",p+a).attr("y",Math.round(L+.1*b)).attr("width",w-2*a-p).attr("height",Math.round(.8*b)).call(C.func),C.empty()||(z=!0),0>u.indexOf("l")&&0>u.indexOf("e")&&0>u.indexOf("p")&&(C=B&&B.lineatt?B.lineatt:
new JSROOT.TAttLineHandler(v),l.call(C.func),"none"!==C.color&&(z=!0)));if(-1!=u.indexOf("l")||-1!=u.indexOf("e"))l=B&&B.lineatt?B.lineatt:new JSROOT.TAttLineHandler(v),this.draw_g.append("svg:line").attr("x1",p+a).attr("y1",x).attr("x2",w-a).attr("y2",x).call(l.func),"none"!==l.color&&(z=!0);-1!=u.indexOf("e")&&(v=B&&B.lineatt?B.lineatt:new JSROOT.TAttLineHandler(v),this.draw_g.append("svg:line").attr("x1",E).attr("y1",Math.round(L+.1*b)).attr("x2",E).attr("y2",Math.round(L+.9*b)).call(v.func),"none"!==
v.color&&(z=!0));-1!=u.indexOf("p")&&(E=B&&B.markeratt?B.markeratt:new JSROOT.TAttMarkerHandler(q),this.draw_g.append("svg:path").attr("d",E.create((p+w)/2,x)).call(E.func),"none"!==E.color&&(z=!0));!z&&B&&B.lineatt&&"none"!==B.lineatt.color&&this.draw_g.append("svg:rect").attr("x",p+a).attr("y",Math.round(L+.1*b)).attr("width",w-2*a-p).attr("height",Math.round(.8*b)).attr("fill","none").call(B.lineatt.func);0<u.length?r=!0:r||(w=p+a);m.fLabel&&this.drawText({align:"start",x:w,y:L,width:p+t-w-a,height:b,
text:m.fLabel,color:h})}return this.finishTextDrawing()};z.prototype.drawPaletteAxis=function(a,b,d){var c=this,f=this.getObject(),e=f.fAxis,g="string"==typeof d&&0<d.indexOf("can_move"),h="string"==typeof d&&0<d.indexOf("postpone"),t=e.fNdiv%100,n=parseInt(this.draw_g.attr("x")),k=parseInt(this.draw_g.attr("y")),m=this.getPadPainter().getPadWidth(),u=this.getPadPainter().getRootPad(!0),r=this.getMainPainter(),y=this.getFramePainter(),p=0,x=100,w=(d=r.fContour)?d.getLevels():null,E=r.fPalette;0>=
t&&(t=8);e.fTickSize=.6*a/m;d&&y?(p=Math.min(w[0],y.zmin),x=Math.max(w[w.length-1],y.zmax)):void 0!==r.gmaxbin&&void 0!==r.gminbin?(p=r.gminbin,x=r.gmaxbin):void 0!==r.hmin&&void 0!==r.hmax&&(p=r.hmin,x=r.hmax);this.draw_g.selectAll("rect").style("fill","white");this.z_handle.configureAxis("zaxis",p,x,p,x,!0,[0,b],{log:u?u.fLogz:0});if(d&&E&&!h)for(e=0;e<w.length-1;++e){if(h=this.z_handle.gr(w[e]),t=this.z_handle.gr(w[e+1]),u=d.getPaletteColor(E,(w[e]+w[e+1])/2),h=this.draw_g.append("svg:rect").attr("x",
0).attr("y",Math.round(t)).attr("width",a).attr("height",Math.round(h)-Math.round(t)).style("fill",u).style("stroke",u).property("fill0",u).property("fill1",l.rgb(u).darker(.5).toString()),this.isTooltipAllowed()&&h.on("mouseover",function(){l.select(this).transition().duration(100).style("fill",l.select(this).property("fill1"))}).on("mouseout",function(){l.select(this).transition().duration(100).style("fill",l.select(this).property("fill0"))}).append("svg:title").text(w[e].toFixed(2)+" - "+w[e+1].toFixed(2)),
JSROOT.settings.Zooming)h.on("dblclick",function(){return c.getFramePainter().unzoom("z")})}else this.draw_g.append("svg:rect").attr("x",0).attr("y",0).attr("width",a).attr("height",b).style("fill","white");this.z_handle.max_tick_size=Math.round(.7*a);return this.z_handle.drawAxis(this.draw_g,a,b,"translate("+a+", 0)").then(function(){if(g&&"getBoundingClientRect"in c.draw_g.node()){var a=c.draw_g.node().getBoundingClientRect();a=n+parseInt(a.width)-Math.round(.995*m)+3;0<a&&(c.draw_g.attr("x",n-
a).attr("y",k).attr("transform","translate("+(n-a)+", "+k+")"),f.fX1NDC-=a/m,f.fX2NDC-=a/m)}return c})};z.prototype.interactivePaletteAxis=function(a,b){var d=this,c=!1,f=0,e=0,g=null,h=function(a){c&&(a.preventDefault(),a=l.pointer(a,d.draw_g.node()),e=Math.min(Math.max(a[1],0),b),g.attr("y",Math.min(f,e)).attr("height",Math.abs(e-f)))},t=function(a){if(c){a.preventDefault();l.select(window).on("mousemove.colzoomRect",null).on("mouseup.colzoomRect",null);g.remove();g=null;c=!1;var b=d.z_handle.gr;
a=b.invert(f);b=b.invert(e);d.getFramePainter().zoom("z",Math.min(a,b),Math.max(a,b))}},n=function(b){c||(c=!0,b.preventDefault(),b.stopPropagation(),f=e=l.pointer(b,d.draw_g.node())[1],g=d.draw_g.append("svg:rect").attr("class","zoom").attr("id","colzoomRect").attr("x","0").attr("width",a).attr("y",f).attr("height",1),l.select(window).on("mousemove.colzoomRect",h).on("mouseup.colzoomRect",t,!0))};if(JSROOT.settings.Zooming)this.draw_g.selectAll(".axis_zoom").on("mousedown",n).on("dblclick",function(){return d.getFramePainter().unzoom("z")});
if(JSROOT.settings.ZoomWheel)this.draw_g.on("wheel",function(a){var c=1-l.pointer(a,d.draw_g.node())[1]/b;a=d.z_handle.analyzeWheelEvent(a,c);a.changed&&d.getFramePainter().zoom("z",a.min,a.max)})};z.prototype.fillContextMenu=function(a){var b=this.getObject();a.add("header: "+b._typename+"::"+b.fName);if(this.isStats()){var d=function(c,d){var e=10>c?b.fOptStat:b.fOptFit;e=parseInt(parseInt(e)/parseInt(Math.pow(10,c%10)))%10;a.addchk(e,d,100*e+c,function(a){var c=10>a%100?b.fOptStat:b.fOptFit,d=
parseInt(a/100);c-=(0<d?d:-1)*parseInt(Math.pow(10,a%10));10>a%100?(b.fOptStat=c,this.interactiveRedraw(!0,"exec:SetOptStat("+c+")")):(b.fOptFit=c,this.interactiveRedraw(!0,"exec:SetOptFit("+c+")"))})};a.add("Default position",function(){b.fX2NDC=JSROOT.gStyle.fStatX;b.fX1NDC=b.fX2NDC-JSROOT.gStyle.fStatW;b.fY2NDC=JSROOT.gStyle.fStatY;b.fY1NDC=b.fY2NDC-JSROOT.gStyle.fStatH;b.fInit=1;this.interactiveRedraw(!0,"pave_moved")});a.add("SetStatFormat",function(){var a=prompt("Enter StatFormat",b.fStatFormat);
a&&(b.fStatFormat=a,this.interactiveRedraw(!0,'exec:SetStatFormat("'+a+'")'))});a.add("SetFitFormat",function(){var a=prompt("Enter FitFormat",b.fFitFormat);a&&(b.fFitFormat=a,this.interactiveRedraw(!0,'exec:SetFitFormat("'+a+'")'))});a.add("separator");a.add("sub:SetOptStat",function(){var a=prompt("Enter OptStat",b.fOptStat);a&&(a=parseInt(a),!isNaN(a)&&0<=a&&(b.fOptStat=parseInt(a),this.interactiveRedraw(!0,"exec:SetOptStat("+a+")")))});d(0,"Histogram name");d(1,"Entries");d(2,"Mean");d(3,"Std Dev");
d(4,"Underflow");d(5,"Overflow");d(6,"Integral");d(7,"Skewness");d(8,"Kurtosis");a.add("endsub:");a.add("sub:SetOptFit",function(){var a=prompt("Enter OptStat",b.fOptFit);a&&(a=parseInt(a),!isNaN(a)&&0<=a&&(b.fOptFit=a,this.interactiveRedraw(!0,"exec:SetOptFit("+a+")")))});d(10,"Fit parameters");d(11,"Par errors");d(12,"Chi square / NDF");d(13,"Probability");a.add("endsub:");a.add("separator")}else"title"===b.fName&&a.add("Default position",function(){b.fX1NDC=.28;b.fY1NDC=.94;b.fX2NDC=.72;b.fY2NDC=
.99;b.fInit=1;this.interactiveRedraw(!0,"pave_moved")});this.UseTextColor&&a.addTextAttributesMenu(this);a.addAttributesMenu(this);0<a.size()&&a.add("Inspect",this.showInspector);return 0<a.size()};z.prototype.paveContextMenu=function(a){var b=this;if(this.z_handle){var d=this.getFramePainter();d&&d.showContextMenu&&d.showContextMenu("z",a)}else a.stopPropagation(),a.preventDefault(),v.createMenu(a,this).then(function(a){b.fillContextMenu(a);return b.fillObjectExecMenu(a,"title")}).then(function(a){return a.show()})};
z.prototype.isStats=function(){return this.matchObjectType("TPaveStats")};z.prototype.clearPave=function(){this.getObject().Clear()};z.prototype.addText=function(a){this.getObject().AddText(a)};z.prototype.fillFunctionStat=function(a,b){if(!b||!a)return!1;var d=b%10,c=Math.floor(b/10)%10,f=Math.floor(b/1E3)%10;0<Math.floor(b/100)%10&&this.addText("#chi^2 / ndf = "+this.format(a.fChisquare,"fit")+" / "+a.fNDF);0<f&&this.addText("Prob = "+("Math"in JSROOT?this.format(JSROOT.Math.Prob(a.fChisquare,a.fNDF)):
"<not avail>"));if(0<d)for(b=0;b<a.GetNumPars();++b){d=a.GetParName(b);f=a.GetParValue(b);var e=a.GetParError(b);f=void 0===f?"<not avail>":this.format(Number(f),"fit");void 0!==e&&(e=this.format(e,"last"),0===Number(e)&&0!=a.GetParError(b)&&(e=this.format(a.GetParError(b),"4.2g")));0<c&&e?this.addText(d+" = "+f+" #pm "+e):this.addText(d+" = "+f)}return!0};z.prototype.fillStatistic=function(){var a=this.getPadPainter();if(a&&a._fast_drawing)return!1;a=this.getObject();var b=a.$main_painter||this.getMainPainter();
if("stats"!==a.fName||!b||"function"!==typeof b.fillStatistic)return!1;var d=parseInt(a.fOptStat),c=parseInt(a.fOptFit);isNaN(d)&&(d=JSROOT.gStyle.fOptStat);isNaN(c)&&(c=JSROOT.gStyle.fOptFit);if(!b.fillStatistic(this,d,c))return!1;b=a.fLines.arr.length;d=b*JSROOT.gStyle.StatFontSize;if(0>=d||3===JSROOT.gStyle.StatFont%10)d=.25*b*JSROOT.gStyle.StatH,a.fY1NDC=a.fY2NDC-d;return!0};z.prototype.isDummyPos=function(a){return a?!a.fInit&&!a.fX1&&!a.fX2&&!a.fY1&&!a.fY2&&!a.fX1NDC&&!a.fX2NDC&&!a.fY1NDC&&
!a.fY2NDC:!0};z.prototype.updateObject=function(a){if(!this.matchObjectType(a))return!1;var b=this.getObject();b.modified_NDC||this.isDummyPos(a)||(this.stored&&!a.fInit&&this.stored.fX1==a.fX1&&this.stored.fX2==a.fX2&&this.stored.fY1==a.fY1&&this.stored.fY2==a.fY2?(this.stored.fX1NDC!=a.fX1NDC&&(b.fX1NDC=a.fX1NDC),this.stored.fX2NDC!=a.fX2NDC&&(b.fX2NDC=a.fX2NDC),this.stored.fY1NDC!=a.fY1NDC&&(b.fY1NDC=a.fY1NDC),this.stored.fY2NDC!=a.fY2NDC&&(b.fY2NDC=a.fY2NDC)):(b.fInit=a.fInit,b.fX1=a.fX1,b.fX2=
a.fX2,b.fY1=a.fY1,b.fY2=a.fY2,b.fX1NDC=a.fX1NDC,b.fX2NDC=a.fX2NDC,b.fY1NDC=a.fY1NDC,b.fY2NDC=a.fY2NDC),this.stored=JSROOT.extend({},a));b.fOption=a.fOption;b.fBorderSize=a.fBorderSize;switch(a._typename){case "TPaveText":return b.fLines=JSROOT.clone(a.fLines),!0;case "TPavesText":return b.fLines=JSROOT.clone(a.fLines),b.fNpaves=a.fNpaves,!0;case "TPaveLabel":return b.fLabel=a.fLabel,!0;case "TPaveStats":return b.fOptStat=a.fOptStat,b.fOptFit=a.fOptFit,!0;case "TLegend":var d=b.fPrimitives;b.fPrimitives=
a.fPrimitives;b.fNColumns=a.fNColumns;if(d&&d.arr&&b.fPrimitives&&b.fPrimitives.arr&&d.arr.length==b.fPrimitives.arr.length)for(a=0;a<d.arr.length;++a){var c=d.arr[a].fObject,f=b.fPrimitives.arr[a].fObject;c&&f&&c._typename==f._typename&&c.fName==f.fName&&(b.fPrimitives.arr[a].fObject=c)}return!0;case "TPaletteAxis":return b.fBorderSize=1,b.fShadowColor=0,!0}return!1};z.prototype.redraw=function(){this.drawPave()};z.prototype.cleanup=function(){this.z_handle&&(this.z_handle.cleanup(),delete this.z_handle);
JSROOT.ObjectPainter.prototype.cleanup.call(this)};var Q=function(a,b,d){var c=new JSROOT.TPavePainter(a,b);return v.ensureTCanvas(c,!1).then(function(){if("title"===b.fName&&"TPaveText"===b._typename){var f=c.getPadPainter().findPainterFor(null,"title");if(f&&f!==c)f.removeFromPadPrimitives(),f.cleanup();else if("postitle"==d||c.isDummyPos(b)){var e=JSROOT.gStyle;f=c.getFramePainter();if(e&&f){var g=e.fTitleX,h=e.fTitleY,t=e.fTitleW;e=e.fTitleH;!e&&f&&(e=.7*(h-f.fY2NDC));!t&&f&&(t=f.fX2NDC-f.fX1NDC);
if(!e||isNaN(e)||0>e)e=.06;if(!t||isNaN(t)||0>t)t=.44;b.fX1NDC=g-t/2;b.fY1NDC=h-e;b.fX2NDC=g+t/2;b.fY2NDC=h;b.fInit=1}}}else"TPaletteAxis"===b._typename&&(b.fBorderSize=1,b.fShadowColor=0,b.fAxis&&(b.fAxis.fChopt||(b.fAxis.fChopt="+"),b.fAxis.fNdiv||(b.fAxis.fNdiv=12),b.fAxis.fLabelOffset||(b.fAxis.fLabelOffset=.005)),c.z_handle=new JSROOT.TAxisPainter(a,b.fAxis,!0),c.z_handle.setPadName(c.getPadName()),c.UseContextMenu=!0);switch(b._typename){case "TPaveLabel":c.paveDrawFunc=c.drawPaveLabel;break;
case "TPaveStats":c.paveDrawFunc=c.drawPaveStats;c.$secondary=!0;break;case "TPaveText":case "TPavesText":case "TDiamond":c.paveDrawFunc=c.drawPaveText;break;case "TLegend":c.paveDrawFunc=c.drawPaveLegend;break;case "TPaletteAxis":c.paveDrawFunc=c.drawPaletteAxis}return c.drawPave(d)})};D.prototype.reset=function(){JSROOT.extend(this,{Axis:0,RevX:!1,RevY:!1,Bar:!1,BarStyle:0,Curve:!1,Hist:!0,Line:!1,Fill:!1,Error:!1,ErrorKind:-1,errorX:JSROOT.gStyle.fErrorX,Mark:!1,Same:!1,Scat:!1,ScatCoef:1,Func:!0,
Arrow:!1,Box:!1,BoxStyle:0,Text:!1,TextAngle:0,TextKind:"",Char:0,Color:!1,Contour:0,Lego:0,Surf:0,Off:0,Tri:0,Proj:0,AxisPos:0,Spec:!1,Pie:!1,List:!1,Zscale:!1,PadPalette:!1,Candle:"",GLBox:0,GLColor:!1,Project:"",System:v.Coord.kCARTESIAN,AutoColor:!1,NoStat:!1,ForceStat:!1,PadStats:!1,PadTitle:!1,AutoZoom:!1,HighRes:0,Zero:!0,Palette:0,BaseLine:!1,Optimize:JSROOT.settings.OptimizeDraw,Mode3D:!1,Render3D:JSROOT.constants.Render3D.Default,FrontBox:!0,BackBox:!0,_pmc:!1,_plc:!1,_pfc:!1,need_fillcol:!1,
minimum:-1111,maximum:-1111,ymin:0,ymax:0})};D.prototype.decode=function(a,b,d,c,f){this.orginal=a;var e=new JSROOT.DrawOptions(a);a="";if(1===b&&0<d.fSumw2.length)for(var g=0;g<d.fSumw2.length;++g)if(0<d.fSumw2[g]){this.Error=!0;this.Zero=this.Hist=!1;break}this.ndim=b||1;this.PadStats=e.check("USE_PAD_STATS");this.PadPalette=e.check("USE_PAD_PALETTE");this.PadTitle=e.check("USE_PAD_TITLE");e.check("PAL",!0)&&(this.Palette=e.partAsInt());e.check("MINIMUM:",!0)?this.minimum=parseFloat(e.part):this.minimum=
d.fMinimum;e.check("MAXIMUM:",!0)?this.maximum=parseFloat(e.part):this.maximum=d.fMaximum;e.check("YMIN:",!0)&&(this.ymin=parseFloat(e.part));e.check("YMAX:",!0)&&(this.ymax=parseFloat(e.part));e.check("NOOPTIMIZE")&&(this.Optimize=0);e.check("OPTIMIZE")&&(this.Optimize=2);e.check("AUTOCOL")&&(this.AutoColor=!0);e.check("AUTOZOOM")&&(this.AutoZoom=!0);e.check("OPTSTAT",!0)&&(this.optstat=e.partAsInt());e.check("OPTFIT",!0)&&(this.optfit=e.partAsInt());e.check("NOSTAT")&&(this.NoStat=!0);e.check("STAT")&&
(this.ForceStat=!0);e.check("NOTOOLTIP")&&f&&f.setTooltipAllowed(!1);e.check("TOOLTIP")&&f&&f.setTooltipAllowed(!0);e.check("LOGX")&&c&&(c.fLogx=1,c.fUxmin=0,c.fUxmax=1,c.fX1=0,c.fX2=1);e.check("LOGY")&&c&&(c.fLogy=1,c.fUymin=0,c.fUymax=1,c.fY1=0,c.fY2=1);e.check("LOGZ")&&c&&(c.fLogz=1);e.check("GRIDXY")&&c&&(c.fGridx=c.fGridy=1);e.check("GRIDX")&&c&&(c.fGridx=1);e.check("GRIDY")&&c&&(c.fGridy=1);e.check("TICKXY")&&c&&(c.fTickx=c.fTicky=1);e.check("TICKX")&&c&&(c.fTickx=1);e.check("TICKY")&&c&&(c.fTicky=
1);if(e.check("FILL_",!0))if(0<e.partAsInt(1))this.histoFillColor=e.partAsInt();else for(f=0;8>f;++f)v.getColor(f).toUpperCase()===e.part&&(this.histoFillColor=f);if(e.check("LINE_",!0))if(0<e.partAsInt(1))this.histoLineColor=v.root_colors[e.partAsInt()];else for(f=0;8>f;++f)v.getColor(f).toUpperCase()===e.part&&(this.histoLineColor=e.part);e.check("X+")&&(this.AxisPos=10);e.check("Y+")&&(this.AxisPos+=1);e.check("SAMES")&&(this.ForceStat=this.Same=!0);e.check("SAME")&&(this.Func=this.Same=!0);e.check("SPEC")&&
(this.Spec=!0);e.check("BASE0")||e.check("MIN0")?this.BaseLine=0:JSROOT.gStyle.fHistMinimumZero&&(this.BaseLine=0);e.check("PIE")&&(this.Pie=!0);e.check("CANDLE",!0)&&(this.Candle=e.part);e.check("GLBOX",!0)&&(this.GLBox=10+e.partAsInt());e.check("GLCOL")&&(this.GLColor=!0);e.check("GL");e.check("LEGO",!0)&&(this.Lego=1,0<=e.part.indexOf("0")&&(this.Zero=!1),0<=e.part.indexOf("1")&&(this.Lego=11),0<=e.part.indexOf("2")&&(this.Lego=12),0<=e.part.indexOf("3")&&(this.Lego=13),0<=e.part.indexOf("4")&&
(this.Lego=14),a=e.part,0<=e.part.indexOf("Z")&&(this.Zscale=!0));e.check("R3D_",!0)&&(this.Render3D=JSROOT.constants.Render3D.fromString(e.part.toLowerCase()));e.check("SURF",!0)&&(this.Surf=e.partAsInt(10,1),a=e.part,0<=e.part.indexOf("Z")&&(this.Zscale=!0));e.check("TF3",!0)&&(a=e.part);e.check("ISO",!0)&&(a=e.part);e.check("LIST")&&(this.List=!0);e.check("CONT",!0)&&1<b&&(this.Contour=1,0<=e.part.indexOf("Z")&&(this.Zscale=!0),0<=e.part.indexOf("1")?this.Contour=11:0<=e.part.indexOf("2")?this.Contour=
12:0<=e.part.indexOf("3")?this.Contour=13:0<=e.part.indexOf("4")&&(this.Contour=14));e.check("HBAR",!0)?this.BarStyle=20:e.check("BAR",!0)&&(this.BarStyle=10);0<this.BarStyle&&(this.Hist=!1,this.need_fillcol=!0,this.BarStyle+=e.partAsInt());e.check("ARR")&&(this.Arrow=!0);e.check("BOX",!0)&&(this.BoxStyle=10+e.partAsInt());this.Box=0<this.BoxStyle;e.check("COL")&&(this.Color=!0);e.check("CHAR")&&(this.Char=1);e.check("FUNC")&&(this.Func=!0,this.Hist=!1);e.check("AXIS")&&(this.Axis=1);e.check("AXIG")&&
(this.Axis=2);e.check("TEXT",!0)&&(this.Text=!0,this.Hist=!1,this.TextAngle=Math.min(e.partAsInt(),90),0<=e.part.indexOf("N")&&(this.TextKind="N"),0<=e.part.indexOf("E0")&&(this.TextLine=!0),0<=e.part.indexOf("E")&&(this.TextKind="E"));e.check("SCAT=",!0)&&(this.Scat=!0,this.ScatCoef=parseFloat(e.part),isNaN(this.ScatCoef)||0>=this.ScatCoef)&&(this.ScatCoef=1);e.check("SCAT")&&(this.Scat=!0);e.check("POL")&&(this.System=v.Coord.kPOLAR);e.check("CYL")&&(this.System=v.Coord.kCYLINDRICAL);e.check("SPH")&&
(this.System=v.Coord.kSPHERICAL);e.check("PSR")&&(this.System=v.Coord.kRAPIDITY);e.check("TRI",!0)&&(this.Color=!1,this.Tri=1,a=e.part,0<=e.part.indexOf("ERR")&&(this.Error=!0));e.check("AITOFF")&&(this.Proj=1);e.check("MERCATOR")&&(this.Proj=2);e.check("SINUSOIDAL")&&(this.Proj=3);e.check("PARABOLIC")&&(this.Proj=4);0<this.Proj&&(this.Contour=14);e.check("PROJX",!0)&&(this.Project="X"+e.partAsInt(0,1));e.check("PROJY",!0)&&(this.Project="Y"+e.partAsInt(0,1));a&&(0<=a.indexOf("FB")&&(this.FrontBox=
!1),0<=a.indexOf("BB")&&(this.BackBox=!1));3==b&&e.check("FB")&&(this.FrontBox=!1);3==b&&e.check("BB")&&(this.BackBox=!1);this._pfc=e.check("PFC");this._plc=e.check("PLC")||this.AutoColor;this._pmc=e.check("PMC");e.check("L")&&(this.Line=!0,this.Error=this.Hist=!1);e.check("F")&&(this.need_fillcol=this.Fill=!0);e.check("A")&&(this.Axis=-1);if(e.check("RX")||c&&c.$RX)this.RevX=!0;if(e.check("RY")||c&&c.$RY)this.RevY=!0;a=function(a,b,f){var g=e.check(a);c&&c["$"+a]&&(g=!0,c["$"+a]=void 0);g&&d&&(d[b].TestBit(f)||
d[b].InvertBit(f))};a("OTX","fXaxis",JSROOT.EAxisBits.kOppositeTitle);a("OTY","fYaxis",JSROOT.EAxisBits.kOppositeTitle);a("CTX","fXaxis",JSROOT.EAxisBits.kCenterTitle);a("CTY","fYaxis",JSROOT.EAxisBits.kCenterTitle);e.check("B1")&&(this.BarStyle=1,this.BaseLine=0,this.Hist=!1,this.need_fillcol=!0);e.check("B")&&(this.BarStyle=1,this.Hist=!1,this.need_fillcol=!0);e.check("C")&&(this.Curve=!0,this.Hist=!1);e.check("][")&&(this.Off=1,this.Hist=!0);e.check("HIST")&&(this.Func=this.Hist=!0,this.Error=
!1);this.Bar=0<this.BarStyle;delete this.MarkStyle;e.check("P0")&&(this.Mark=!0,this.Hist=!1,this.Zero=!0);e.check("P")&&(this.Mark=!0,this.Zero=this.Hist=!1);e.check("Z")&&(this.Zscale=!0);e.check("*")&&(this.Mark=!0,this.MarkStyle=3,this.Hist=!1);e.check("H")&&(this.Hist=!0);if(e.check("E",!0)&&(this.Error=!0,1==b)){this.Hist=this.Zero=!1;isNaN(parseInt(e.part[0]))||(this.ErrorKind=parseInt(e.part[0]));if(3===this.ErrorKind||4===this.ErrorKind)this.need_fillcol=!0;0===this.ErrorKind&&(this.Zero=
!0);0<=e.part.indexOf("X0")&&(this.errorX=0)}e.check("9")&&(this.HighRes=1);e.check("0")&&(this.Zero=!1);this.Color&&e.check("1")&&(this.Zero=!1);if(0<this.Lego||3==b||0<this.Surf||this.Error&&2==b)this.Mode3D=!0};D.prototype.asString=function(){var a="";this.Mode3D?(this.Lego?(a="LEGO",this.Zero||(a+="0"),10<this.Lego&&(a+=this.Lego-10),this.Zscale&&(a+="Z")):this.Surf&&(a="SURF"+(this.Surf-10),this.Zscale&&(a+="Z")),this.FrontBox||(a+="FB"),this.BackBox||(a+="BB")):(this.Scat?a="SCAT":this.Color?
(a="COL",this.Zero||(a+="0"),this.Zscale&&(a+="Z"),0>this.Axis&&(a+="A")):this.Contour?(a="CONT",10<this.Contour&&(a+=this.Contour-10),this.Zscale&&(a+="Z")):this.Bar?a=!1===this.BaseLine?"B":"B1":this.Mark?a=this.Zero?"P0":"P":this.Scat?a="SCAT":this.Error?(a="E",0<=this.ErrorKind&&(a+=this.ErrorKind)):this.Line&&(a+="L",this.Fill&&(a+="F")),this.Text&&(a+="TEXT",this.TextAngle&&(a+=this.TextAngle),a+=this.TextKind));return a};K.prototype.getLevels=function(){return this.arr};K.prototype.createNormal=
function(a,b,d){if(b){0>=this.colzmax&&(this.colzmax=1);0>=this.colzmin&&(this.colzmin=void 0===d||0>=d?1E-4*this.colzmax:3>d||100<d?.3*d:1);this.colzmin>=this.colzmax&&(this.colzmin=1E-4*this.colzmax);b=Math.log(this.colzmin)/Math.log(10);d=(Math.log(this.colzmax)/Math.log(10)-b)/a;this.arr.push(this.colzmin);for(var c=1;c<a;c++)this.arr.push(Math.exp((b+d*c)*Math.log(10)));this.arr.push(this.colzmax);this.custom=!0}else for(this.colzmin===this.colzmax&&0!==this.colzmin&&(this.colzmax+=.01*Math.abs(this.colzmax),
this.colzmin-=.01*Math.abs(this.colzmin)),b=(this.colzmax-this.colzmin)/a,d=0;d<=a;d++)this.arr.push(this.colzmin+b*d)};K.prototype.createCustom=function(a){this.custom=!0;for(var b=0;b<a.length;++b)this.arr.push(a[b]);this.colzmax>this.arr[this.arr.length-1]&&this.arr.push(this.colzmax)};K.prototype.configIndicies=function(a,b){this.below_min_indx=a;this.exact_min_indx=b};K.prototype.getContourIndex=function(a){if(this.custom){var b=0,d=this.arr.length-1;if(a<this.arr[0])return-1;if(a>=this.arr[d])return d;
for(;b<d-1;){var c=Math.round((b+d)/2);this.arr[c]>a?d=c:b=c}return b}return a<this.colzmin?this.below_min_indx:a===this.colzmin?this.exact_min_indx:Math.floor(.01+(a-this.colzmin)*(this.arr.length-1)/(this.colzmax-this.colzmin))};K.prototype.getPaletteColor=function(a,b){b=this.getContourIndex(b);if(0>b)return null;b=a.calcColorIndex(b,this.arr.length);return a.getColor(b)};K.prototype.getPaletteIndex=function(a,b){b=this.getContourIndex(b);return 0>b?null:a.calcColorIndex(b,this.arr.length)};var I=
{kNoStats:JSROOT.BIT(9),kUserContour:JSROOT.BIT(10),kCanRebin:JSROOT.BIT(11),kLogX:JSROOT.BIT(15),kIsZoomed:JSROOT.BIT(16),kNoTitle:JSROOT.BIT(17),kIsAverage:JSROOT.BIT(18)};q.prototype=Object.create(JSROOT.ObjectPainter.prototype);q.prototype.getHisto=function(){return this.getObject()};q.prototype.getAxis=function(a){var b=this.getObject();if(b)switch(a){case "x":return b.fXaxis;case "y":return b.fYaxis;case "z":return b.fZaxis}return null};q.prototype.isTProfile=function(){return this.matchObjectType("TProfile")};
q.prototype.isTH1K=function(){return this.matchObjectType("TH1K")};q.prototype.isTH2Poly=function(){return this.matchObjectType(/^TH2Poly/)||this.matchObjectType(/^TProfile2Poly/)};q.prototype.clear3DScene=function(){var a=this.getFramePainter();a&&"function"===typeof a.create3DScene&&a.create3DScene(-1);this.mode3d=!1};q.prototype.cleanup=function(){this.clear3DScene();delete this.fPalette;delete this.fContour;delete this.options;JSROOT.ObjectPainter.prototype.cleanup.call(this)};q.prototype.getDimension=
function(){var a=this.getHisto();return a?a._typename.match(/^TH2/)||a._typename.match(/^TProfile2D/)?2:a._typename.match(/^TH3/)?3:this.isTH2Poly()?2:1:0};q.prototype.decodeOptions=function(a){var b=this.getHisto(),d=this.getDimension(),c=this.getPadPainter();c=c?c.getRootPad(!0):null;this.options?this.options.reset():this.options=new D;this.options.decode(a||b.fOption,d,b,c,this);this.storeDrawOpt(a)};q.prototype.copyOptionsFrom=function(a){if(a!==this){var b=this.options;a=a.options;b.Mode3D=a.Mode3D;
b.Zero=a.Zero;a.Mode3D?(b.Lego=a.Lego,b.Surf=a.Surf):(b.Color=a.Color,b.Contour=a.Contour)}};q.prototype.copyOptionsToOthers=function(){var a=this;this.forEachPainter(function(b){b!==a&&"function"==typeof b.copyOptionsFrom&&b.copyOptionsFrom(a)},"objects")};q.prototype.scanContent=function(){};q.prototype.checkPadRange=function(a){this.isMainPainter()&&(this.check_pad_range=a?"pad_range":!0)};q.prototype.createAutoColor=function(a){if(!a){var b=this.getPadPainter().getRootPad(!0);a=b&&b.fPrimitves?
b.fPrimitves.arr.length:5}var d=this._auto_color||0;this._auto_color=d+1;if(b=this.getHistPalette())return 2>a&&(a=2),d>=a&&(d=a-1),a=Math.round(d*(b.getLength()-3)/(a-1)),b=b.getColor(a),this.addColor(b);this._auto_color%=8;return d+2};q.prototype.createHistDrawAttributes=function(){var a=this.getHisto();if(this.options._pfc||this.options._plc||this.options._pmc){var b=this.getMainPainter();b&&b.createAutoColor&&(b=b.createAutoColor(),this.options._pfc&&(a.fFillColor=b,delete this.fillatt),this.options._plc&&
(a.fLineColor=b,delete this.lineatt),this.options._pmc&&(a.fMarkerColor=b,delete this.markeratt),this.options._pfc=this.options._plc=this.options._pmc=!1)}this.createAttFill({attr:a,color:this.options.histoFillColor,kind:1});this.createAttLine({attr:a,color0:this.options.histoLineColor})};q.prototype.updateObject=function(a,b){var d=this.getHisto(),c=this.getFramePainter(),f=this.getPadPainter();if(a!==d){var e=function(a,b){a.fTitle=b.fTitle;a.fLabels=b.fLabels;a.fXmin=b.fXmin;a.fXmax=b.fXmax;a.fTimeDisplay=
b.fTimeDisplay;a.fTimeFormat=b.fTimeFormat;a.fAxisColor=b.fAxisColor;a.fLabelColor=b.fLabelColor;a.fLabelFont=b.fLabelFont;a.fLabelOffset=b.fLabelOffset;a.fLabelSize=b.fLabelSize;a.fNdivisions=b.fNdivisions;a.fTickLength=b.fTickLength;a.fTitleColor=b.fTitleColor;a.fTitleFont=b.fTitleFont;a.fTitleOffset=b.fTitleOffset;a.fTitleSize=b.fTitleSize};if(!this.matchObjectType(a))return!1;var g=f?f.findPainterFor(this.findStat()):null;d.TestBit(I.kNoStats)!=a.TestBit(I.kNoStats)&&(d.fBits=a.fBits,g&&(g.Enabled=
!d.TestBit(I.kNoStats)));void 0!==this.snapid&&(d.fName=a.fName);d.fFillColor=a.fFillColor;d.fFillStyle=a.fFillStyle;d.fLineColor=a.fLineColor;d.fLineStyle=a.fLineStyle;d.fLineWidth=a.fLineWidth;d.fEntries=a.fEntries;d.fTsumw=a.fTsumw;d.fTsumwx=a.fTsumwx;d.fTsumwx2=a.fTsumwx2;d.fXaxis.fNbins=a.fXaxis.fNbins;1<this.getDimension()&&(d.fTsumwy=a.fTsumwy,d.fTsumwy2=a.fTsumwy2,d.fTsumwxy=a.fTsumwxy,d.fYaxis.fNbins=a.fYaxis.fNbins,2<this.getDimension()&&(d.fTsumwz=a.fTsumwz,d.fTsumwz2=a.fTsumwz2,d.fTsumwxz=
a.fTsumwxz,d.fTsumwyz=a.fTsumwyz,d.fZaxis.fNbins=a.fZaxis.fNbins));d.fArray=a.fArray;d.fNcells=a.fNcells;d.fTitle=a.fTitle;d.fMinimum=a.fMinimum;d.fMaximum=a.fMaximum;e(d.fXaxis,a.fXaxis);e(d.fYaxis,a.fYaxis);e(d.fZaxis,a.fZaxis);this.snapid&&(e=function(a,b,d){c&&c.zoomChangedInteractive(d)||(a.fFirst=b.fFirst,a.fLast=b.fLast,a.fBits=b.fBits)},e(d.fXaxis,a.fXaxis,"x"),e(d.fYaxis,a.fYaxis,"y"),e(d.fZaxis,a.fZaxis,"z"));d.fSumw2=a.fSumw2;this.isTProfile()?d.fBinEntries=a.fBinEntries:this.isTH1K()?
(d.fNIn=a.fNIn,d.fReady=!1):this.isTH2Poly()&&(d.fBins=a.fBins);if(this.options.Func){var h=[];e=[];var t=this.hist_painter_id;f&&f.forEachPainterInPad(function(a){a.child_painter_id===t&&h.push(a)},"objects");if(a.fFunctions)for(var n=0;n<a.fFunctions.arr.length;++n){var k=a.fFunctions.arr[n];if(k&&k._typename&&this.needDrawFunc(d,k)){for(var m=null,u=-1,r=0;r<h.length;++r)if(h[r].matchObjectType(k._typename)&&h[r].getObject().fName===k.fName){m=h[r];u=r;break}!m&&k.fName&&(m=f?f.findPainterFor(null,
k.fName,k._typename):null);m?(m.updateObject(k),0<=u&&h.splice(u,1)):e.push(k)}}g&&(g=h.indexOf(g),0<=g&&h.splice(g,1));f&&0<h.length&&f.cleanPrimitives(function(a){return 0<=h.indexOf(a)});if(f&&0<e.length){g=[];var y=f.has_canvas?f.selectCurrentPad(f.this_pad_name):void 0;for(n=0;n<e.length;++n)g.push(JSROOT.draw(this.getDom(),e[n]));Promise.all(g).then(function(a){for(var b=0;b<a.length;++b)a[b]&&(a[b].child_painter_id=t);f.selectCurrentPad(y)})}}e=d.fOption!=a.fOption;d.fOption=a.fOption;(void 0!==
b&&this.options.original!==b||e)&&this.decodeOptions(b||d.fOption)}!this.snapid&&c&&c.zoomChangedInteractive()||this.checkPadRange();this.scanContent();return this.histogram_updated=!0};q.prototype.extractAxesProperties=function(a){function b(a){a.fXbins.length>=a.fNbins?(a.regular=!1,a.GetBinCoord=function(a){var b=Math.round(a);if(0>=b)return this.fXmin;if(b>this.fNbins)return this.fXmax;if(b==a)return this.fXbins[b];var c=a<b?b-1:b+1;return this.fXbins[b]*Math.abs(a-c)+this.fXbins[c]*Math.abs(a-
b)},a.FindBin=function(a,b){for(var c=1;c<this.fXbins.length;++c)if(a<this.fXbins[c])return Math.floor(c-1+b);return this.fNbins}):(a.regular=!0,a.binwidth=(a.fXmax-a.fXmin)/(a.fNbins||1),a.GetBinCoord=function(a){return this.fXmin+a*this.binwidth},a.FindBin=function(a,b){return Math.floor((a-this.fXmin)/this.binwidth+b)})}this.nbinsx=this.nbinsy=this.nbinsz=0;var d=this.getHisto();this.nbinsx=d.fXaxis.fNbins;this.xmin=d.fXaxis.fXmin;this.xmax=d.fXaxis.fXmax;b(d.fXaxis);this.ymin=d.fYaxis.fXmin;this.ymax=
d.fYaxis.fXmax;1<a&&(this.nbinsy=d.fYaxis.fNbins,b(d.fYaxis));2<a&&(this.nbinsz=d.fZaxis.fNbins,this.zmin=d.fZaxis.fXmin,this.zmax=d.fZaxis.fXmax,b(d.fZaxis))};q.prototype.drawAxes=function(){if(!this.isMainPainter())return Promise.resolve(!1);var a=this.getFramePainter();if(!a)return Promise.resolve(!1);var b=this.getHisto();this.ymin===this.ymax&&(this.ymax+=1);a.setAxesRanges(b.fXaxis,this.xmin,this.xmax,b.fYaxis,this.ymin,this.ymax,b.fZaxis,0,0);a.createXY({ndim:this.getDimension(),check_pad_range:this.check_pad_range,
zoom_ymin:this.zoom_ymin,zoom_ymax:this.zoom_ymax,ymin_nz:this.ymin_nz,swap_xy:20<=this.options.BarStyle,reverse_x:this.options.RevX,reverse_y:this.options.RevY,Proj:this.options.Proj,extra_y_space:this.options.Text&&0<this.options.BarStyle});delete this.check_pad_range;return this.options.Same?Promise.resolve(!1):a.drawAxes(!1,0>this.options.Axis,this.options.AxisPos,this.options.Zscale)};q.prototype.toggleTitle=function(a){var b=this.getHisto();if(!this.isMainPainter()||!b)return!1;if("only-check"===
a)return!b.TestBit(I.kNoTitle);b.InvertBit(I.kNoTitle);this.drawHistTitle()};q.prototype.drawHistTitle=function(){var a=this;if(!this.isMainPainter()||this.options.Same)return Promise.resolve(!0);var b=this.getHisto(),d=JSROOT.gStyle,c=this.getPadPainter(),f=c?c.findPainterFor(null,"title"):null,e=f?f.getObject():null;!e&&c&&c.findInPrimitives&&(e=c.findInPrimitives("title"));e&&"TPaveText"!==e._typename&&(e=null);c=!b.TestBit(I.kNoTitle)&&0<d.fOptTitle;if(e)e.Clear(),c&&e.AddText(b.fTitle),f&&f.redraw();
else if(c&&!f&&b.fTitle&&!this.options.PadTitle)return e=JSROOT.create("TPaveText"),e.fName="title",e.fTextFont=d.fTitleFont,e.fTextSize=d.fTitleFontSize,e.fTextColor=d.fTitleTextColor,e.fTextAlign=d.fTitleAlign,e.fFillColor=d.fTitleColor,e.fFillStyle=d.fTitleStyle,e.fBorderSize=d.fTitleBorderSize,e.AddText(b.fTitle),Q(this.getDom(),e,"postitle").then(function(b){b&&(b.$secondary=!0);return a});return Promise.resolve(this)};q.prototype.processTitleChange=function(a){var b=this.getHisto(),d=this.getPadPainter();
d=d?d.findPainterFor(null,"title"):null;if(!b||!d)return null;if("check"===a)return!this.isMainPainter()||this.options.Same?null:b;d.clearPave();d.addText(b.fTitle);d.redraw();this.submitCanvExec('SetTitle("'+b.fTitle+'")')};q.prototype.updateStatWebCanvas=function(){if(this.snapid){var a=this.findStat(),b=this.getPadPainter();(a=b?b.findPainterFor(a):null)&&!a.snapid&&a.redraw()}};q.prototype.findStat=function(){if(this.options.PadStats){var a=this.getPadPainter();return(a=a?a.findPainterFor(null,
"stats","TPaveStats"):null)?a.getObject():null}return this.findFunction("TPaveStats","stats")};q.prototype.toggleStat=function(a){var b=this,d=this.findStat(),c=this.getPadPainter(),f=null;a||(a="");if(d)f=c?c.findPainterFor(d):null;else{if(0<a.indexOf("-check"))return!1;d=this.createStat(!0)}if("only-check"==a)return f?f.Enabled:!1;if("fitpar-check"==a)return d?d.fOptFit:!1;if("fitpar-toggle"==a){if(!d)return!1;d.fOptFit=d.fOptFit?0:1111;f&&f.redraw();return!0}if(f)return f.Enabled=!f.Enabled,f.redraw(),
f.Enabled;var e=this.selectCurrentPad(this.getPadName());JSROOT.draw(this.getDom(),d).then(function(){b.selectCurrentPad(e)});return!0};q.prototype.isIgnoreStatsFill=function(){return!this.getObject()||!this.draw_content&&!this.create_stats||0<this.options.Axis};q.prototype.createStat=function(a){var b=this.getHisto();if(this.options.PadStats||!b||!(a||this.options.ForceStat||!this.options.NoStat&&!b.TestBit(I.kNoStats)&&JSROOT.settings.AutoStat&&this.draw_content&&this.isMainPainter()))return null;
a=this.findStat();var d=JSROOT.gStyle,c=this.options.optstat,f=this.options.optfit;void 0!==c?(a&&(a.fOptStat=c),delete this.options.optstat):c=b.$custom_stat||d.fOptStat;void 0!==f?(a&&(a.fOptFit=f),delete this.options.optfit):f=d.fOptFit;if(!a&&!c&&!f)return null;this.create_stats=!0;if(a)return a;a=JSROOT.create("TPaveStats");JSROOT.extend(a,{fName:"stats",fOptStat:c,fOptFit:f,fBorderSize:1});a.fX1NDC=d.fStatX-d.fStatW;a.fY1NDC=d.fStatY-d.fStatH;a.fX2NDC=d.fStatX;a.fY2NDC=d.fStatY;a.fFillColor=
d.fStatColor;a.fFillStyle=d.fStatStyle;a.fTextAngle=0;a.fTextSize=d.fStatFontSize;a.fTextAlign=12;a.fTextColor=d.fStatTextColor;a.fTextFont=d.fStatFont;if(b._typename.match(/^TProfile/)||b._typename.match(/^TH2/))a.fY1NDC=.67;a.AddText(b.fName);this.addFunction(a);return a};q.prototype.findFunction=function(a,b){var d=this.getHisto();d=d&&d.fFunctions?d.fFunctions.arr:null;if(!d)return null;for(var c=0;c<d.length;++c)if((!b||d[c].fName===b)&&d[c]._typename===a)return d[c];return null};q.prototype.addFunction=
function(a,b){var d=this.getHisto();d&&a&&(d.fFunctions||(d.fFunctions=JSROOT.create("TList")),b?d.fFunctions.AddFirst(a):d.fFunctions.Add(a))};q.prototype.needDrawFunc=function(a,b){return"TPaveText"===b._typename||"TPaveStats"===b._typename?!a.TestBit(I.kNoStats)&&!this.options.NoStat:"TF1"===b._typename?!b.TestBit(JSROOT.BIT(9)):"TPaletteAxis"!==b._typename};q.prototype.drawNextFunction=function(a){var b=this,d=this.getHisto();if(!this.options.Func||!d.fFunctions||a>=d.fFunctions.arr.length)return Promise.resolve(!0);
var c=d.fFunctions.arr[a],f=d.fFunctions.opt[a],e=this.getPadPainter(),g=!1;null===(e?e.findPainterFor(c):null)&&(g=this.needDrawFunc(d,c));return g?JSROOT.draw(this.getDom(),c,f).then(function(c){c&&"object"==typeof c&&(c.child_painter_id=b.hist_painter_id);return b.drawNextFunction(a+1)}):this.drawNextFunction(a+1)};q.prototype.getSelectIndex=function(a,b,d){var c=this.getFramePainter(),f=this["nbins"+a]||0,e=this.getAxis(a),g=c?c["zoom_"+a+"min"]:0;a=c?c["zoom_"+a+"max"]:0;g!==a&&e?(d="left"==
b?e.FindBin(g,d||0):e.FindBin(a,(d||0)+.5),0>d?d=0:d>f&&(d=f)):d="left"==b?0:f;e&&(e.fFirst===e.fLast||!e.TestBit(JSROOT.EAxisBits.kAxisRange)||1>=e.fFirst&&e.fLast>=f)&&(e=void 0);"left"==b?(0>d&&(d=0),e&&1<e.fFirst&&d<e.fFirst&&(d=e.fFirst-1)):(d>f&&(d=f),e&&e.fLast<=f&&d>e.fLast&&(d=e.fLast));return d};q.prototype.unzoomUserRange=function(a,b,d){var c=this,f=!1,e=this.getHisto();if(!e)return!1;var g=function(a){if(!a||!a.TestBit(JSROOT.EAxisBits.kAxisRange)||a.fFirst===a.fLast||1>=a.fFirst&&a.fLast>=
a.fNbins)return!1;a.InvertBit(JSROOT.EAxisBits.kAxisRange);return!0},h=function(a){if(c.getDimension()!==a||-1111===c.options.minimum&&-1111===c.options.maximum||!c.draw_content)return!1;c.options.minimum=c.options.maximum=-1111;c.scanContent(!0);return!0};a&&g(e.fXaxis)&&(f=!0);b&&(g(e.fYaxis)||h(1))&&(f=!0);d&&(g(e.fZaxis)||h(2))&&(f=!0);return f};q.prototype.addInteractivity=function(){var a=this.isMainPainter()?this.getFramePainter():null;return a?a.addInteractivity():Promise.resolve(!1)};q.prototype.changeUserRange=
function(a){var b=this.getHisto();if(b=b?b["f"+a+"axis"]:null){var d="[1,"+b.fNbins+"]";b.TestBit(JSROOT.EAxisBits.kAxisRange)&&(d="["+b.fFirst+","+b.fLast+"]");if(a=prompt("Enter user range for axis "+a+" like [1,"+b.fNbins+"]",d))!(a=JSON.parse(a))||2!=a.length||isNaN(a[0])||isNaN(a[1])||(b.fFirst=parseInt(a[0]),b.fLast=parseInt(a[1]),(b.fFirst<b.fLast&&1<=b.fFirst&&b.fLast<=b.fNbins)!=b.TestBit(JSROOT.EAxisBits.kAxisRange)&&b.InvertBit(JSROOT.EAxisBits.kAxisRange),this.redraw())}};q.prototype.changeValuesRange=
function(){var a=prompt("Enter min/max hist values or empty string to reset",-1111!=this.options.minimum&&-1111!=this.options.maximum?"["+this.options.minimum+","+this.options.maximum+"]":"["+this.gminbin+","+this.gmaxbin+"]");a=a?JSON.parse(a):[];!a||"object"!=typeof a||2!=a.length||isNaN(a[0])||isNaN(a[1])?this.options.minimum=this.options.maximum=-1111:(this.options.minimum=a[0],this.options.maximum=a[1]);this.redrawPad()};q.prototype.fillContextMenu=function(a){var b=this,d=this.getHisto(),c=
this.getFramePainter();if(d){a.add("header:"+d._typename+"::"+d.fName);this.draw_content&&(a.addchk(this.toggleStat("only-check"),"Show statbox",function(){return b.toggleStat()}),1==this.getDimension()?a.add("User range X",function(){return b.changeUserRange("X")}):(a.add("sub:User ranges"),a.add("X",function(){return b.changeUserRange("X")}),a.add("Y",function(){return b.changeUserRange("Y")}),2<this.getDimension()?a.add("Z",function(){return b.changeUserRange("Z")}):a.add("Values",function(){return b.changeValuesRange()}),
a.add("endsub:")),"function"==typeof this.fillHistContextMenu&&this.fillHistContextMenu(a));if(this.options.Mode3D){0<a.size()&&a.add("separator");var f=this.getMainPainter()||this;a.addchk(f.isTooltipAllowed(),"Show tooltips",function(){f.setTooltipAllowed("toggle")});a.addchk(c.enable_highlight,"Highlight bins",function(){c.enable_highlight=!c.enable_highlight;!c.enable_highlight&&c.highlightBin3D&&c.mode3d&&c.highlightBin3D(null)});c&&c.render3D&&(a.addchk(f.options.FrontBox,"Front box",function(){f.options.FrontBox=
!f.options.FrontBox;c.render3D()}),a.addchk(f.options.BackBox,"Back box",function(){f.options.BackBox=!f.options.BackBox;c.render3D()}));this.draw_content&&(a.addchk(!this.options.Zero,"Suppress zeros",function(){this.options.Zero=!this.options.Zero;this.interactiveRedraw("pad")}),12==this.options.Lego||14==this.options.Lego)&&(a.addchk(this.options.Zscale,"Z scale",function(){return b.toggleColz()}),this.fillPaletteMenu&&this.fillPaletteMenu(a));f.control&&"function"===typeof f.control.reset&&a.add("Reset camera",
function(){f.control.reset()})}a.addAttributesMenu(this);this.histogram_updated&&c.zoomChangedInteractive()&&a.add("Let update zoom",function(){c.zoomChangedInteractive("reset")});return!0}};q.prototype.clickButton=function(a){var b=this.getFramePainter();if(!this.isMainPainter()||!b)return!1;switch(a){case "ToggleZoom":if(b.zoom_xmin!==b.zoom_xmax||b.zoom_ymin!==b.zoom_ymax||b.zoom_zmin!==b.zoom_zmax)return b.unzoom(),b.zoomChangedInteractive("reset"),!0;if(this.draw_content&&"function"===typeof this.autoZoom)return this.autoZoom(),
!0;break;case "ToggleLogX":b.toggleAxisLog("x");break;case "ToggleLogY":b.toggleAxisLog("y");break;case "ToggleLogZ":b.toggleAxisLog("z");break;case "ToggleStatBox":return this.toggleStat(),!0}return!1};q.prototype.fillToolbar=function(a){var b=this.getPadPainter();b&&(b.addPadButton("auto_zoom","Toggle between unzoom and autozoom-in","ToggleZoom","Ctrl *"),b.addPadButton("arrow_right","Toggle log x","ToggleLogX","PageDown"),b.addPadButton("arrow_up","Toggle log y","ToggleLogY","PageUp"),1<this.getDimension()&&
b.addPadButton("arrow_diag","Toggle log z","ToggleLogZ"),this.draw_content&&b.addPadButton("statbox","Toggle stat box","ToggleStatBox"),a||b.showPadButtons())};q.prototype.get3DToolTip=function(a){var b=this.getHisto(),d={bin:a,name:b.fName,title:b.fTitle};switch(this.getDimension()){case 1:d.ix=a;d.iy=1;d.value=b.getBinContent(d.ix);d.error=b.getBinError(a);d.lines=this.getBinTooltips(a-1);break;case 2:d.ix=a%(this.nbinsx+2);d.iy=(a-d.ix)/(this.nbinsx+2);d.value=b.getBinContent(d.ix,d.iy);d.error=
b.getBinError(a);d.lines=this.getBinTooltips(d.ix-1,d.iy-1);break;case 3:d.ix=a%(this.nbinsx+2),d.iy=(a-d.ix)/(this.nbinsx+2)%(this.nbinsy+2),d.iz=(a-d.ix-d.iy*(this.nbinsx+2))/(this.nbinsx+2)/(this.nbinsy+2),d.value=b.getBinContent(d.ix,d.iy,d.iz),d.error=b.getBinError(a),d.lines=this.getBinTooltips(d.ix-1,d.iy-1,d.iz-1)}return d};q.prototype.createContour=function(a,b,d,c,f){b=new K(b,d);f?b.createCustom(f):(2>a&&(a=JSROOT.gStyle.fNumberContours),f=this.getPadPainter().getRootPad(!0),b.createNormal(a,
f?f.fLogz:0,c),b.configIndicies(this.options.Zero?-1:0,0!=b.colzmin||!this.options.Zero||this.isTH2Poly()?0:-1));a=this.getFramePainter();3>this.getDimension()&&a&&(a.zmin=b.colzmin,a.zmax=b.colzmax);return this.fContour=b};q.prototype.getContour=function(a){if(this.fContour&&!a)return this.fContour;var b=this.getMainPainter();a=this.getFramePainter();if(b&&b!==this&&b.fContour)return this.fContour=b.fContour;b=this.getObject();var d=0,c=this.minbin,f=this.maxbin,e=this.minposbin,g;c===f&&(c=this.gminbin,
f=this.gmaxbin,e=this.gminposbin);-1111!==this.options.minimum&&-1111!=this.options.maximum&&(c=this.options.minimum,f=this.options.maximum);a&&a.zoom_zmin!=a.zoom_zmax&&(c=a.zoom_zmin,f=a.zoom_zmax);b.fContour&&1<b.fContour.length&&(b.TestBit(I.kUserContour)?g=b.fContour:d=b.fContour.length);return this.createContour(d,c,f,e,g)};q.prototype.getContourLevels=function(){return this.getContour().getLevels()};q.prototype.getHistPalette=function(a){a&&(this.fPalette=null);this.fPalette||this.options.Palette||
(a=this.getPadPainter())&&a.getCustomPalette&&(this.fPalette=a.getCustomPalette());this.fPalette||(this.fPalette=F(this.options.Palette));return this.fPalette};q.prototype.fillPaletteMenu=function(a){var b=this,d=this.options.Palette||JSROOT.settings.Palette,c=function(c,e,g){return a.addchk(c===d||g,"<nobr>"+e+"</nobr>",c,function(a){b.options.Palette=parseInt(a);b.getHistPalette(!0);b.redraw()})};a.add("sub:Palette");c(50,"ROOT 5",10<=d&&51>d);c(51,"Deep Sea");c(52,"Grayscale",0<d&&10>d);c(53,"Dark body radiator");
c(54,"Two-color hue");c(55,"Rainbow");c(56,"Inverted dark body radiator");c(57,"Bird",113<d);c(58,"Cubehelix");c(59,"Green Red Violet");c(60,"Blue Red Yellow");c(61,"Ocean");c(62,"Color Printable On Grey");c(63,"Alpine");c(64,"Aquamarine");c(65,"Army");c(66,"Atlantic");a.add("endsub:")};q.prototype.drawColorPalette=function(a,b,d){var c=this;if(!this.isMainPainter())return Promise.resolve(null);var f=this.findFunction("TPaletteAxis"),e=this.getPadPainter(),g=e?e.findPainterFor(f):null;this._can_move_colz&&
(d=!0,delete this._can_move_colz);g||f||!(g=e?e.findPainterFor(void 0,void 0,"TPaletteAxis"):null)||(f=g.getObject(),this.addFunction(f,!0));if(!a)return g&&(g.Enabled=!1,g.removeG()),Promise.resolve(null);if(!f){if(this.options.PadPalette)return Promise.resolve(null);f=JSROOT.create("TPave");JSROOT.extend(f,{_typename:"TPaletteAxis",fName:"TPave",fH:null,fAxis:JSROOT.create("TGaxis"),fX1NDC:.91,fX2NDC:.95,fY1NDC:.1,fY2NDC:.9,fInit:1});a=this.getHisto().fZaxis;JSROOT.extend(f.fAxis,{fTitle:a.fTitle,
fTitleSize:a.fTitleSize,fChopt:"+",fLineColor:a.fAxisColor,fLineSyle:1,fLineWidth:1,fTextAngle:0,fTextSize:a.fLabelSize,fTextAlign:11,fTextColor:a.fLabelColor,fTextFont:a.fLabelFont});this.addFunction(f,!0);d=!0}var h=this.getFramePainter();d&&h&&(f.fX2NDC=h.fX2NDC+.01+(f.fX2NDC-f.fX1NDC),f.fX1NDC=h.fX2NDC+.01,f.fY1NDC=h.fY1NDC,f.fY2NDC=h.fY2NDC);a="";b&&(a+=";postpone");d&&!this.do_redraw_palette&&(a+=";can_move");if(g)g.Enabled=!0,g=g.drawPave(a);else{var t=this.selectCurrentPad(this.getPadName());
g=Q(this.getDom(),f,a).then(function(a){c.selectCurrentPad(t);return a})}return g.then(function(a){a.$secondary=!0;a.redraw=function(){};d&&h&&f.fX1NDC-.005<h.fX2NDC&&!c.do_redraw_palette&&(c.do_redraw_palette=!0,h.fX2NDC=f.fX1NDC-.01,h.redraw(),b||c.redraw(),delete c.do_redraw_palette);return a})};q.prototype.toggleColz=function(){if(this.options.Mode3D?12===this.options.Lego||14===this.options.Lego||11===this.options.Surf||12===this.options.Surf:this.options.Color||this.options.Contour)this.options.Zscale=
!this.options.Zscale,this.drawColorPalette(this.options.Zscale,!1,!0)};q.prototype.toggleMode3D=function(){this.options.Mode3D=!this.options.Mode3D;!this.options.Mode3D||this.options.Surf||this.options.Lego||this.options.Error||(this.options.Lego=50<=this.nbinsx||50<=this.nbinsy?this.options.Color?14:13:this.options.Color?12:1,this.options.Zero=!1);this.copyOptionsToOthers();this.interactiveRedraw("pad","drawopt")};q.prototype.prepareColorDraw=function(a){a||(a={rounding:!0,extra:0,middle:0});void 0===
a.extra&&(a.extra=0);void 0===a.middle&&(a.middle=0);var b=this.getHisto(),d=b.fXaxis,c=b.fYaxis,f=this.getFramePainter(),e=this.getDimension(),g,h={i1:this.getSelectIndex("x","left",0-a.extra),i2:this.getSelectIndex("x","right",1+a.extra),j1:1===e?0:this.getSelectIndex("y","left",0-a.extra),j2:1===e?1:this.getSelectIndex("y","right",1+a.extra),min:0,max:0,sumz:0,xbar1:0,xbar2:1,ybar1:0,ybar2:1};h.grx=new Float32Array(h.i2+1);h.gry=new Float32Array(h.j2+1);"number"!=typeof b.fBarOffset||"number"!=
typeof b.fBarWidth||!b.fBarOffset&&1E3===b.fBarWidth||(1E3>=b.fBarOffset?h.xbar1=h.ybar1=.001*b.fBarOffset:3E3>=b.fBarOffset?h.xbar1=.001*(b.fBarOffset-2E3):5E3>=b.fBarOffset&&(h.ybar1=.001*(b.fBarOffset-4E3)),1E3>=b.fBarWidth?(h.xbar2=Math.min(1,h.xbar1+.001*b.fBarWidth),h.ybar2=Math.min(1,h.ybar1+.001*b.fBarWidth)):3E3>=b.fBarWidth?h.xbar2=Math.min(1,h.xbar1+.001*(b.fBarWidth-2E3)):5E3>=b.fBarWidth&&(h.ybar2=Math.min(1,h.ybar1+.001*(b.fBarWidth-4E3))));a.original&&(h.original=!0,h.origx=new Float32Array(h.i2+
1),h.origy=new Float32Array(h.j2+1));a.pixel_density&&(a.rounding=!0);if(!f)return console.warn("cannot draw histogram without frame"),h;for(g=h.i1;g<=h.i2;++g){var t=d.GetBinCoord(g+a.middle);f.logx&&0>=t?h.i1=g+1:(h.origx&&(h.origx[g]=t),h.grx[g]=f.grx(t),a.rounding&&(h.grx[g]=Math.round(h.grx[g])),a.use3d&&(h.grx[g]<-f.size_xy3d&&(h.i1=g,h.grx[g]=-f.size_xy3d),h.grx[g]>f.size_xy3d&&(h.i2=g,h.grx[g]=f.size_xy3d)))}if(1===e)h.gry[0]=f.gry(0),h.gry[1]=f.gry(1);else for(d=h.j1;d<=h.j2;++d)g=c.GetBinCoord(d+
a.middle),f.logy&&0>=g?h.j1=d+1:(h.origy&&(h.origy[d]=g),h.gry[d]=f.gry(g),a.rounding&&(h.gry[d]=Math.round(h.gry[d])),a.use3d&&(h.gry[d]<-f.size_xy3d&&(h.j1=d,h.gry[d]=-f.size_xy3d),h.gry[d]>f.size_xy3d&&(h.j2=d,h.gry[d]=f.size_xy3d)));b.getBinContent(h.i1+1,h.j1+1);this.maxbin=this.minbin=this.minposbin=null;for(g=h.i1;g<h.i2;++g)for(d=h.j1;d<h.j2;++d){c=b.getBinContent(g+1,d+1);h.sumz+=c;if(a.pixel_density){f=(h.grx[g+1]-h.grx[g])*(h.gry[d]-h.gry[d+1]);if(0>=f)continue;h.max=Math.max(h.max,c);
0<c&&(c<h.min||0===h.min)&&(h.min=c);c/=f}null===this.maxbin?this.maxbin=this.minbin=c:(this.maxbin=Math.max(this.maxbin,c),this.minbin=Math.min(this.minbin,c));0<c&&(null===this.minposbin||c<this.minposbin)&&(this.minposbin=c)}this.fContour=null;return h};q.prototype.getAxisBinTip=function(a,b,d){var c=this.getFramePainter(),f=c[a+"_handle"],e=b.GetBinLowEdge(d+1);if("labels"===f.kind)return c.axisAsText(a,e);b=b.GetBinLowEdge(d+2);return"time"===f.kind?c.axisAsText(a,(e+b)/2):"["+c.axisAsText(a,
e)+", "+c.axisAsText(a,b)+")"};G.prototype=Object.create(q.prototype);G.prototype.convertTH1K=function(){var a=this.getObject();if(!a.fReady){var b=a.fArray,d=a.fEntries;a.fNcells=a.fXaxis.fNbins+2;a.fArray=new Float64Array(a.fNcells);for(var c=0;c<a.fNcells;++c)a.fArray[c]=0;for(c=0;c<a.fNIn;++c)a.Fill(b[c]);a.fReady=!0;a.fEntries=d}};G.prototype.scanContent=function(a){a&&!this.nbinsx&&(a=!1);this.isTH1K()&&this.convertTH1K();var b=this.getHisto();a||this.extractAxesProperties(1);var d=this.getSelectIndex("x",
"left"),c=this.getSelectIndex("x","right");if(!a||d!==this.scan_xleft||c!==this.scan_xright){this.draw_content=!(0<this.options.Axis);this.scan_xleft=d;this.scan_xright=c;for(var f=0,e=0,g=0,h=0,t=!0,n=this.isTProfile(),k,m,u=0;u<this.nbinsx;++u)k=b.getBinContent(u+1),h+=n?b.fBinEntries[u+1]:k,u<d||u>=c||(0<k&&(0==e||k<e)&&(e=k),t&&(f=g=k,t=!1),m=this.options.Error?b.getBinError(u+1):0,f=Math.min(f,k-m),g=Math.max(g,k+m));this.stat_entries=h=n?h+(b.fBinEntries[0]+b.fBinEntries[this.nbinsx+1]):h+(b.getBinContent(0)+
b.getBinContent(this.nbinsx+1));1<b.fEntries&&(this.stat_entries=b.fEntries);this.hmin=f;this.hmax=g;this.ymin_nz=e;if(0==this.nbinsx||1E-300>Math.abs(f)&&1E-300>Math.abs(g))this.draw_content=!1;d=b=!1;this.draw_content?f>=g?0==f?(this.ymin=0,this.ymax=1):0>f?(this.ymin=2*f,this.ymax=0):(this.ymin=0,this.ymax=2*f):(c=.05*(g-f),this.ymin=f-c,0>this.ymin&&0<=f&&(this.ymin=0),this.ymax=g+c):this.options.ymin!==this.options.ymax&&(this.ymin=this.options.ymin,this.ymax=this.options.ymax,d=!0);f=this.options.minimum;
g=this.options.maximum;f===g&&-1111!==f&&(0>f?(f*=2,g=0):(f=0,(g*=2)||(g=1)));-1111==f||-1111==g||this.draw_content||d?(-1111!=f&&(f<this.ymin?this.ymin=f:b=!0),-1111!=g&&(g>this.ymax?this.ymax=g:b=!0)):(this.ymin=f,this.ymax=g);a||(b&&(this.draw_content||d)?(this.zoom_ymin=-1111==f?this.ymin:f,this.zoom_ymax=-1111==g?this.ymax:g):(delete this.zoom_ymin,delete this.zoom_ymax));this.wheel_zoomy=1<this.getDimension()||!this.draw_content}};G.prototype.countStat=function(a){for(var b=this.isTProfile(),
d=this.getHisto(),c=d.fXaxis,f=this.getSelectIndex("x","left"),e=this.getSelectIndex("x","right"),g=0,h=0,t=0,n=0,k=0,m,u,r=null,y=null,p=this.getFramePainter(),x={name:d.fName,meanx:0,meany:0,rmsx:0,rmsy:0,integral:0,entries:this.stat_entries,xmax:0,wmax:0};f<e;++f)if(m=c.GetBinCoord(f+.5),!a||a(m)){b?(u=d.fBinEntries[f+1],n+=d.fArray[f+1],k+=d.fSumw2[f+1]):u=d.getBinContent(f+1);if(null===r||u>y)r=m,y=u;g+=u;h+=u*m;t+=u*m*m}!p.isAxisZoomed("x")&&0<d.fTsumw&&(g=d.fTsumw,h=d.fTsumwx,t=d.fTsumwx2);
x.integral=g;0<g&&(x.meanx=h/g,x.meany=n/g,x.rmsx=Math.sqrt(Math.abs(t/g-x.meanx*x.meanx)),x.rmsy=Math.sqrt(Math.abs(k/g-x.meany*x.meany)));null!==r&&(x.xmax=r,x.wmax=y);return x};G.prototype.fillStatistic=function(a,b,d){if(this.isIgnoreStatsFill())return!1;var c=this.getHisto(),f=this.countStat(),e=b%10,g=Math.floor(b/10)%10,h=Math.floor(b/100)%10,t=Math.floor(b/1E3)%10,n=Math.floor(b/1E4)%10,k=Math.floor(b/1E5)%10,m=Math.floor(b/1E6)%10,u=Math.floor(b/1E7)%10;b=Math.floor(b/1E8)%10;a.clearPave();
0<e&&a.addText(f.name);this.isTProfile()?(0<g&&a.addText("Entries = "+a.format(f.entries,"entries")),0<h&&(a.addText("Mean = "+a.format(f.meanx)),a.addText("Mean y = "+a.format(f.meany))),0<t&&(a.addText("Std Dev = "+a.format(f.rmsx)),a.addText("Std Dev y = "+a.format(f.rmsy)))):(0<g&&a.addText("Entries = "+a.format(f.entries,"entries")),0<h&&a.addText("Mean = "+a.format(f.meanx)),0<t&&a.addText("Std Dev = "+a.format(f.rmsx)),0<n&&a.addText("Underflow = "+a.format(0<c.fArray.length?c.fArray[0]:0,
"entries")),0<k&&a.addText("Overflow = "+a.format(0<c.fArray.length?c.fArray[c.fArray.length-1]:0,"entries")),0<m&&a.addText("Integral = "+a.format(f.integral,"entries")),0<u&&a.addText("Skew = <not avail>"),0<b&&a.addText("Kurt = <not avail>"));d&&a.fillFunctionStat(this.findFunction("TF1"),d);return!0};G.prototype.drawBars=function(a){this.createG(!0);var b=this.getSelectIndex("x","left",-1),d=this.getSelectIndex("x","right",1),c=this.getFramePainter(),f=this.getHisto(),e=f.fXaxis,g=this.options.Text,
h="",t="",n="",k=10<this.options.BarStyle?this.options.BarStyle%10:0;4<k&&(k=4);var m=c.swap_xy?0:a;!1===this.options.BaseLine||isNaN(this.options.BaseLine)||this.options.BaseLine>=c.scale_ymin&&(m=Math.round(c.gry(this.options.BaseLine)));if(g){var u=this.getColor(f.fMarkerColor);var r=-1*this.options.TextAngle;var y=20;1!==f.fMarkerSize&&r&&(y=.02*a*f.fMarkerSize);this.startTextDrawing(42,y,this.draw_g,y)}for(a=b;a<d;++a){b=e.GetBinLowEdge(a+1);var p=e.GetBinLowEdge(a+2);if(!(c.logx&&0>=p)){b=Math.round(c.grx(b));
var x=Math.round(c.grx(p));var w=f.getBinContent(a+1);if(!(c.logy&&w<c.scale_ymin)){p=Math.round(c.gry(w));var E=x-b;b+=Math.round(f.fBarOffset/1E3*E);E=Math.round(f.fBarWidth/1E3*E);h=c.swap_xy?h+("M"+m+","+b+"h"+(p-m)+"v"+E+"h"+(m-p)+"z"):h+("M"+b+","+p+"h"+E+"v"+(m-p)+"h"+-E+"z");0<k&&(x=b+E,E=Math.round(E*k/10),c.swap_xy?(t+="M"+m+","+b+"h"+(p-m)+"v"+E+"h"+(m-p)+"z",n+="M"+m+","+x+"h"+(p-m)+"v"+-E+"h"+(m-p)+"z"):(t+="M"+b+","+p+"h"+E+"v"+(m-p)+"h"+-E+"z",n+="M"+x+","+p+"h"+-E+"v"+(m-p)+"h"+E+
"z"));g&&w&&(x=w===Math.round(w)?w.toString():v.floatToString(w,JSROOT.gStyle.fPaintTextFormat),c.swap_xy?this.drawText({align:12,x:Math.round(p+y/2),y:Math.round(b+.1),height:Math.round(.8*E),text:x,color:u,latex:0}):r?this.drawText({align:12,x:b+E/2,y:Math.round(p-2-y/5),width:0,height:0,rotate:r,text:x,color:u,latex:0}):this.drawText({align:22,x:Math.round(b+.1*E),y:Math.round(p-2-y),width:Math.round(.8*E),height:y,text:x,color:u,latex:0}))}}}h&&this.draw_g.append("svg:path").attr("d",h).call(this.fillatt.func);
t&&this.draw_g.append("svg:path").attr("d",t).call(this.fillatt.func).style("fill",l.rgb(this.fillatt.color).brighter(.5).toString());n&&this.draw_g.append("svg:path").attr("d",n).call(this.fillatt.func).style("fill",l.rgb(this.fillatt.color).darker(.5).toString());g&&this.finishTextDrawing()};G.prototype.drawFilledErrors=function(){this.createG(!0);for(var a=this.getSelectIndex("x","left",-1),b=this.getSelectIndex("x","right",1),d=this.getFramePainter(),c=this.getHisto(),f=c.fXaxis,e,g,h,t,n=[],
k=[];a<b;++a)e=f.GetBinCoord(a+.5),d.logx&&0>=e||(e=Math.round(d.grx(e)),g=c.getBinContent(a+1),h=c.getBinError(a+1),d.logy&&g-h<d.scale_ymin||(t=Math.round(d.gry(g+h)),g=Math.round(d.gry(g-h)),n.push({grx:e,gry:t}),k.unshift({grx:e,gry:g})));b=4===this.options.ErrorKind?"bezier":"line";n=v.buildSvgPath(b,n);k=v.buildSvgPath("L"+b,k);this.draw_g.append("svg:path").attr("d",n.path+k.path+"Z").style("stroke","none").call(this.fillatt.func)};G.prototype.draw1DBins=function(){var a=this;this.createHistDrawAttributes();
var b=this.getFramePainter(),d=b.getFrameWidth(),c=b.getFrameHeight();if(!this.draw_content||0>=d||0>=c)return this.removeG();if(this.options.Bar)return this.drawBars(c);if(3===this.options.ErrorKind||4===this.options.ErrorKind)return this.drawFilledErrors();var f=this.getSelectIndex("x","left",-1),e=this.getSelectIndex("x","right",2),g=this.getHisto(),h=g.fXaxis,t="",n=!1,k,m,u,r,y,p,x,w=!this.options.Zero,E=this.options.Error,l=this.options.Mark,q=this.options.Line||this.options.Curve,H=this.options.Text,
z=H&&"E"==this.options.TextKind&&this.isTProfile()&&g.fBinEntries,C=null,B=null,A=null,D=null,F=!1,G=!1,J="",K="",I=0,N,V,ba,X,O,P,R,S,Q,Z;E&&!l&&1<g.fMarkerStyle&&(l=!0);2===this.options.ErrorKind?this.fillatt.empty()?l=!0:C="":this.options.Error&&(B="",G=!0);q&&(D="");l&&(this.createAttMarker({attr:g,style:this.options.MarkStyle}),0<this.markeratt.size?(A="",F=!0,this.markeratt.resetPos()):l=!1);var fa=E||l,ha=fa||H||q;l=this.options.Hist&&(!this.lineatt.empty()||!this.fillatt.empty());if(!l&&!ha)return this.removeG();
this.createG(!0);if(H){var aa=this.getColor(g.fMarkerColor);var ca=-1*this.options.TextAngle;var T=20;1!==g.fMarkerSize&&ca&&(T=.02*c*g.fMarkerSize);ca||this.options.TextKind||(n=d/(e-f+1),n<3*T&&(ca=270,T=Math.round(.7*n)));this.startTextDrawing(42,T,this.draw_g,T)}d=e-f>3*d;1===this.options.ErrorKind&&(n=this.lineatt.width+JSROOT.gStyle.fEndErrorSize,J="m0,"+n+"v-"+2*n+"m0,"+n,K="m"+n+",0h-"+2*n+"m"+n+",0",I=Math.floor((this.lineatt.width-1)/2));ha&&(d=!0);var ia=function(a){X=g.getBinContent(a+
1);if(w&&0===X)return!1;P=Math.round(b.grx(h.GetBinLowEdge(a+1)));R=Math.round(b.grx(h.GetBinLowEdge(a+2)));S=Math.round((P+R)/2);N=Math.round(b.gry(X));V=ba=20;E&&(O=g.getBinError(a+1),V=Math.round(N-b.gry(X+O)),ba=Math.round(b.gry(X-O)-N));return!0},ja=function(){0<a.options.errorX&&(Q=Math.round(S-(R-P)*a.options.errorX),Z=Math.round(S+(R-P)*a.options.errorX),B+="M"+(Q+I)+","+N+J+"h"+(Z-Q-2*I)+J);B+="M"+S+","+(N-V+I)+K+"v"+(V+ba-2*I)+K},da=function(b){ia(b)&&(H&&(b=z?g.fBinEntries[b+1]:X,0!==b&&
(b=b===Math.round(b)?b.toString():v.floatToString(b,JSROOT.gStyle.fPaintTextFormat),ca?a.drawText({align:12,x:S,y:Math.round(N-2-T/5),width:0,height:0,rotate:ca,text:b,color:aa,latex:0}):a.drawText({align:22,x:Math.round(P+.1*(R-P)),y:Math.round(N-2-T),width:Math.round(.8*(R-P)),height:T,text:b,color:aa,latex:0}))),q&&null!==D&&(D+=(0===D.length?"M":"L")+S+","+N),fa&&N>=-V&&N<=c+ba&&(null!==C&&(C+="M"+P+","+(N-V)+"h"+(R-P)+"v"+(V+ba+1)+"h-"+(R-P)+"z"),null!==A&&F&&(A+=a.markeratt.create(S,N)),null!==
B&&G&&ja()))};if(F||G)if(!JSROOT.settings.OptimizeDraw||5E4>e-f&&1==JSROOT.settings.OptimizeDraw){for(p=f;p<e;++p)ia(p)&&(null!==A&&(A+=this.markeratt.create(S,N)),null!==B&&ja());G=F=!1}for(p=f;p<=e;++p)if(n=h.GetBinLowEdge(p+1),!(this.logx&&0>=n)){var U=Math.round(b.grx(n));if((n=p===e)&&f<e)var M=u;else M=g.getBinContent(p+1),M=Math.round(b.gry(M));if(0===t.length){var W=x=p;var ea=k=m=U;var Y=r=y=u=M;t="M"+m+","+u}else if(d)U!==m||n?(ha&&(W===x?da(W):W<x?(da(W),da(x)):(da(x),da(W))),!l||r===y&&
Y===r||(ea!==m&&(t+="h"+(m-ea)),u===r?(y!==Y&&(t+="v"+(y-Y)),r!==y&&(t+="v"+(r-y))):(r!==Y&&(t+="v"+(r-Y)),y!==r&&(t+="v"+(y-r)),u!==y&&(t+="v"+(u-y))),ea=m,Y=u),n&&ea!==U&&(t+="h"+(U-ea)),W=x=p,r=y=u=M,m=U):(M<r?x=p:M>y&&(W=p),r=Math.min(r,M),y=Math.max(y,M),u=M);else if(M!==u||n)U!==m&&(t+="h"+(U-m)),M!==u&&(t+="v"+(M-u)),u=M,m=U}f=!JSROOT.batch_mode&&this.fillatt.empty()&&l&&JSROOT.settings.Tooltip&&!fa&&!q;e=c+3;f||(u=Math.round(b.gry(0)),0>=u?e=-3:u<c&&(e=u));k="L"+m+","+e+"L"+k+","+e+"Z";if(fa||
q)null!==C&&0<C.length&&this.draw_g.append("svg:path").attr("d",C).call(this.fillatt.func),null!==B&&0<B.length&&this.draw_g.append("svg:path").attr("d",B).call(this.lineatt.func),null!==D&&0<D.length&&(this.fillatt.empty()||this.draw_g.append("svg:path").attr("d",(this.options.Fill?D:t)+k).attr("stroke","none").call(this.fillatt.func),this.draw_g.append("svg:path").attr("d",D).attr("fill","none").call(this.lineatt.func)),null!==A&&0<A.length&&this.draw_g.append("svg:path").attr("d",A).call(this.markeratt.func);
if(0<t.length&&l){if(!this.fillatt.empty()||f)t+=k;this.draw_g.append("svg:path").attr("d",t).style("stroke-linejoin","miter").call(this.lineatt.func).call(this.fillatt.func)}H&&this.finishTextDrawing()};G.prototype.getBinTooltips=function(a){var b=[],d=this.getObjectHint(),c=this.getFramePainter(),f=this.getHisto(),e=f.fXaxis.GetBinLowEdge(a+1),g=f.fXaxis.GetBinLowEdge(a+2),h=f.getBinContent(a+1),t=this.getAxisBinTip("x",f.fXaxis,a);0<d.length&&b.push(d);this.options.Error||this.options.Mark?(b.push("x = "+
t),b.push("y = "+c.axisAsText("y",h)),this.options.Error&&("["==t[0]&&b.push("error x = "+((g-e)/2).toPrecision(4)),b.push("error y = "+f.getBinError(a+1).toPrecision(4)))):(b.push("bin = "+(a+1)),b.push("x = "+t),f.$baseh&&(h-=f.$baseh.getBinContent(a+1)),h===Math.round(h)?b.push("entries = "+h):b.push("entries = "+v.floatToString(h,JSROOT.gStyle.fStatFormat)));return b};G.prototype.processTooltipEvent=function(a){function b(a){a=g.fXaxis.GetBinLowEdge(a+1);return c.logx&&0>=a?null:c.grx(a)}function d(a){a=
g.getBinContent(a+1);return c.logy&&a<c.scale_ymin?c.swap_xy?-1E3:10*e:Math.round(c.gry(a))}if(!a||!this.draw_content||!this.draw_g||this.options.Mode3D)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var c=this.getFramePainter(),f=c.getFrameWidth(),e=c.getFrameHeight(),g=this.getHisto(),h=null,t=!0,n,k,m=2,u=this.getSelectIndex("x","left",-1),r=this.getSelectIndex("x","right",2);var y=u;var p=r;var x=a.x,w=a.y;c.swap_xy&&(h=a.x,x=w,w=h,h=e,e=f,f=h);for(;y<p-1;){h=Math.round(.5*
(y+p));var l=b(h);null===l||l<x-.5?c.swap_xy?p=h:y=h:l>x+.5?c.swap_xy?y=h:p=h:(y++,p--)}h=p=y;l=b(h);if(c.swap_xy){for(;y>u&&b(y-1)<l+2;)--y;for(;p<r&&b(p+1)>l-2;)++p}else{for(;y>u&&b(y-1)>l-2;)--y;for(;p<r&&b(p+1)<l+2;)++p}if(y<p){l=e;for(t=y;t<=p;t++){var q=Math.abs(d(t)-w);q<l&&(l=q,h=t)}l>e/10&&(h=Math.round(y+(p-y)/e*w));l=b(h)}l=Math.round(l);q=Math.round(b(h+1));this.options.Bar&&(y=q-l,l+=Math.round(g.fBarOffset/1E3*y),q=l+Math.round(g.fBarWidth/1E3*y));l>q&&(y=l,l=q,q=y);y=Math.round((l+
q)/2);p=n=k=d(h);if(this.options.Bar)t=!0,m=0,n=Math.round(c.gry(!1!==this.options.BaseLine&&this.options.BaseLine>c.scale_ymin?this.options.BaseLine:c.scale_ymin)),n>k&&(f=n,n=k,k=f),!a.touch&&1===a.nproc&&(w<n||w>k)&&(h=null);else if(this.options.Error||this.options.Mark||this.options.Line||this.options.Curve){t=!0;f=3;this.markeratt&&(f=Math.max(f,this.markeratt.getFullSize()));if(this.options.Error){var v=g.getBinContent(h+1);k=g.getBinError(h+1);n=Math.round(c.gry(v+k));k=Math.round(c.gry(v-
k));0==v&&this.isTProfile()&&(h=null);q=(q-l)*this.options.errorX;l=Math.round(y-q);q=Math.round(y+q)}q-l<2*f&&(l=y-f,q=y+f);n=Math.min(n,p-f);k=Math.max(k,p+f);!a.touch&&1===a.nproc&&(w<n||w>k)&&(h=null)}else if(t=1===a.nproc&&r-u<f)k=e,this.fillatt.empty()||(k=Math.round(c.gry(0)),0>k?k=0:k>e&&(k=e),k<n&&(f=n,n=k,k=f)),(a.y<n||a.y>k)&&!a.touch&&(h=null);null!==h&&(h===u&&l>x+m?h=null:h===r-1&&q<x-m?h=null:x<l-m||x>q+m?h=null:this.options.Zero||0!==g.getBinContent(h+1)||(h=null));m=this.draw_g.select(".tooltip_bin");
if(null===h||0>=k||n>=e)return m.remove(),null;u={name:g.fName,title:g.fTitle,x:y,y:p,exact:!0,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(h)};a.disabled?(m.remove(),u.changed=!0):t?(m.empty()&&(m=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),u.changed=m.property("current_bin")!==h,u.changed&&m.attr("x",c.swap_xy?n:l).attr("width",c.swap_xy?k-n:q-l).attr("y",
c.swap_xy?l:n).attr("height",c.swap_xy?q-l:k-n).style("opacity","0.3").property("current_bin",h),u.exact=5>=Math.abs(p-w)||w>=n&&w<=k,u.menu=!0,u.menu_dist=Math.sqrt((y-x)*(y-x)+(p-w)*(p-w))):(x=this.lineatt.width+3,m.empty()&&(m=this.draw_g.append("svg:circle").attr("class","tooltip_bin").style("pointer-events","none").attr("r",x).call(this.lineatt.func).call(this.fillatt.func)),u.exact=Math.abs(y-a.x)<=x&&Math.abs(p-a.y)<=x,u.menu=u.exact,u.menu_dist=Math.sqrt((y-a.x)*(y-a.x)+(p-a.y)*(p-a.y)),u.changed=
m.property("current_bin")!==h,u.changed&&m.attr("cx",y).attr("cy",p).property("current_bin",h));u.changed&&(u.user_info={obj:g,name:g.fName,bin:h,cont:g.getBinContent(h+1),grx:y,gry:p});return u};G.prototype.fillHistContextMenu=function(a){var b=this;a.add("Auto zoom-in",function(){return b.autoZoom()});var d=v.getDrawSettings("ROOT."+this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",d.opts,function(a){if("inspect"===a)return b.showInspector();b.decodeOptions(a);b.options.need_fillcol&&
b.fillatt&&b.fillatt.empty()&&b.fillatt.change(5,1001);b.interactiveRedraw("pad","drawopt")})};G.prototype.autoZoom=function(){var a=this.getSelectIndex("x","left",-1),b=this.getSelectIndex("x","right",1),d=b-a,c=this.getHisto();if(0!=d&&c){for(var f=c.getBinContent(a+1),e=a;e<b;++e)f=Math.min(f,c.getBinContent(e+1));if(!(0<f)){for(;a<b&&c.getBinContent(a+1)<=f;)++a;for(;a<b&&c.getBinContent(b)<=f;)--b;a===b-1&&2<a&&b<this.nbinsx-2&&(--a,++b);b-a<d&&a<b&&this.getFramePainter().zoom(c.fXaxis.GetBinLowEdge(a+
1),c.fXaxis.GetBinLowEdge(b+1))}}};G.prototype.canZoomInside=function(a,b,d){var c=this.getHisto();return"x"==a&&c&&1<c.fXaxis.FindBin(d,.5)-c.fXaxis.FindBin(b,0)||"y"==a&&Math.abs(d-b)>1E-6*Math.abs(this.ymax-this.ymin)?!0:!1};G.prototype.callDrawFunc=function(a){var b=this.getMainPainter(),d=this.getFramePainter();b!==this&&d&&d.mode3d!==this.options.Mode3D&&this.copyOptionsFrom(b);return this[this.options.Mode3D?"draw3D":"draw2D"](a)};G.prototype.draw2D=function(){var a=this;this.clear3DScene();
this.scanContent(!0);"function"===typeof this.drawColorPalette&&this.drawColorPalette(!1);return this.drawAxes().then(function(){a.draw1DBins();return a.drawHistTitle()}).then(function(){a.updateStatWebCanvas();return a.addInteractivity()})};G.prototype.draw3D=function(a){var b=this;this.mode3d=!0;return JSROOT.require("hist3d").then(function(){return b.draw3D(a)})};G.prototype.redraw=function(a){return this.callDrawFunc(a)};A.prototype=Object.create(q.prototype);A.prototype.cleanup=function(){delete this.tt_handle;
q.prototype.cleanup.call(this)};A.prototype.toggleProjection=function(a,b){var d=this;if("Projections"==a||"Off"==a)a="";"string"==typeof a&&1<a.length&&(b=parseInt(a.substr(1)),a=a[0]);b||(b=1);if(a&&this.is_projection==a)if(this.projection_width===b)a="";else{this.projection_width=b;return}delete this.proj_hist;var c=this.is_projection===a?"":a;this.is_projection="";this.projection_width=b;this.getCanvPainter().toggleProjection(c).then(function(){return d.redrawProjection("toggling",c)})};A.prototype.redrawProjection=
function(a,b,d,c){"toggling"===a&&(this.is_projection=b,a=b=void 0);if(this.is_projection){if(void 0==c){if(!this.tt_handle)return;a=Math.round((this.tt_handle.i1+this.tt_handle.i2)/2);b=a+1;d=Math.round((this.tt_handle.j1+this.tt_handle.j2)/2);c=d+1}var f=this.getCanvPainter(),e=this.getHisto();if(f&&!f._readonly&&void 0!==this.snapid)e="EXECANDSEND:D"+this.is_projection+"PROJ:"+this.snapid+":",e="X"==this.is_projection?e+('ProjectionX("_projx",'+(d+1)+","+c+',"")'):e+('ProjectionY("_projy",'+(a+
1)+","+b+',"")'),f.sendWebsocket(e);else{this.proj_hist||("X"==this.is_projection?(this.proj_hist=JSROOT.createHistogram("TH1D",this.nbinsx),JSROOT.extend(this.proj_hist.fXaxis,e.fXaxis),this.proj_hist.fName="xproj",this.proj_hist.fTitle="X projection"):(this.proj_hist=JSROOT.createHistogram("TH1D",this.nbinsy),JSROOT.extend(this.proj_hist.fXaxis,e.fYaxis),this.proj_hist.fName="yproj",this.proj_hist.fTitle="Y projection"));if("X"==this.is_projection)for(a=0;a<this.nbinsx;++a){b=0;for(var g=d;g<c;++g)b+=
e.getBinContent(a+1,g+1);this.proj_hist.setBinContent(a+1,b)}else for(d=0;d<this.nbinsy;++d){c=0;for(g=a;g<b;++g)c+=e.getBinContent(g+1,d+1);this.proj_hist.setBinContent(d+1,c)}return f.drawProjection(this.is_projection,this.proj_hist)}}};A.prototype.executeMenuCommand=function(a,b){return q.prototype.executeMenuCommand.call(this,a,b)?!0:"SetShowProjectionX"==a.fName||"SetShowProjectionY"==a.fName?(this.toggleProjection(a.fName[17],b&&parseInt(b)?parseInt(b):1),!0):!1};A.prototype.fillHistContextMenu=
function(a){var b=this;if(!this.isTH2Poly()){a.add("sub:Projections",function(){return b.toggleProjection()});var d=this.is_projection||"";d&&(d+=this.projection_width);var c="X1 X2 X3 X5 X10 Y1 Y2 Y3 Y5 Y10".split(" ");this.is_projection&&c.push("Off");for(var f=0;f<c.length;++f)a.addchk(d==c[f],c[f],c[f],function(a){return b.toggleProjection(a)});a.add("endsub:");a.add("Auto zoom-in",function(){return b.autoZoom()})}d=v.getDrawSettings("ROOT."+this.getObject()._typename,"nosame");a.addDrawMenu("Draw with",
d.opts,function(a){if("inspect"===a)return b.showInspector();b.decodeOptions(a);b.interactiveRedraw("pad","drawopt")});this.options.Color&&this.fillPaletteMenu(a)};A.prototype.clickButton=function(a){if(q.prototype.clickButton.call(this,a))return!0;if(this!==this.getMainPainter())return!1;switch(a){case "ToggleColor":this.toggleColor();break;case "ToggleColorZ":this.toggleColz();break;case "Toggle3D":this.toggleMode3D();break;default:return!1}return!0};A.prototype.fillToolbar=function(){q.prototype.fillToolbar.call(this,
!0);var a=this.getPadPainter();a&&(this.isTH2Poly()||a.addPadButton("th2color","Toggle color","ToggleColor"),a.addPadButton("th2colorz","Toggle color palette","ToggleColorZ"),a.addPadButton("th2draw3d","Toggle 3D mode","Toggle3D"),a.showPadButtons())};A.prototype.toggleColor=function(){this.options.Mode3D?(this.options.Mode3D=!1,this.options.Color=!0):this.options.Color=!this.options.Color;this._can_move_colz=!0;this.copyOptionsToOthers();this.redrawPad()};A.prototype.autoZoom=function(){if(!this.isTH2Poly()){var a=
this.getSelectIndex("x","left",-1),b=this.getSelectIndex("x","right",1),d=this.getSelectIndex("y","left",-1),c=this.getSelectIndex("y","right",1),f,e,g=this.getObject();if(a!=b&&d!=c){var h=g.getBinContent(a+1,d+1);for(f=a;f<b;++f)for(e=d;e<c;++e)h=Math.min(h,g.getBinContent(f+1,e+1));if(!(0<h)){var t=b,n=a,k=c,m=d;for(f=a;f<b;++f)for(e=d;e<c;++e)g.getBinContent(f+1,e+1)>h&&(f<t&&(t=f),f>=n&&(n=f+1),e<k&&(k=e),e>=m&&(m=e+1));f=!1;t===n-1&&t>a+1&&n<b-1&&(t--,n++);k===m-1&&k>d+1&&m<c-1&&(k--,m++);if((t>
a||n<b)&&t<n-1){var u=g.fXaxis.GetBinLowEdge(t+1);var r=g.fXaxis.GetBinLowEdge(n+1);f=!0}if((k>d||m<c)&&k<m-1){var y=g.fYaxis.GetBinLowEdge(k+1);var p=g.fYaxis.GetBinLowEdge(m+1);f=!0}f&&this.getFramePainter().zoom(u,r,y,p)}}}};A.prototype.scanContent=function(a){if(!(a&&this.nbinsx&&this.nbinsy)){var b;a=this.getObject();this.extractAxesProperties(2);if(this.isTH2Poly()){this.gminposbin=null;var d=this.gminbin=this.gmaxbin=0;for(b=a.fBins.arr.length;d<b;++d){var c=a.fBins.arr[d].fContent;0===d&&
(this.gminbin=this.gmaxbin=c);c<this.gminbin?this.gminbin=c:c>this.gmaxbin&&(this.gmaxbin=c);0<c&&(null===this.gminposbin||this.gminposbin>c)&&(this.gminposbin=c)}}else for(this.gminbin=this.gmaxbin=a.getBinContent(1,1),this.gminposbin=null,d=0;d<this.nbinsx;++d)for(b=0;b<this.nbinsy;++b)c=a.getBinContent(d+1,b+1),c<this.gminbin?this.gminbin=c:c>this.gmaxbin&&(this.gmaxbin=c),0<c&&(null===this.gminposbin||this.gminposbin>c)&&(this.gminposbin=c);null===this.gminposbin&&(this.gminposbin=1E-4*this.gmaxbin);
0<this.options.Axis?this.draw_content=!1:(this.draw_content=0<this.gmaxbin,!this.draw_content&&this.options.Zero&&this.isTH2Poly()&&(this.draw_content=!0,this.options.Line=1))}};A.prototype.countStat=function(a){var b=this.getHisto(),d=b.fXaxis,c=b.fYaxis,f=0,e=0,g=0,h=0,t=0,n,k,m=this.getFramePainter(),u={name:b.fName,entries:0,integral:0,meanx:0,meany:0,rmsx:0,rmsy:0,matrix:[0,0,0,0,0,0,0,0,0],xmax:0,ymax:0,wmax:null};if(this.isTH2Poly()){d=b.fBins.arr.length;var r,y,p,l=this.getFramePainter();
for(c=0;c<d;++c){var w=b.fBins.arr[c];var q=n=1;w.fXmin>l.scale_xmax?n=2:w.fXmax<l.scale_xmin&&(n=0);w.fYmin>l.scale_ymax?q=2:w.fYmax<l.scale_ymin&&(q=0);var v=k=p=0;var z=w.fPoly;var H=1;"TMultiGraph"===z._typename&&(H=w.fPoly.fGraphs.arr.length,z=null);for(y=0;y<H;++y){if(!z||0<y)z=w.fPoly.fGraphs.arr[y];for(r=0;r<z.fNpoints;++r)++p,v+=z.fX[r],k+=z.fY[r]}1<p&&(v/=p,k/=p);w=w.fContent;u.entries+=w;u.matrix[3*q+n]+=w;if(1==n&&1==q&&(!a||a(v,k))){if(null===u.wmax||w>u.wmax)u.wmax=w,u.xmax=v,u.ymax=
k;f+=w;e+=v*w;g+=k*w;h+=v*v*w;t+=k*k*w}}}else for(l=this.getSelectIndex("x","left"),r=this.getSelectIndex("x","right"),z=this.getSelectIndex("y","left"),y=this.getSelectIndex("y","right"),H=0;H<=this.nbinsx+1;++H)for(n=H<=l?0:H>r?2:1,v=d.GetBinCoord(H-.5),p=0;p<=this.nbinsy+1;++p)if(q=p<=z?0:p>y?2:1,k=c.GetBinCoord(p-.5),w=b.getBinContent(H,p),u.entries+=w,u.matrix[3*q+n]+=w,1==n&&1==q&&(null==a||a(v,k))){if(null===u.wmax||w>u.wmax)u.wmax=w,u.xmax=v,u.ymax=k;f+=w;e+=v*w;g+=k*w;h+=v*v*w;t+=k*k*w}!m.isAxisZoomed("x")&&
!m.isAxisZoomed("y")&&0<b.fTsumw&&(f=b.fTsumw,e=b.fTsumwx,h=b.fTsumwx2,g=b.fTsumwy,t=b.fTsumwy2);0<f&&(u.meanx=e/f,u.meany=g/f,u.rmsx=Math.sqrt(Math.abs(h/f-u.meanx*u.meanx)),u.rmsy=Math.sqrt(Math.abs(t/f-u.meany*u.meany)));null===u.wmax&&(u.wmax=0);u.integral=f;1<b.fEntries&&(u.entries=b.fEntries);return u};A.prototype.fillStatistic=function(a,b,d){if(this.isIgnoreStatsFill())return!1;var c=this.countStat(),f=Math.floor(b%10),e=Math.floor(b/10)%10,g=Math.floor(b/100)%10,h=Math.floor(b/1E3)%10,t=
Math.floor(b/1E4)%10,n=Math.floor(b/1E5)%10,k=Math.floor(b/1E6)%10,m=Math.floor(b/1E7)%10;b=Math.floor(b/1E8)%10;a.clearPave();0<f&&a.addText(c.name);0<e&&a.addText("Entries = "+a.format(c.entries,"entries"));0<g&&(a.addText("Mean x = "+a.format(c.meanx)),a.addText("Mean y = "+a.format(c.meany)));0<h&&(a.addText("Std Dev x = "+a.format(c.rmsx)),a.addText("Std Dev y = "+a.format(c.rmsy)));0<k&&a.addText("Integral = "+a.format(c.matrix[4],"entries"));0<m&&(a.addText("Skewness x = <undef>"),a.addText("Skewness y = <undef>"));
0<b&&a.addText("Kurt = <undef>");if(0<t||0<n)c=c.matrix,a.addText(""+c[6].toFixed(0)+" | "+c[7].toFixed(0)+" | "+c[7].toFixed(0)),a.addText(""+c[3].toFixed(0)+" | "+c[4].toFixed(0)+" | "+c[5].toFixed(0)),a.addText(""+c[0].toFixed(0)+" | "+c[1].toFixed(0)+" | "+c[2].toFixed(0));d&&a.fillFunctionStat(this.findFunction("TF2"),d);return!0};A.prototype.drawBinsColor=function(){for(var a=this,b=this.getHisto(),d=this.prepareColorDraw(),c=this.getContour(),f=this.getHistPalette(),e=[],g=!this.options.Zero,
h=this._show_empty_bins,t=d.i1;t<d.i2;++t){var n=d.grx[t+1]-d.grx[t],k=Math.round(d.grx[t]+n*d.xbar1);n=Math.round(n*(d.xbar2-d.xbar1))||1;for(var m=d.j1;m<d.j2;++m){var u=b.getBinContent(t+1,m+1),r=0===u;if(!r||!g){u=c.getPaletteIndex(f,u);if(null===u)if(r&&h)u=0;else continue;r=d.gry[m]-d.gry[m+1];var l=Math.round(d.gry[m+1]+r*d.ybar1);r=Math.round(r*(d.ybar2-d.ybar1))||1;var p="M"+k+","+l,x=e[u];x?(u="m"+(k-x.x)+","+(l-x.y),x.path+=u.length<p.length?u:p):x=e[u]={path:p};x.x=k;x.y=l;x.path+="v"+
r+"h"+n+"v"+-r+"z"}}}e.forEach(function(b,c){b&&a.draw_g.append("svg:path").attr("palette-index",c).attr("fill",f.getColor(c)).attr("d",b.path)});return d};A.prototype.buildContour=function(a,b,d,c){function f(a){for(var c=0;c<b.length;++c)if(a<b[c])return c-1;return b.length-1}function e(a,c,d,e,f,g,p,m){var u=d===p;p=u?m-e:p-d;c+=1;f-=a;m=k-1;for(var r=999+k,l=0,w;c<=g&&m<=r;)w=b[c],w-=a,w/=f,w*=p,u?(h[m]=d,t[m]=e+w):(h[m]=d+w,t[m]=e),n[m]=c,l++,m+=2,c++;return l}var g=this.getObject(),h=new Float32Array(4008),
t=new Float32Array(4008),n=new Int32Array(4008),k=0,m=[],u=0,r=[0,0,0,0],l=[0,0,0,0],p=[0,0,0,0],x=[0,0,0,0],w,q,v,z,H=a.original?a.origx:a.grx,A=a.original?a.origy:a.gry;for(q=a.j1;q<a.j2-1;++q)for(l[1]=l[0]=(A[q]+A[q+1])/2,l[3]=l[2]=(A[q+1]+A[q+2])/2,w=a.i1;w<a.i2-1;++w){p[0]=g.getBinContent(w+1,q+1);p[1]=g.getBinContent(w+2,q+1);p[2]=g.getBinContent(w+2,q+2);p[3]=g.getBinContent(w+1,q+2);for(v=0;4>v;v++)x[v]=f(p[v]);if(x[0]!==x[1]||x[1]!==x[2]||x[2]!==x[3]||x[3]!==x[0]){r[3]=r[0]=(H[w]+H[w+1])/
2;r[2]=r[1]=(H[w+1]+H[w+2])/2;var C=p[0]<=p[1]?0:1;var B=p[2]<=p[3]?2:3;p[C]>p[B]&&(C=B);C++;for(v=k=1;4>=v;v++)B=C%4+1,C=e(p[C-1],x[C-1],r[C-1],l[C-1],p[B-1],x[B-1],r[B-1],l[B-1]),k+=2*C,C=B;C=p[0]<=p[1]?0:1;B=p[2]<=p[3]?2:3;p[C]>p[B]&&(C=B);C++;k=2;for(v=1;4>=v;v++)B=1==C?4:C-1,C=e(p[C-1],x[C-1],r[C-1],l[C-1],p[B-1],x[B-1],r[B-1],l[B-1]),k+=2*C,C=B;B=0;for(v=1;v<=k-5;v+=2)for(;n[v-1]!=n[v];){C=h[v];var D=t[v];var F=n[v];for(z=v;z<=k-5;z+=2)h[z]=h[z+2],t[z]=t[z+2],n[z]=n[z+2];h[k-3]=C;t[k-3]=D;n[k-
3]=F;if(2E3<B)break;B++}if(!(2E3<B))for(v=1;v<=k-2;v+=2)B=n[v-1],0<=B&&B<b.length&&((C=m[B])||(C=m[B]=JSROOT.createTPolyLine(8016,!0)),B=C.fLastPoint,B<C.fN-2&&(C.fX[B+1]=Math.round(h[v-1]),C.fY[B+1]=Math.round(t[v-1]),C.fX[B+2]=Math.round(h[v]),C.fY[B+2]=Math.round(t[v]),C.fLastPoint=B+2,u=Math.max(u,C.fLastPoint+1)))}}a=new Int32Array(b.length);for(B=w=0;B<b.length;B++)if(0<=b[B]){w=B;break}v=0;for(B=w-1;0<=B;B--)a[v]=B,v++;for(B=w;B<b.length;B++)a[v]=B,v++;g=new Float32Array(2*u);r=new Float32Array(2*
u);for(v=0;v<b.length;++v)if(B=a[v],C=m[B])for(l=d.calcColorIndex(B,b.length),p=C.fX,x=C.fY,q=C.fLastPoint+1,H=0,D=C=A=void 0;;){A=u;C=A+1;g[A]=p[H];r[A]=x[H];g[C]=p[H+1];r[C]=x[H+1];p[H]=p[H+1]=0;for(x[H]=x[H+1]=0;;){D=0;for(w=2;w<q;w+=2)C<2*u-1&&p[w]===g[C]&&x[w]===r[C]&&(C++,g[C]=p[w+1],r[C]=x[w+1],p[w]=p[w+1]=0,x[w]=x[w+1]=0,D++),0<A&&p[w+1]===g[A]&&x[w+1]===r[A]&&(A--,g[A]=p[w],r[A]=x[w],p[w]=p[w+1]=0,x[w]=x[w+1]=0,D++);if(0==D)break}A+1<C&&0<=A&&c(l,g,r,A,C,B);H=0;for(w=2;w<q;w+=2)if(0!==p[w]&&
0!==x[w]){H=w;break}if(0===H)break}};A.prototype.drawBinsContour=function(){function a(a,b,c,d,f){for(var g="",h,p,n,m,t=c;t<=d;++t){k?(c=k(a[t],b[t]),c.x=Math.round(e.grx(c.x)),c.y=Math.round(e.gry(c.y))):c={x:Math.round(a[t]),y:Math.round(b[t])};if(g)if(t==d&&p&&c.x==p.x&&c.y==p.y){if(!n)return"";g+="z";f=!1;m=!0}else c.x!=h.x&&c.y!=h.y?(g+="l"+(c.x-h.x)+","+(c.y-h.y),n=!0):c.x!=h.x?(g+="h"+(c.x-h.x),n=!0):c.y!=h.y&&(g+="v"+(c.y-h.y),n=!0);else g="M"+c.x+","+c.y,p=c;h=c}if(f&&!m&&!k)return"<failed>";
f&&(g+="z");return g}function b(a,b){var c=a.x2-a.x1;var d=a.y2-a.y1;var e=b.x2-b.x1;var f=b.y2-b.y1;var g=c*f-e*d;if(0==g)return 0;var h=0<g;var k=a.x1-b.x1;var p=a.y1-b.y1;b=c*p-d*k;if(0>b==h)return null;k=e*p-f*k;if(0>k==h||b>g==h||k>g==h)return null;g=k/g;return{x:Math.round(a.x1+g*c),y:Math.round(a.y1+g*d)}}function d(c,d,e,f,k){function p(a,e){a={x1:c[a],y1:d[a],x2:2*c[a]-c[a+e],y2:2*d[a]-d[a+e]};for(e=0;4>e;++e){var f=b(a,{x1:n[e].x,y1:n[e].y,x2:n[(e+1)%4].x,y2:n[(e+1)%4].y});if(f)return f.indx=
e+.5,f}return null}var n=[{x:0,y:0},{x:g,y:0},{x:g,y:h},{x:0,y:h}];for(e--;e<f-1&&!m;)var m=p(++e,1);for(f++;e<f-1&&m&&!t;)var t=p(--f,-1);if(!m||!t)return"";e=a(c,d,e,f);f=t.indx;k*=.5;for(e+="L"+t.x+","+t.y;.1<Math.abs(f-m.indx);)f=Math.round(f+k)%4,e+="L"+n[f].x+","+n[f].y,f+=k;return e+"L"+m.x+","+m.y+"z"}var c=this,f=this.prepareColorDraw({rounding:!1,extra:100,original:0!=this.options.Proj}),e=this.getFramePainter(),g=e.getFrameWidth(),h=e.getFrameHeight(),t=this.getContourLevels(),n=this.getHistPalette(),
k=e.getProjectionFunc();if(14===this.options.Contour){var m="M0,0h"+g+"v"+h+"h-"+g+"z";if(this.options.Proj){m=f.j2-f.j1;for(var u=new Float32Array(2*m),r=new Float32Array(2*m),l=0;l<m;++l)u[l]=f.origx[f.i1],r[l]=(f.origy[f.j1]*(l+.5)+f.origy[f.j2]*(m-.5-l))/m,u[l+m]=f.origx[f.i2],r[l+m]=(f.origy[f.j2]*(l+.5)+f.origy[f.j1]*(m-.5-l))/m;m=a(u,r,0,2*m-1,!0)}this.draw_g.append("svg:path").attr("d",m).style("stroke","none").style("fill",n.calcColor(0,t.length))}this.buildContour(f,t,n,function(b,e,f,g,
h,k){var m=n.getColor(b);b=m;switch(c.options.Contour){case 11:b="none";var t=new JSROOT.TAttLineHandler({color:m});break;case 12:b="none";t=new JSROOT.TAttLineHandler({color:1,style:k%5+1,width:1});break;case 13:b="none",t=c.lineatt}k=a(e,f,g,h,"none"!=b);"<failed>"==k&&(k=d(e,f,g,h,1));k&&(e=c.draw_g.append("svg:path").attr("class","th2_contour").attr("d",k).style("fill",b),t?e.call(t.func):e.style("stroke","none"))});f.hide_only_zeros=!0;return f};A.prototype.createPolyBin=function(a,b,d){function c(a,
c,d,e){var f=Math.sqrt((a-d)*(a-d)+(c-e)*(c-e));b._sumx+=(a+d)*f/2;b._sumy+=(c+e)*f/2;b._suml+=f}var f="",e,g=1,h=null;"TMultiGraph"==b.fPoly._typename?g=b.fPoly.fGraphs.arr.length:h=b.fPoly;d&&(b._sumx=b._sumy=b._suml=0);for(e=0;e<g;++e){if(!h||0<e)h=b.fPoly.fGraphs.arr[e];var t=h.fNpoints,n=void 0,k=h.fX,m=h.fY,u=Math.round(a.grx(k[0])),r=Math.round(a.gry(m[0])),l=void 0,p=void 0;2<t&&k[0]==k[t-1]&&m[0]==m[t-1]&&t--;f+="M"+u+","+r;for(n=1;n<t;++n){l=Math.round(a.grx(k[n]));p=Math.round(a.gry(m[n]));
d&&c(u,r,l,p);if(u!==l||r!==p)f=u===l?f+("v"+(p-r)):r===p?f+("h"+(l-u)):f+("l"+(l-u)+","+(p-r));u=l;r=p}d&&c(u,r,Math.round(a.grx(k[0])),Math.round(a.gry(m[0])));f+="z"}d&&(0<b._suml?(b._midx=Math.round(b._sumx/b._suml),b._midy=Math.round(b._sumy/b._suml)):(b._midx=Math.round(a.grx((b.fXmin+b.fXmax)/2)),b._midy=Math.round(a.gry((b.fYmin+b.fYmax)/2))));return f};A.prototype.DrawPolyBinsColor=function(){var a=this.getObject(),b=this.getFramePainter(),d=b.getFrameHeight(),c=[],f=[],e,g=a.fBins.arr.length;
this.maxbin=this.gmaxbin;this.minbin=this.gminbin;this.minposbin=this.gminposbin;var h=this.getContour(!0),t=this.getHistPalette();for(e=0;e<g;++e){var n=a.fBins.arr[e];var k=h.getPaletteIndex(t,n.fContent);if(null!==k){if(0===n.fContent){if(!this.options.Zero||!this.options.Line)continue;k=0}if(!(n.fXmin>b.scale_xmax||n.fXmax<b.scale_xmin||n.fYmin>b.scale_ymax||n.fYmax<b.scale_ymin)){var m=this.createPolyBin(b,n,this.options.Text&&n.fContent);c[k]=void 0===c[k]?m:c[k]+m;this.options.Text&&n.fContent&&
f.push(n)}}}for(k=0;k<c.length;++k)c[k]&&(n=this.draw_g.append("svg:path").attr("palette-index",k).attr("fill",k?this.fPalette.getColor(k):"none").attr("d",c[k]),this.options.Line&&n.call(this.lineatt.func));if(0<f.length){c=this.getColor(a.fMarkerColor);k=-1*this.options.TextAngle;b=this.draw_g.append("svg:g").attr("class","th2poly_text");n=12;1!==a.fMarkerSize&&k&&(n=Math.round(.02*d*a.fMarkerSize));this.startTextDrawing(42,n,b,n);for(e=0;e<f.length;++e)n=f[e],a="",this.options.TextKind?(n.fPoly&&
(a=n.fPoly.fName),"Graph"===a&&(a=""),a||(a=n.fNumber)):a=Math.round(n.fContent)===n.fContent?n.fContent.toString():v.floatToString(n.fContent,JSROOT.gStyle.fPaintTextFormat),this.drawText({align:22,x:n._midx,y:n._midy,rotate:k,text:a,color:c,latex:0,draw_g:b});this.finishTextDrawing(b)}return{poly:!0}};A.prototype.drawBinsText=function(a){var b=this.getObject(),d,c=this.getColor(b.fMarkerColor),f=-1*this.options.TextAngle,e=this.draw_g.append("svg:g").attr("class","th2_text");var g=20;var h=0,t=
this.matchObjectType("TProfile2D")&&"function"==typeof b.getBinEntries,n="E"==this.options.TextKind,k=n&&!this.options.TextLine?1:0;null===a&&(a=this.prepareColorDraw({rounding:!1}));1!==b.fMarkerSize&&f&&(g=Math.round(.02*b.fMarkerSize*this.getFramePainter().getFrameHeight()));0!==b.fBarOffset&&(h=.001*b.fBarOffset);this.startTextDrawing(42,g,e,g);for(g=a.i1;g<a.i2;++g)for(d=a.j1;d<a.j2;++d){var m=b.getBinContent(g+1,d+1);if(0!==m||this._show_empty_bins){var u=a.grx[g+1]-a.grx[g];var l=a.gry[d]-
a.gry[d+1];t&&(m=b.getBinEntries(g+1,d+1));m=m===Math.round(m)?m.toString():v.floatToString(m,JSROOT.gStyle.fPaintTextFormat);if(n){var q=b.getBinError(b.getBin(g+1,d+1));q=q===Math.round(q)?q.toString():v.floatToString(q,JSROOT.gStyle.fPaintTextFormat);m=this.options.TextLine?m+("\u00b1"+q):"#splitline{"+m+"}{#pm"+q+"}"}if(f){q=Math.round(a.grx[g]+.5*u);var p=Math.round(a.gry[d+1]+l*(.5+h));l=u=0}else q=Math.round(a.grx[g]+.1*u),p=Math.round(a.gry[d+1]+l*(.1+h)),u=Math.round(.8*u),l=Math.round(.8*
l);this.drawText({align:22,x:q,y:p,width:u,height:l,rotate:f,text:m,color:c,latex:k,draw_g:e})}}this.finishTextDrawing(e);a.hide_only_zeros=!0;return a};A.prototype.drawBinsArrow=function(){for(var a=this.getObject(),b="",d,c,f=1E-30,e,g,h,t,n,k,m=this.prepareColorDraw({rounding:!1}),l=(m.grx[m.i2]-m.grx[m.i1])/(m.i2-m.i1+1-.03)/2,r=(m.gry[m.j2]-m.gry[m.j1])/(m.j2-m.j1+1-.03)/2,q=0;2>q;++q)for(d=m.i1;d<m.i2;++d)for(c=m.j1;c<m.j2;++c)if(e=d===m.i1?a.getBinContent(d+2,c+1)-a.getBinContent(d+1,c+1):
d===m.i2-1?a.getBinContent(d+1,c+1)-a.getBinContent(d,c+1):.5*(a.getBinContent(d+2,c+1)-a.getBinContent(d,c+1)),g=c===m.j1?a.getBinContent(d+1,c+2)-a.getBinContent(d+1,c+1):c===m.j2-1?a.getBinContent(d+1,c+1)-a.getBinContent(d+1,c):.5*(a.getBinContent(d+1,c+2)-a.getBinContent(d+1,c)),0===q)f=Math.max(f,Math.abs(e),Math.abs(g));else if(h=(m.grx[d]+m.grx[d+1])/2,t=(m.gry[c]+m.gry[c+1])/2,n=l*e/f,e=r*g/f,k=h-n,g=h+n,h=t-e,t+=e,e=Math.round(g-k),g=Math.round(t-h),0!==e||0!==g)if(b+="M"+Math.round(k)+
","+Math.round(h)+"l"+e+","+g,5<Math.abs(e)||5<Math.abs(g))t=Math.sqrt(2/(e*e+g*g)),k=Math.round(t*(e+g)),e=Math.round(t*(e-g)),0!==k&&0!==e&&(b+="l"+-k+","+e+"m"+k+","+-e+"l"+-e+","+-k);this.draw_g.append("svg:path").attr("class","th2_arrows").attr("d",b).style("fill","none").call(this.lineatt.func);return m};A.prototype.drawBinsBox=function(){var a=this.getObject(),b=this.prepareColorDraw({rounding:!1}),d=this.getMainPainter();d===this&&(d.maxbin===d.minbin&&(d.maxbin=d.gmaxbin,d.minbin=d.gminbin,
d.minposbin=d.gminposbin),d.maxbin===d.minbin&&(d.minbin=Math.min(0,d.maxbin-1)));var c=Math.max(Math.abs(d.maxbin),Math.abs(d.minbin)),f=Math.max(0,d.minbin),e,g="",h="",t="",n="",k=!1,m=0;if((e=this.getPadPainter().getRootPad(!0))&&e.fLogz&&0<c){k=!0;c=Math.log(c);m=0<f?Math.log(f):1<=d.minposbin&&100>d.minposbin?Math.log(.7):0<d.minposbin?Math.log(.7*d.minposbin):c-10;m>=c&&(m=c-10);var u=1/(c-m)}else u=1/(c-f);for(d=b.i1;d<b.i2;++d)for(c=b.j1;c<b.j2;++c){e=a.getBinContent(d+1,c+1);var r=Math.abs(e);
if(!(0===r||r<f)){var q=k?0<r?Math.log(r)-m:0:r-f;q=.5*(0>q?1:1-Math.sqrt(q*u));0>q&&(q=0);r=b.grx[d+1]-b.grx[d];var p=b.gry[c]-b.gry[c+1];var v=q*r;var w=q*p;q=Math.round(b.grx[d]+v);var z=Math.round(b.gry[c+1]+w);r=Math.max(Math.round(r-2*v),1);p=Math.max(Math.round(p-2*w),1);g+="M"+q+","+z+"v"+p+"h"+r+"v-"+p+"z";0>e&&10===this.options.BoxStyle&&(h+="M"+q+","+z+"l"+r+","+p+"M"+(q+r)+","+z+"l-"+r+","+p);if(11===this.options.BoxStyle&&5<r&&5<p){w=Math.round(.1*r);var A=Math.round(.1*p);v="M"+q+","+
z+"h"+r+"l"+-w+","+A+"h"+(2*w-r)+"v"+(p-2*A)+"l"+-w+","+A+"z";r="M"+(q+r)+","+(z+p)+"v"+-p+"l"+-w+","+A+"v"+(p-2*A)+"h"+(2*w-r)+"l"+-w+","+A+"z";0>e?(n+=v,t+=r):(t+=v,n+=r)}}}0<g.length&&(a=this.draw_g.append("svg:path").attr("d",g).call(this.fillatt.func),11!==this.options.BoxStyle&&this.fillatt.empty()?a.call(this.lineatt.func):a.style("stroke","none"));0<t.length&&"none"!==this.fillatt.color&&this.draw_g.append("svg:path").attr("d",t).style("stroke","none").call(this.fillatt.func).style("fill",
l.rgb(this.fillatt.color).brighter(.5).toString());0<n.length&&this.draw_g.append("svg:path").attr("d",n).style("stroke","none").call(this.fillatt.func).style("fill","none"===this.fillatt.color?"red":l.rgb(this.fillatt.color).darker(.5).toString());0<h.length&&(h=this.draw_g.append("svg:path").attr("d",h).style("fill","none"),"none"!==this.lineatt.color?h.call(this.lineatt.func):h.style("stroke","black"));return b};A.prototype.drawBinsCandle=function(){var a=this.getHisto(),b=this.prepareColorDraw(),
d=this.getFramePainter(),c;d.getFrameWidth();var f,e,g,h,t="",n="";1===a.fMarkerColor&&(a.fMarkerColor=a.fLineColor);this.createAttMarker({attr:a,style:5});this.markeratt.resetPos();b.candle=[];for(f=b.i1;f<b.i2;++f){for(c=g=h=e=0;c<this.nbinsy;++c)h+=a.getBinContent(f+1,c+1);var k={bin:f,meany:0,m25y:0,p25y:0,median:0,iqr:0,whiskerp:0,whiskerm:0};for(c=0;c<this.nbinsy;++c){var m=a.getBinContent(f+1,c+1);var l=a.fYaxis.GetBinCenter(c+1);.001>g/h&&.001<=(g+m)/h&&(k.whiskerm=l);.25>g/h&&.25<=(g+m)/
h&&(k.m25y=l);.5>g/h&&.5<=(g+m)/h&&(k.median=l);.75>g/h&&.75<=(g+m)/h&&(k.p25y=l);.999>g/h&&.999<=(g+m)/h&&(k.whiskerp=l);g+=m;e+=m*l}0<g&&(k.meany=e/g);k.iqr=k.p25y-k.m25y;k.m25y-1.5*k.iqr>k.whsikerm&&(k.whiskerm=k.m25y-1.5*k.iqr);k.p25y+1.5*k.iqr<k.whiskerp&&(k.whiskerp=k.p25y+1.5*k.iqr);if(!(d.logy&&0>=k.whiskerm)){c=b.grx[f+1]-b.grx[f];c*=.66;e=(b.grx[f+1]+b.grx[f])/2+a.fBarOffset/1E3*c;0<a.fBarWidth&&(c=c*a.fBarWidth/1E3);k.x1=Math.round(e-c/2);k.x2=Math.round(e+c/2);e=Math.round(e);k.y0=Math.round(d.gry(k.median));
t+="M"+k.x1+","+k.y0+"h"+(k.x2-k.x1);k.y1=Math.round(d.gry(k.p25y));k.y2=Math.round(d.gry(k.m25y));t+="M"+k.x1+","+k.y1+"v"+(k.y2-k.y1)+"h"+(k.x2-k.x1)+"v-"+(k.y2-k.y1)+"z";k.yy1=Math.round(d.gry(k.whiskerp));k.yy2=Math.round(d.gry(k.whiskerm));t+="M"+e+","+k.y1+"v"+(k.yy1-k.y1);t+="M"+k.x1+","+k.yy1+"h"+(k.x2-k.x1);t+="M"+e+","+k.y2+"v"+(k.yy2-k.y2);t+="M"+k.x1+","+k.yy2+"h"+(k.x2-k.x1);for(c=0;c<this.nbinsy;++c)m=a.getBinContent(f+1,c+1),l=a.fYaxis.GetBinCenter(c+1),0<m&&l<k.whiskerm&&(n+=this.markeratt.create(e,
l)),0<m&&l>k.whiskerp&&(n+=this.markeratt.create(e,l));b.candle.push(k)}}0<t.length&&this.draw_g.append("svg:path").attr("d",t).call(this.lineatt.func).call(this.fillatt.func);0<n.length&&this.draw_g.append("svg:path").attr("d",n).call(this.markeratt.func);return b};A.prototype.drawBinsScatter=function(){var a=this.getObject(),b=this.prepareColorDraw({rounding:!0,pixel_density:!0}),d=[],c=[],f=[],e=[],g=[],h,t,n=1,k=this.options.ScatCoef*(2E3<this.gmaxbin?2E3/this.gmaxbin:1);JSROOT.seed(b.sumz);if(1E5>
k*b.sumz){this.createAttMarker({attr:a});this.markeratt.resetPos();d="";for(h=b.i1;h<b.i2;++h){var m=b.grx[h+1]-b.grx[h];for(t=b.j1;t<b.j2;++t){var l=b.gry[t]-b.gry[t+1];var r=a.getBinContent(h+1,t+1);e=Math.round(k*r);if(!(0>=e))for(g=0;g<e;++g)d+=this.markeratt.create(Math.round(b.grx[h]+m*JSROOT.random()),Math.round(b.gry[t+1]+l*JSROOT.random()))}}this.draw_g.append("svg:path").attr("d",d).call(this.markeratt.func);return b}.7<this.maxbin&&(n=.7/this.maxbin);k=Math.round(b.max-b.min);k=this.createContour(50<
k?50:k,this.minposbin,this.maxbin,this.minposbin);for(h=b.i1;h<b.i2;++h)for(t=b.j1;t<b.j2;++t)if(r=a.getBinContent(h+1,t+1),!(0>=r||r<this.minbin||(m=b.grx[h+1]-b.grx[h],l=b.gry[t]-b.gry[t+1],0>=m*l||(r=k.getContourIndex(r/m/l),0>r)))){var q="M"+b.grx[h]+","+b.gry[t+1];if(void 0===d[r])d[r]=q,e[r]=m,g[r]=l;else{var p="m"+(b.grx[h]-c[r])+","+(b.gry[t+1]-f[r]);d[r]+=p.length<q.length?p:q;e[r]=Math.max(e[r],m);g[r]=Math.max(g[r],l)}c[r]=b.grx[h];f[r]=b.gry[t+1];d[r]+="v"+l+"h"+m+"v-"+l+"z"}r=this.getFrameSvg().select(".main_layer");
h=r.select("defs");h.empty()&&0<d.length&&(h=r.insert("svg:defs",":first-child"));this.createAttMarker({attr:a});for(r=0;r<d.length;++r)if(void 0!==d[r]&&r<k.arr.length){t="scatter_"+r;a=h.select("."+t);a.empty()?a=h.append("svg:pattern").attr("class",t).attr("id","jsroot_scatter_pattern_"+JSROOT._.id_counter++).attr("patternUnits","userSpaceOnUse"):a.selectAll("*").remove();t=Math.round(n*k.arr[r]*e[r]*g[r]);1>t&&(t=1);m=new Float32Array(t);l=new Float32Array(t);if(1===t)m[0]=l[0]=.5;else for(c=
0;c<t;++c)m[c]=JSROOT.random(),l[c]=JSROOT.random();this.markeratt.resetPos();c="";for(f=0;f<t;++f)c+=this.markeratt.create(m[f]*e[r],l[f]*g[r]);a.attr("width",e[r]).attr("height",g[r]).append("svg:path").attr("d",c).call(this.markeratt.func);this.draw_g.append("svg:path").attr("scatter-index",r).attr("fill","url(#"+a.attr("id")+")").attr("d",d[r])}return b};A.prototype.draw2DBins=function(){if(!this.draw_content)return this.removeG();this.createHistDrawAttributes();this.createG(!0);var a=null;this.isTH2Poly()?
a=this.DrawPolyBinsColor():(this.options.Scat?a=this.drawBinsScatter():this.options.Color?a=this.drawBinsColor():this.options.Box?a=this.drawBinsBox():this.options.Arrow?a=this.drawBinsArrow():this.options.Contour?a=this.drawBinsContour():this.options.Candle&&(a=this.drawBinsCandle()),this.options.Text&&(a=this.drawBinsText(a)),a||(a=this.drawBinsScatter()));this.tt_handle=a};A.prototype.getBinTooltips=function(a,b){var d=[],c=this.getHisto(),f=c.getBinContent(a+1,b+1);d.push(this.getObjectHint());
d.push("x = "+this.getAxisBinTip("x",c.fXaxis,a));d.push("y = "+this.getAxisBinTip("y",c.fYaxis,b));d.push("bin = "+a+", "+b);c.$baseh&&(f-=c.$baseh.getBinContent(a+1,b+1));d.push("entries = "+(f===Math.round(f)?f:v.floatToString(f,JSROOT.gStyle.fStatFormat)));if("E"==this.options.TextKind||this.matchObjectType("TProfile2D"))a=c.getBinError(c.getBin(a+1,b+1)),d.push("error = "+(a===Math.round(a)?a.toString():v.floatToString(a,JSROOT.gStyle.fPaintTextFormat)));return d};A.prototype.getCandleTooltips=
function(a){var b=[],d=this.getFramePainter(),c=this.getHisto();b.push(this.getObjectHint());b.push("x = "+d.axisAsText("x",c.fXaxis.GetBinLowEdge(a.bin+1)));b.push("mean y = "+v.floatToString(a.meany,JSROOT.gStyle.fStatFormat));b.push("m25 = "+v.floatToString(a.m25y,JSROOT.gStyle.fStatFormat));b.push("p25 = "+v.floatToString(a.p25y,JSROOT.gStyle.fStatFormat));return b};A.prototype.getPolyBinTooltips=function(a,b,d){a=this.getHisto().fBins.arr[a];var c=this.getFramePainter(),f=a.fPoly.fName,e=[],
g=0;"Graph"===f&&(f="");0===f.length&&(f=a.fNumber);if(void 0===b&&void 0===d){b=d=0;var h=a.fPoly,l=1;"TMultiGraph"===h._typename&&(l=a.fPoly.fGraphs.arr.length,h=null);for(var n=0;n<l;++n){if(!h||0<n)h=a.fPoly.fGraphs.arr[n];for(var k=0;k<h.fNpoints;++k)++g,b+=h.fX[k],d+=h.fY[k]}1<g&&(b/=g,d/=g)}e.push(this.getObjectHint());e.push("x = "+c.axisAsText("x",b));e.push("y = "+c.axisAsText("y",d));0<g&&e.push("npnts = "+g);e.push("bin = "+f);a.fContent===Math.round(a.fContent)?e.push("content = "+a.fContent):
e.push("content = "+v.floatToString(a.fContent,JSROOT.gStyle.fStatFormat));return e};A.prototype.processTooltipEvent=function(a){if(!(a&&this.draw_content&&this.draw_g&&this.tt_handle)||this.options.Proj)return this.draw_g&&this.draw_g.select(".tooltip_bin").remove(),null;var b=this.getHisto(),d=this.tt_handle,c=this.draw_g.select(".tooltip_bin");if(d.poly){d=this.getFramePainter();var f=-1,e=d.revertAxis("x",a.x),g=d.revertAxis("y",a.y);if(void 0!==e&&void 0!==g)for(var h=b.fBins.arr.length,l=0;l<
h&&0>f;++l){var n=b.fBins.arr[l];if(!(e<n.fXmin||e>n.fXmax||g<n.fYmin||g>n.fYmax||0===n.fContent&&!this.options.Zero)){var k=n.fPoly,m=1;"TMultiGraph"===k._typename&&(m=n.fPoly.fGraphs.arr.length,k=null);for(var q=0;q<m;++q){if(!k||0<q)k=n.fPoly.fGraphs.arr[q];if(k.IsInside(e,g)){f=l;break}}}}if(0>f)return c.remove(),null;e={name:b.fName,title:b.fTitle,x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",exact:!0,menu:!0,lines:this.getPolyBinTooltips(f,
e,g)};a.disabled?(c.remove(),e.changed=!0):(c.empty()&&(c=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events","none")),e.changed=c.property("current_bin")!==f,e.changed&&c.attr("d",this.createPolyBin(d,n)).style("opacity","0.7").property("current_bin",f));e.changed&&(e.user_info={obj:b,name:b.fName,bin:f,cont:n.fContent,grx:a.x,gry:a.y});return e}if(d.candle){for(f=0;f<d.candle.length;++f){var r=d.candle[f];if(r.x1<=a.x&&a.x<=r.x2&&r.yy1<=a.y&&a.y<=r.yy2)break}if(f>=
d.candle.length)return c.remove(),null;d={name:b.fName,title:b.fTitle,x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getCandleTooltips(r),exact:!0,menu:!0};a.disabled?(c.remove(),d.changed=!0):(c.empty()&&(c=this.draw_g.append("svg:rect").attr("class","tooltip_bin h1bin").style("pointer-events","none")),d.changed=c.property("current_bin")!==f,d.changed&&c.attr("x",r.x1).attr("width",r.x2-r.x1).attr("y",r.yy1).attr("height",
r.yy2-r.yy1).style("opacity","0.7").property("current_bin",f));d.changed&&(d.user_info={obj:b,name:b.fName,bin:f+1,cont:r.median,binx:f+1,biny:1,grx:a.x,gry:a.y});return d}var v=0,p=null,x=this.getFramePainter();if(x.reverse_x)for(n=d.i1;n<d.i2&&!(a.x<=d.grx[n]&&a.x>=d.grx[n+1]);++n);else for(n=d.i1;n<d.i2&&!(a.x>=d.grx[n]&&a.x<=d.grx[n+1]);++n);if(x.reverse_y)for(r=d.j1;r<d.j2&&!(a.y<=d.gry[r+1]&&a.y>=d.gry[r]);++r);else for(r=d.j1;r<d.j2&&!(a.y>=d.gry[r+1]&&a.y<=d.gry[r]);++r);if(n<d.i2&&r<d.j2){f=
n;e=n+1;g=r;h=r+1;l=d.grx[f];k=d.grx[e];m=d.gry[h];q=d.gry[g];p=!0;if(this.options.Color){v=k-l;var w=q-m;k=Math.round(l+v*d.xbar2);l=Math.round(l+v*d.xbar1);q=Math.round(m+w*d.ybar2);m=Math.round(m+w*d.ybar1);if(x.reverse_x){if(a.x>l||a.x<=k)p=!1}else if(a.x<l||a.x>=k)p=!1;if(x.reverse_y){if(a.y>m||a.y<=q)p=!1}else if(a.y<m||a.y>=q)p=!1}v=b.getBinContent(n+1,r+1);this.is_projection?p=0:p?d.hide_only_zeros?p=0!==v||this._show_empty_bins?0:null:(p=this.getContour().getPaletteIndex(this.getHistPalette(),
v),null===p&&0===v&&this._show_empty_bins&&(p=0)):p=null}if(null===p)return c.remove(),null;x={name:b.fName,title:b.fTitle,x:a.x,y:a.y,color1:this.lineatt?this.lineatt.color:"green",color2:this.fillatt?this.fillatt.getFillColorAlt("blue"):"blue",lines:this.getBinTooltips(n,r),exact:!0,menu:!0};this.options.Color&&(x.color2=this.getHistPalette().getColor(p));a.disabled&&!this.is_projection?(c.remove(),x.changed=!0):(c.empty()&&(c=this.draw_g.append("svg:path").attr("class","tooltip_bin h1bin").style("pointer-events",
"none")),p=1E4*n+r,"X"==this.is_projection?(l=0,k=this.getFramePainter().getFrameWidth(),1<this.projection_width&&(m=(this.projection_width-1)/2,h+m>=d.j2?(h=Math.min(Math.round(h+m),d.j2),g=Math.max(h-this.projection_width,d.j1)):(g=Math.max(Math.round(g-m),d.j1),h=Math.min(g+this.projection_width,d.j2))),m=d.gry[h],q=d.gry[g],p=777*g+333*h):"Y"==this.is_projection&&(m=0,q=this.getFramePainter().getFrameHeight(),1<this.projection_width&&(l=(this.projection_width-1)/2,e+l>=d.i2?(e=Math.min(Math.round(e+
l),d.i2),f=Math.max(e-this.projection_width,d.i1)):(f=Math.max(Math.round(f-l),d.i1),e=Math.min(f+this.projection_width,d.i2))),l=d.grx[f],k=d.grx[e],p=777*f+333*e),x.changed=c.property("current_bin")!==p,x.changed&&c.attr("d","M"+l+","+m+"h"+(k-l)+"v"+(q-m)+"h"+(l-k)+"z").style("opacity","0.7").property("current_bin",p),this.is_projection&&x.changed&&this.redrawProjection(f,e,g,h));x.changed&&(x.user_info={obj:b,name:b.fName,bin:b.getBin(n+1,r+1),cont:v,binx:n+1,biny:r+1,grx:a.x,gry:a.y});return x};
A.prototype.canZoomInside=function(a,b,d){if("z"==a)return!0;var c=this.getHisto();c&&(c="y"==a?c.fYaxis:c.fXaxis);return!c||1<c.FindBin(d,.5)-c.FindBin(b,0)};A.prototype.draw2D=function(){var a=this;this.clear3DScene();return this.drawColorPalette(this.options.Zscale&&(this.options.Color||this.options.Contour),!0).then(function(b){return a.drawAxes().then(function(){a.draw2DBins();return b?b.drawPave():!0})}).then(function(){return a.drawHistTitle()}).then(function(){a.updateStatWebCanvas();return a.addInteractivity()})};
A.prototype.draw3D=function(a){var b=this;this.mode3d=!0;return JSROOT.require("hist3d").then(function(){return b.draw3D(a)})};A.prototype.callDrawFunc=function(a){var b=this.getMainPainter(),d=this.getFramePainter();b!==this&&d&&d.mode3d!==this.options.Mode3D&&this.copyOptionsFrom(b);return this[this.options.Mode3D?"draw3D":"draw2D"](a)};A.prototype.redraw=function(a){return this.callDrawFunc(a)};var Z=function(a,b,d){var c=new JSROOT.TH2Painter(a,b);return v.ensureTCanvas(c).then(function(){c.setAsMainPainter();
c.decodeOptions(d);c.isTH2Poly()&&(c.options.Mode3D?c.options.Lego=12:c.options.Color||(c.options.Color=!0));c._show_empty_bins=!1;c._can_move_colz=!0;c.checkPadRange(!c.options.Mode3D&&14!=c.options.Contour);c.scanContent();c.createStat();return c.callDrawFunc()}).then(function(){return c.drawNextFunction(0)}).then(function(){!c.Mode3D&&c.options.AutoZoom&&c.autoZoom();c.fillToolbar();c.options.Project&&!c.mode3d&&c.toggleProjection(c.options.Project);return c})};J.prototype=Object.create(JSROOT.ObjectPainter.prototype);
J.prototype.cleanup=function(){var a=this,b=this.getPadPainter();b&&b.cleanPrimitives(function(b){return b===a.firstpainter||0<=a.painters.indexOf(b)});delete this.firstpainter;delete this.painters;JSROOT.ObjectPainter.prototype.cleanup.call(this)};J.prototype.buildStack=function(a){if(!a.fHists)return!1;var b=a.fHists.arr.length;if(0>=b)return!1;var d=JSROOT.create("TList");d.Add(JSROOT.clone(a.fHists.arr[0]),a.fHists.opt[0]);for(var c=1;c<b;++c){var f=JSROOT.clone(a.fHists.arr[c]),e=a.fHists.opt[c],
g=d.arr[c-1];if(f.fNbins!=g.fNbins||f.fXaxis.fXmin!=g.fXaxis.fXmin||f.fXaxis.fXmax!=g.fXaxis.fXmax)return console.warn("When drawing THStack, cannot sum-up histograms "+f.fName+" and "+g.fName),d.Clear(),!1;for(var h=0;h<f.fArray.length;++h)f.fArray[h]+=g.fArray[h];d.Add(f,e)}a.fStack=d;return!0};J.prototype.getMinMax=function(a){function b(a,b){var c={min:0,max:0},d=!0,e=!0;-1111!==a.fMinimum&&(c.min=a.fMinimum,d=!1);-1111!==a.fMaximum&&(c.max=a.fMaximum,e=!1);if(!d&&!e)return c;var f=1,g=a.fXaxis.fNbins,
h=1,l=1,t=!0;a.fXaxis.TestBit(JSROOT.EAxisBits.kAxisRange)&&(f=a.fXaxis.fFirst,g=a.fXaxis.fLast);0===a._typename.indexOf("TH2")&&(l=a.fYaxis.fNbins,a.fYaxis.TestBit(JSROOT.EAxisBits.kAxisRange)&&(h=a.fYaxis.fFirst,l=a.fYaxis.fLast));for(;h<=l;++h)for(var q=f;q<=g;++q){var v=a.getBinContent(q,h),z=b?a.getBinError(a.getBin(q,h)):0;d&&(t||v-z<c.min)&&(c.min=v-z);e&&(t||v+z>c.max)&&(c.max=v+z);t=!1}return c}var d={min:0,max:0},c=this.getObject(),f=this.getPadPainter().getRootPad(!0);if(this.options.nostack)for(var e=
0;e<c.fHists.arr.length;++e){var g=b(c.fHists.arr[e],a);0==e?d=g:(d.min=Math.min(d.min,g.min),d.max=Math.max(d.max,g.max))}else d.min=b(c.fStack.arr[0],a).min,d.max=b(c.fStack.arr[c.fStack.arr.length-1],a).max;-1111!=c.fMaximum&&(d.max=c.fMaximum);d.max*=1.05;-1111!=c.fMinimum&&(d.min=c.fMinimum);f&&(1==this.options.ndim?f.fLogy:f.fLogz)?(0>=d.max&&(d.max=1),0>=d.min&&(d.min=1E-4*d.max),a=1+.2*Math.log10(d.max/d.min),d.min*=1/(1+.5*Math.log10(d.max/d.min)),d.max*=a):0<d.min&&d.min<.05*d.max&&(d.min=
0);return d};J.prototype.drawNextHisto=function(a){var b=this,d=this.getObject(),c=(d=this.options.nostack?d.fHists:d.fStack)&&d.arr?d.arr.length:0;if(a>=c)return Promise.resolve(this);var f=this.options.horder?a:c-a-1,e=d.arr[f],g=d.opt[f]||e.fOption||this.options.hopt;0>g.toUpperCase().indexOf(this.options.hopt)&&(g+=this.options.hopt);this.options.draw_errors&&!g&&(g="E");g+=" same nostat";if(this.options._pfc||this.options._plc||this.options._pmc){var h=this.getMainPainter();h&&h.createAutoColor&&
(c=h.createAutoColor(c),this.options._pfc&&(e.fFillColor=c),this.options._plc&&(e.fLineColor=c),this.options._pmc&&(e.fMarkerColor=c))}0<f&&!this.options.nostack&&(e.$baseh=d.arr[f-1]);return JSROOT.draw(this.getDom(),e,g).then(function(c){b.painters.push(c);return b.drawNextHisto(a+1)})};J.prototype.decodeOptions=function(a){this.options||(this.options={});JSROOT.extend(this.options,{ndim:1,nostack:!1,same:!1,horder:!0,has_errors:!1,draw_errors:!1,hopt:""});var b=this.getObject(),d=b.fHistogram||
(b.fHists?b.fHists.arr[0]:null)||(b.fStack?b.fStack.arr[0]:null);d&&0==d._typename.indexOf("TH2")&&(this.options.ndim=2);2!=this.options.ndim||a||(a="lego1");if(b.fHists&&!this.options.nostack)for(d=0;d<b.fHists.arr.length;++d){var c=this.options,f;if(!(f=this.options.has_errors))a:{f=b.fHists.arr[d];if(f.fSumw2&&0<f.fSumw2.length)for(var e=0;e<f.fSumw2.length;++e)if(0<f.fSumw2[e]){f=!0;break a}f=!1}c.has_errors=f}a=new JSROOT.DrawOptions(a);this.options.nostack=a.check("NOSTACK");a.check("STACK")&&
(this.options.nostack=!1);this.options.same=a.check("SAME");this.options._pfc=a.check("PFC");this.options._plc=a.check("PLC");this.options._pmc=a.check("PMC");this.options.hopt=a.remain();b=a.check("LEGO");this.options.errors=a.check("E");!this.options.nostack&&this.options.has_errors&&!b&&!a.check("HIST")&&0>this.options.hopt.indexOf("E")&&(this.options.draw_errors=!0);this.options.horder=this.options.nostack||b};J.prototype.createHistogram=function(a){var b=a.fHists,d=b?b.arr.length:0;if(!d)return b=
JSROOT.createHistogram("TH1I",100),b.fTitle=a.fTitle,b;var c=b.arr[0],f=JSROOT.createHistogram(1==this.options.ndim?"TH1I":"TH2I",c.fXaxis.fNbins,c.fYaxis.fNbins);f.fName="axis_hist";JSROOT.extend(f.fXaxis,c.fXaxis);2==this.options.ndim&&JSROOT.extend(f.fYaxis,c.fYaxis);for(c=1;c<d;++c){var e=b.arr[c];f.fXaxis.fLabels||(f.fXaxis.fXmin=Math.min(f.fXaxis.fXmin,e.fXaxis.fXmin),f.fXaxis.fXmax=Math.max(f.fXaxis.fXmax,e.fXaxis.fXmax));2!=this.options.ndim||f.fYaxis.fLabels||(f.fYaxis.fXmin=Math.min(f.fYaxis.fXmin,
e.fYaxis.fXmin),f.fYaxis.fXmax=Math.max(f.fYaxis.fXmax,e.fYaxis.fXmax))}f.fTitle=a.fTitle;return f};J.prototype.updateObject=function(a){var b=this;if(!this.matchObjectType(a))return!1;var d=this.getObject();d.fHists=a.fHists;d.fStack=a.fStack;d.fTitle=a.fTitle;this.options.nostack||(this.options.nostack=!this.buildStack(d));this.firstpainter&&(a=a.fHistogram,a||(a=d.fHistogram=this.createHistogram(d)),this.firstpainter.updateObject(a),a=this.getMinMax(this.options.errors||this.options.draw_errors),
this.firstpainter.options.minimum=a.min,this.firstpainter.options.maximum=a.max,1==this.options.ndim&&(this.firstpainter.ymin=a.min,this.firstpainter.ymax=a.max));a=(d=this.options.nostack?d.fHists:d.fStack)&&d.arr?d.arr.length:0;if(a!==this.painters.length)(d=this.getPadPainter())&&d.cleanPrimitives(function(a){return 0<=b.painters.indexOf(a)}),this.painters=[],this.did_update=!0;else for(var c=0;c<a;++c)this.painters[c].updateObject(d.arr[this.options.horder?c:a-c-1]);return!0};J.prototype.redraw=
function(){if(this.did_update)return delete this.did_update,this.drawNextHisto(0)};v.getColorPalette=F;v.drawPave=Q;v.produceLegend=function(a,b){var d=v.getElementMainPainter(a);if(d){var c=d.getPadPainter();d=c.getRootPad(!0);if(c&&d){for(var f=JSROOT.create("TLegend"),e=0;e<c.painters.length;++e){var g=c.painters[e],h=g.getObject();if(h){var l=JSROOT.create("TLegendEntry");l.fObject=h;l.fLabel="all"==b?h.fName:g.getItemName();l.fOption="";l.fLabel&&(g.lineatt&&g.lineatt.used&&(l.fOption+="l"),
g.fillatt&&g.fillatt.used&&(l.fOption+="f"),g.markeratt&&g.markeratt.used&&(l.fOption+="m"),l.fOption||(l.fOption="l"),f.fPrimitives.Add(l))}}if(b=f.fPrimitives.arr.length)return 8<b&&(b=8),b*=.1,f.fX1NDC=.4*d.fLeftMargin+.6*(1-d.fRightMargin),f.fY1NDC=(1-b)*(1-d.fTopMargin)+b*d.fBottomMargin,f.fX2NDC=.99-d.fRightMargin,f.fY2NDC=.99-d.fTopMargin,f.fFillStyle=1001,Q(a,f)}}};v.drawHistogram1D=function(a,b,d){var c=new G(a,b);return v.ensureTCanvas(c).then(function(){c.setAsMainPainter();c.decodeOptions(d);
c.checkPadRange(!c.options.Mode3D);c.scanContent();c.createStat();return c.callDrawFunc()}).then(function(){return c.drawNextFunction(0)}).then(function(){!c.options.Mode3D&&c.options.AutoZoom&&c.autoZoom();c.fillToolbar();return c})};v.drawHistogram2D=Z;v.drawTF2=function(a,b,d){var c=new JSROOT.DrawOptions(d),f=O(b,c.check("NOSAVE"));d=c.empty()?"cont3":"SAME"===c.opt?"cont2 same":c.opt;return Z(a,f,d).then(function(a){a.tf2_typename=b._typename;a.tf2_nosave=c.check("NOSAVE");a.updateObject=function(a){if(!a||
this.tf2_typename!=a._typename)return!1;O(a,this.tf2_nosave,this.getHisto());return!0};return a})};v.drawHStack=function(a,b,d){if(!b.fHists||!b.fHists.arr)return null;var c=new J(a,b,d);return v.ensureTCanvas(c,!1).then(function(){c.decodeOptions(d);c.options.nostack||(c.options.nostack=!c.buildStack(b));if(!c.options.same){b.fHistogram||(b.fHistogram=c.createHistogram(b));var f=c.getMinMax(c.options.errors||c.options.draw_errors),e=c.options.hopt+" axis";f&&(e+=";minimum:"+f.min+";maximum:"+f.max);
return JSROOT.draw(a,b.fHistogram,e).then(function(a){c.firstpainter=a})}}).then(function(){return c.drawNextHisto(0)})};JSROOT.TPavePainter=z;JSROOT.THistPainter=q;JSROOT.TH1Painter=G;JSROOT.TH2Painter=A;JSROOT.THStackPainter=J;return JSROOT});
